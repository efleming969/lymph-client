import * as DOM from "./DOM";
import * as Utils from "./Utils";
import * as Command from "./Command";
export var run = function (window, app_component, app_name) {
    var context = Utils.createContext();
    var app = context.createComponent(app_component, app_name);
    var _a = app.init(window.location.hash.slice(1)), viewState = _a[0], command = _a[1];
    console.group("%c", "color: gray; font-weight: lighter;", ":init");
    console.log("%c next state", "color: #4CAF50; font-weight: bold;", viewState);
    console.log("%c commands", "color: #4CAF50; font-weight: bold;", command);
    console.groupEnd();
    var view = app.render(viewState);
    var lymph_config = window["lymphConfig"] || {
        actionName: "action"
    };
    window.addEventListener(lymph_config.actionName, function (e) {
        console.group("%c", "color: gray; font-weight: lighter;", e.detail.name);
        console.log("%c prev state", "color: #9E9E9E; font-weight: bold;", viewState);
        console.log("%c message", "color: #03A9F4; font-weight: bold;", e.detail);
        var _a = app.update(e.detail, viewState), state = _a[0], command = _a[1];
        console.log("%c next state", "color: #4CAF50; font-weight: bold;", state);
        console.log("%c commands", "color: #4CAF50; font-weight: bold;", command);
        viewState = state;
        view = app.render(viewState);
        DOM.updateChildren(window, window.document.body, view);
        Command.process(window, command);
        console.groupEnd();
    });
    window.addEventListener("hashchange", function (e) {
        window.document.dispatchEvent(new window["CustomEvent"](lymph_config.actionName, {
            detail: { name: ":route-changed", data: window.location.hash.slice(1) },
            bubbles: true,
            cancelable: true
        }));
    });
    // because we never want to do standard submits in SPAs
    window.document.addEventListener("submit", function (e) { return e.preventDefault(); }, true);
    DOM.updateChildren(window, window.document.body, view);
    Command.process(window, command);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTHltcGguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvTHltcGgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLEdBQUcsTUFBTSxPQUFPLENBQUE7QUFDNUIsT0FBTyxLQUFLLEtBQUssTUFBTSxTQUFTLENBQUE7QUFDaEMsT0FBTyxLQUFLLE9BQU8sTUFBTSxXQUFXLENBQUE7QUFFcEMsTUFBTSxDQUFDLElBQU0sR0FBRyxHQUFHLFVBQVcsTUFBTSxFQUFFLGFBQWEsRUFBRSxRQUFRO0lBQ3pELElBQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxhQUFhLEVBQUUsQ0FBQTtJQUNyQyxJQUFNLEdBQUcsR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFFLGFBQWEsRUFBRSxRQUFRLENBQUUsQ0FBQTtJQUUxRCxJQUFBLDRDQUFvRSxFQUFsRSxpQkFBUyxFQUFFLGVBQU8sQ0FBZ0Q7SUFFeEUsT0FBTyxDQUFDLEtBQUssQ0FBRSxJQUFJLEVBQUUsb0NBQW9DLEVBQUUsT0FBTyxDQUFFLENBQUE7SUFDcEUsT0FBTyxDQUFDLEdBQUcsQ0FBRSxlQUFlLEVBQUUsb0NBQW9DLEVBQUUsU0FBUyxDQUFFLENBQUE7SUFDL0UsT0FBTyxDQUFDLEdBQUcsQ0FBRSxhQUFhLEVBQUUsb0NBQW9DLEVBQUUsT0FBTyxDQUFFLENBQUE7SUFDM0UsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFBO0lBRWxCLElBQUksSUFBSSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUUsU0FBUyxDQUFFLENBQUE7SUFFbEMsSUFBTSxZQUFZLEdBQUcsTUFBTSxDQUFFLGFBQWEsQ0FBRSxJQUFJO1FBQzVDLFVBQVUsRUFBRSxRQUFRO0tBQ3ZCLENBQUE7SUFFRCxNQUFNLENBQUMsZ0JBQWdCLENBQUUsWUFBWSxDQUFDLFVBQVUsRUFBRSxVQUFXLENBQWM7UUFDdkUsT0FBTyxDQUFDLEtBQUssQ0FBRSxJQUFJLEVBQUUsb0NBQW9DLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUUsQ0FBQTtRQUUxRSxPQUFPLENBQUMsR0FBRyxDQUFFLGVBQWUsRUFBRSxvQ0FBb0MsRUFBRSxTQUFTLENBQUUsQ0FBQTtRQUMvRSxPQUFPLENBQUMsR0FBRyxDQUFFLFlBQVksRUFBRSxvQ0FBb0MsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFFLENBQUE7UUFFckUsSUFBQSxvQ0FBc0QsRUFBcEQsYUFBSyxFQUFFLGVBQU8sQ0FBc0M7UUFFNUQsT0FBTyxDQUFDLEdBQUcsQ0FBRSxlQUFlLEVBQUUsb0NBQW9DLEVBQUUsS0FBSyxDQUFFLENBQUE7UUFDM0UsT0FBTyxDQUFDLEdBQUcsQ0FBRSxhQUFhLEVBQUUsb0NBQW9DLEVBQUUsT0FBTyxDQUFFLENBQUE7UUFFM0UsU0FBUyxHQUFHLEtBQUssQ0FBQTtRQUNqQixJQUFJLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBRSxTQUFTLENBQUUsQ0FBQTtRQUU5QixHQUFHLENBQUMsY0FBYyxDQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUUsQ0FBQTtRQUV4RCxPQUFPLENBQUMsT0FBTyxDQUFFLE1BQU0sRUFBRSxPQUFPLENBQUUsQ0FBQTtRQUVsQyxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUE7SUFDdEIsQ0FBQyxDQUFFLENBQUE7SUFFSCxNQUFNLENBQUMsZ0JBQWdCLENBQUUsWUFBWSxFQUFFLFVBQVcsQ0FBQztRQUMvQyxNQUFNLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FDekIsSUFBSSxNQUFNLENBQUUsYUFBYSxDQUFFLENBQUUsWUFBWSxDQUFDLFVBQVUsRUFBRTtZQUNsRCxNQUFNLEVBQUUsRUFBRSxJQUFJLEVBQUUsZ0JBQWdCLEVBQUUsSUFBSSxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBRSxDQUFDLENBQUUsRUFBRTtZQUN6RSxPQUFPLEVBQUUsSUFBSTtZQUNiLFVBQVUsRUFBRSxJQUFJO1NBQ25CLENBQUUsQ0FDTixDQUFBO0lBQ0wsQ0FBQyxDQUFFLENBQUE7SUFFSCx1REFBdUQ7SUFDdkQsTUFBTSxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBRSxRQUFRLEVBQUUsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsY0FBYyxFQUFFLEVBQWxCLENBQWtCLEVBQUUsSUFBSSxDQUFFLENBQUE7SUFFM0UsR0FBRyxDQUFDLGNBQWMsQ0FBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFFLENBQUE7SUFFeEQsT0FBTyxDQUFDLE9BQU8sQ0FBRSxNQUFNLEVBQUUsT0FBTyxDQUFFLENBQUE7QUFDdEMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgRE9NIGZyb20gXCIuL0RPTVwiXG5pbXBvcnQgKiBhcyBVdGlscyBmcm9tIFwiLi9VdGlsc1wiXG5pbXBvcnQgKiBhcyBDb21tYW5kIGZyb20gXCIuL0NvbW1hbmRcIlxuXG5leHBvcnQgY29uc3QgcnVuID0gZnVuY3Rpb24gKCB3aW5kb3csIGFwcF9jb21wb25lbnQsIGFwcF9uYW1lICkge1xuICAgIGNvbnN0IGNvbnRleHQgPSBVdGlscy5jcmVhdGVDb250ZXh0KClcbiAgICBjb25zdCBhcHAgPSBjb250ZXh0LmNyZWF0ZUNvbXBvbmVudCggYXBwX2NvbXBvbmVudCwgYXBwX25hbWUgKVxuXG4gICAgbGV0IFsgdmlld1N0YXRlLCBjb21tYW5kIF0gPSBhcHAuaW5pdCggd2luZG93LmxvY2F0aW9uLmhhc2guc2xpY2UoIDEgKSApXG5cbiAgICBjb25zb2xlLmdyb3VwKCBcIiVjXCIsIFwiY29sb3I6IGdyYXk7IGZvbnQtd2VpZ2h0OiBsaWdodGVyO1wiLCBcIjppbml0XCIgKVxuICAgIGNvbnNvbGUubG9nKCBcIiVjIG5leHQgc3RhdGVcIiwgXCJjb2xvcjogIzRDQUY1MDsgZm9udC13ZWlnaHQ6IGJvbGQ7XCIsIHZpZXdTdGF0ZSApXG4gICAgY29uc29sZS5sb2coIFwiJWMgY29tbWFuZHNcIiwgXCJjb2xvcjogIzRDQUY1MDsgZm9udC13ZWlnaHQ6IGJvbGQ7XCIsIGNvbW1hbmQgKVxuICAgIGNvbnNvbGUuZ3JvdXBFbmQoKVxuXG4gICAgbGV0IHZpZXcgPSBhcHAucmVuZGVyKCB2aWV3U3RhdGUgKVxuXG4gICAgY29uc3QgbHltcGhfY29uZmlnID0gd2luZG93WyBcImx5bXBoQ29uZmlnXCIgXSB8fCB7XG4gICAgICAgIGFjdGlvbk5hbWU6IFwiYWN0aW9uXCJcbiAgICB9XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciggbHltcGhfY29uZmlnLmFjdGlvbk5hbWUsIGZ1bmN0aW9uICggZTogQ3VzdG9tRXZlbnQgKSB7XG4gICAgICAgIGNvbnNvbGUuZ3JvdXAoIFwiJWNcIiwgXCJjb2xvcjogZ3JheTsgZm9udC13ZWlnaHQ6IGxpZ2h0ZXI7XCIsIGUuZGV0YWlsLm5hbWUgKVxuXG4gICAgICAgIGNvbnNvbGUubG9nKCBcIiVjIHByZXYgc3RhdGVcIiwgXCJjb2xvcjogIzlFOUU5RTsgZm9udC13ZWlnaHQ6IGJvbGQ7XCIsIHZpZXdTdGF0ZSApXG4gICAgICAgIGNvbnNvbGUubG9nKCBcIiVjIG1lc3NhZ2VcIiwgXCJjb2xvcjogIzAzQTlGNDsgZm9udC13ZWlnaHQ6IGJvbGQ7XCIsIGUuZGV0YWlsIClcblxuICAgICAgICBjb25zdCBbIHN0YXRlLCBjb21tYW5kIF0gPSBhcHAudXBkYXRlKCBlLmRldGFpbCwgdmlld1N0YXRlIClcblxuICAgICAgICBjb25zb2xlLmxvZyggXCIlYyBuZXh0IHN0YXRlXCIsIFwiY29sb3I6ICM0Q0FGNTA7IGZvbnQtd2VpZ2h0OiBib2xkO1wiLCBzdGF0ZSApXG4gICAgICAgIGNvbnNvbGUubG9nKCBcIiVjIGNvbW1hbmRzXCIsIFwiY29sb3I6ICM0Q0FGNTA7IGZvbnQtd2VpZ2h0OiBib2xkO1wiLCBjb21tYW5kIClcblxuICAgICAgICB2aWV3U3RhdGUgPSBzdGF0ZVxuICAgICAgICB2aWV3ID0gYXBwLnJlbmRlciggdmlld1N0YXRlIClcblxuICAgICAgICBET00udXBkYXRlQ2hpbGRyZW4oIHdpbmRvdywgd2luZG93LmRvY3VtZW50LmJvZHksIHZpZXcgKVxuXG4gICAgICAgIENvbW1hbmQucHJvY2Vzcyggd2luZG93LCBjb21tYW5kIClcblxuICAgICAgICBjb25zb2xlLmdyb3VwRW5kKClcbiAgICB9IClcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCBcImhhc2hjaGFuZ2VcIiwgZnVuY3Rpb24gKCBlICkge1xuICAgICAgICB3aW5kb3cuZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChcbiAgICAgICAgICAgIG5ldyB3aW5kb3dbIFwiQ3VzdG9tRXZlbnRcIiBdKCBseW1waF9jb25maWcuYWN0aW9uTmFtZSwge1xuICAgICAgICAgICAgICAgIGRldGFpbDogeyBuYW1lOiBgOnJvdXRlLWNoYW5nZWRgLCBkYXRhOiB3aW5kb3cubG9jYXRpb24uaGFzaC5zbGljZSggMSApIH0sXG4gICAgICAgICAgICAgICAgYnViYmxlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjYW5jZWxhYmxlOiB0cnVlXG4gICAgICAgICAgICB9IClcbiAgICAgICAgKVxuICAgIH0gKVxuXG4gICAgLy8gYmVjYXVzZSB3ZSBuZXZlciB3YW50IHRvIGRvIHN0YW5kYXJkIHN1Ym1pdHMgaW4gU1BBc1xuICAgIHdpbmRvdy5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCBcInN1Ym1pdFwiLCBlID0+IGUucHJldmVudERlZmF1bHQoKSwgdHJ1ZSApXG5cbiAgICBET00udXBkYXRlQ2hpbGRyZW4oIHdpbmRvdywgd2luZG93LmRvY3VtZW50LmJvZHksIHZpZXcgKVxuXG4gICAgQ29tbWFuZC5wcm9jZXNzKCB3aW5kb3csIGNvbW1hbmQgKVxufVxuIl19
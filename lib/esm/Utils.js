export const generateId = (function () {
    const ALPHABET = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
    const ID_LENGTH = 8;
    return function () {
        let rtn = "";
        for (let i = 0; i < ID_LENGTH; i++) {
            rtn += ALPHABET.charAt(Math.floor(Math.random() * ALPHABET.length));
        }
        return rtn;
    };
})();
export const objectFromPair = function (pair) {
    const obj = {};
    obj[pair[0]] = pair[1];
    return obj;
};
export const merge = function (obj1, obj2) {
    return Object.assign({}, obj1, obj2);
};
const sendQuery = function (path) {
    const options = { method: "GET" };
    const handleErrors = function (response) {
        if (!response.ok)
            throw new Error("whatup dog!");
        return response;
    };
    return fetch(path, options)
        .then(handleErrors)
        .then(response => response.json());
};
const sendCommand = function (name, events, data) {
    return { type: "RemoteCommand", name, data, events };
};
const loadStorage = function (name, events) {
    return { type: "LoadStorage", name, events };
};
const sendRedirect = function (path) {
    return { type: "Redirect", events: [], path };
};
export const dispatchAction = function (window) {
    return function (event) {
        window.dispatchEvent(new window.CustomEvent("action", { detail: event, bubbles: true, cancelable: true }));
    };
};
const send = function (name, data) {
    return { name, data };
};
export const sendForm = function (name) {
    return { type: "form", name };
};
export const evolve = function (transformations, object) {
    const result = {};
    for (const key in object) {
        let transformation = transformations[key];
        if (typeof transformation === "function") {
            result[key] = transformation(object[key]);
        }
        else if (typeof transformation === "object") {
            result[key] = evolve(transformation, object[key]);
        }
        else {
            result[key] = object[key];
        }
    }
    return result;
};
export const currentTarget = function (message) {
    return message.event.currentTarget;
};
const forEach = function (fn, iterable) {
    for (let i = 0; i < iterable.length; i++) {
        fn(iterable[i]);
    }
};
export const extractFormData = function (form) {
    const fields = {};
    const copyProp = function (element, propName) {
        fields[element.name] = element[propName];
    };
    forEach(function (element) {
        if (element.type === "text" || element.type === "password") {
            copyProp(element, "value");
        }
        else if (element.type === "radio" && element.checked) {
            copyProp(element, "value");
        }
        else if (element.type === "checkbox") {
            copyProp(element, "checked");
        }
        else if (element.nodeName === "SELECT") {
            copyProp(element, "value");
        }
    }, form.elements);
    return fields;
};
export const currentForm = function (message) {
    return extractFormData(currentTarget(message));
};
export const find = function (array, condition) {
    let result;
    for (let i = 0; i < array.length; i++) {
        if (condition(array[i])) {
            return array[i];
        }
    }
    return result;
};
export const mapObjectToArray = function (object, fn) {
    return Object.keys(object).map(function (key) {
        return fn(key, object[key]);
    });
};
const extractMessage = function (parent_message, message) {
    return merge(message, { name: message.name.replace(":" + parent_message, "") });
};
export const createUpdater = function (routeDefinitions) {
    return function (message, state) {
        for (let name in routeDefinitions) {
            if (message.name.indexOf(":" + name) === 0) {
                return routeDefinitions[name](extractMessage(name, message), state);
            }
        }
        return [state, undefined];
    };
};
export const createContext = function (names = []) {
    return {
        createComponent: function (component, component_name) {
            const { init, updater, render } = component.create(createContext(names.concat(component_name)));
            return { init, update: createUpdater(updater), render };
        },
        send: function (name) {
            return ":" + names.slice(1).concat(name).join(":");
        }
    };
};
export const createActionHandler = window => function (action, callback) {
    window.addEventListener("action", function (e) {
        if (e["detail"].name === action)
            callback(e["detail"]);
    });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvVXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTSxDQUFDLE1BQU0sVUFBVSxHQUFHLENBQUM7SUFDdkIsTUFBTSxRQUFRLEdBQUcsZ0VBQWdFLENBQUE7SUFDakYsTUFBTSxTQUFTLEdBQUcsQ0FBQyxDQUFBO0lBRW5CLE1BQU0sQ0FBQztRQUNILElBQUksR0FBRyxHQUFHLEVBQUUsQ0FBQTtRQUNaLEdBQUcsQ0FBQyxDQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsU0FBUyxFQUFFLENBQUMsRUFBRSxFQUFHLENBQUM7WUFDbkMsR0FBRyxJQUFJLFFBQVEsQ0FBQyxNQUFNLENBQUUsSUFBSSxDQUFDLEtBQUssQ0FBRSxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBRSxDQUFFLENBQUE7UUFDM0UsQ0FBQztRQUNELE1BQU0sQ0FBQyxHQUFHLENBQUE7SUFDZCxDQUFDLENBQUE7QUFDTCxDQUFDLENBQUMsRUFBRSxDQUFBO0FBRUosTUFBTSxDQUFDLE1BQU0sY0FBYyxHQUFHLFVBQVcsSUFBSTtJQUN6QyxNQUFNLEdBQUcsR0FBRyxFQUFFLENBQUE7SUFDZCxHQUFHLENBQUUsSUFBSSxDQUFFLENBQUMsQ0FBRSxDQUFFLEdBQUcsSUFBSSxDQUFFLENBQUMsQ0FBRSxDQUFBO0lBQzVCLE1BQU0sQ0FBQyxHQUFHLENBQUE7QUFDZCxDQUFDLENBQUE7QUFFRCxNQUFNLENBQUMsTUFBTSxLQUFLLEdBQUcsVUFBVyxJQUFJLEVBQUUsSUFBSTtJQUN0QyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBRSxDQUFBO0FBQzFDLENBQUMsQ0FBQTtBQUVELE1BQU0sU0FBUyxHQUFHLFVBQVcsSUFBSTtJQUM3QixNQUFNLE9BQU8sR0FBRyxFQUFFLE1BQU0s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RSxFQUFFLE1BQU0sRUFBRSxDQUFBO1FBQzdELENBQUM7UUFDRCxJQUFJLEVBQUUsVUFBVyxJQUFJO1lBQ2pCLE1BQU0sQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBRSxDQUFDLENBQUUsQ0FBQyxNQUFNLENBQUUsSUFBSSxDQUFFLENBQUMsSUFBSSxDQUFFLEdBQUcsQ0FBRSxDQUFBO1FBQzVELENBQUM7S0FDSixDQUFBO0FBQ0wsQ0FBQyxDQUFBO0FBRUQsTUFBTSxDQUFDLE1BQU0sbUJBQW1CLEdBQUcsTUFBTSxDQUFDLEVBQUUsQ0FBQyxVQUFXLE1BQU0sRUFBRSxRQUFRO0lBQ3BFLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBRSxRQUFRLEVBQUUsVUFBVyxDQUFDO1FBQzNDLEVBQUUsQ0FBQyxDQUFFLENBQUMsQ0FBRSxRQUFRLENBQUUsQ0FBQyxJQUFJLEtBQUssTUFBTyxDQUFDO1lBQUMsUUFBUSxDQUFFLENBQUMsQ0FBRSxRQUFRLENBQUUsQ0FBRSxDQUFBO0lBQ2xFLENBQUMsQ0FBRSxDQUFBO0FBQ1AsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IGdlbmVyYXRlSWQgPSAoZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IEFMUEhBQkVUID0gXCIwMTIzNDU2Nzg5YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXpBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWlwiXG4gICAgY29uc3QgSURfTEVOR1RIID0gOFxuXG4gICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGV0IHJ0biA9IFwiXCJcbiAgICAgICAgZm9yICggbGV0IGkgPSAwOyBpIDwgSURfTEVOR1RIOyBpKysgKSB7XG4gICAgICAgICAgICBydG4gKz0gQUxQSEFCRVQuY2hhckF0KCBNYXRoLmZsb29yKCBNYXRoLnJhbmRvbSgpICogQUxQSEFCRVQubGVuZ3RoICkgKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBydG5cbiAgICB9XG59KSgpXG5cbmV4cG9ydCBjb25zdCBvYmplY3RGcm9tUGFpciA9IGZ1bmN0aW9uICggcGFpciApIHtcbiAgICBjb25zdCBvYmogPSB7fVxuICAgIG9ialsgcGFpclsgMCBdIF0gPSBwYWlyWyAxIF1cbiAgICByZXR1cm4gb2JqXG59XG5cbmV4cG9ydCBjb25zdCBtZXJnZSA9IGZ1bmN0aW9uICggb2JqMSwgb2JqMiApIHtcbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbigge30sIG9iajEsIG9iajIgKVxufVxuXG5jb25zdCBzZW5kUXVlcnkgPSBmdW5jdGlvbiAoIHBhdGggKSB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHsgbWV0aG9kOiBcIkdFVFwiIH1cblxuICAgIGNvbnN0IGhhbmRsZUVycm9ycyA9IGZ1bmN0aW9uICggcmVzcG9uc2UgKSB7XG4gICAgICAgIGlmICggIXJlc3BvbnNlLm9rIClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvciggXCJ3aGF0dXAgZG9nIVwiIClcblxuICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICB9XG5cbiAgICByZXR1cm4gZmV0Y2goIHBhdGgsIG9wdGlvbnMgKVxuICAgICAgICAudGhlbiggaGFuZGxlRXJyb3JzIClcbiAgICAgICAgLnRoZW4oIHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSApXG59XG5cbmNvbnN0IHNlbmRDb21tYW5kID0gZnVuY3Rpb24gKCBuYW1lLCBldmVudHMsIGRhdGEgKSB7XG4gICAgcmV0dXJuIHsgdHlwZTogXCJSZW1vdGVDb21tYW5kXCIsIG5hbWUsIGRhdGEsIGV2ZW50cyB9XG59XG5cbmNvbnN0IGxvYWRTdG9yYWdlID0gZnVuY3Rpb24gKCBuYW1lLCBldmVudHMgKSB7XG4gICAgcmV0dXJuIHsgdHlwZTogXCJMb2FkU3RvcmFnZVwiLCBuYW1lLCBldmVudHMgfVxufVxuXG5jb25zdCBzZW5kUmVkaXJlY3QgPSBmdW5jdGlvbiAoIHBhdGggKSB7XG4gICAgcmV0dXJuIHsgdHlwZTogXCJSZWRpcmVjdFwiLCBldmVudHM6IFtdLCBwYXRoIH1cbn1cblxuZXhwb3J0IGNvbnN0IGRpc3BhdGNoQWN0aW9uID0gZnVuY3Rpb24gKCB3aW5kb3cgKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICggZXZlbnQgKSB7XG4gICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KCBuZXcgd2luZG93LkN1c3RvbUV2ZW50KCBcImFjdGlvblwiLFxuICAgICAgICAgICAgeyBkZXRhaWw6IGV2ZW50LCBidWJibGVzOiB0cnVlLCBjYW5jZWxhYmxlOiB0cnVlIH0gKSApXG4gICAgfVxufVxuXG5jb25zdCBzZW5kID0gZnVuY3Rpb24gKCBuYW1lLCBkYXRhICkge1xuICAgIHJldHVybiB7IG5hbWUsIGRhdGEgfVxufVxuXG5leHBvcnQgY29uc3Qgc2VuZEZvcm0gPSBmdW5jdGlvbiAoIG5hbWUgKSB7XG4gICAgcmV0dXJuIHsgdHlwZTogXCJmb3JtXCIsIG5hbWUgfVxufVxuXG5leHBvcnQgY29uc3QgZXZvbHZlID0gZnVuY3Rpb24gKCB0cmFuc2Zvcm1hdGlvbnMsIG9iamVjdCApIHtcbiAgICBjb25zdCByZXN1bHQgPSB7fVxuXG4gICAgZm9yICggY29uc3Qga2V5IGluIG9iamVjdCApIHtcbiAgICAgICAgbGV0IHRyYW5zZm9ybWF0aW9uID0gdHJhbnNmb3JtYXRpb25zWyBrZXkgXVxuXG4gICAgICAgIGlmICggdHlwZW9mIHRyYW5zZm9ybWF0aW9uID09PSBcImZ1bmN0aW9uXCIgKSB7XG4gICAgICAgICAgICByZXN1bHRbIGtleSBdID0gdHJhbnNmb3JtYXRpb24oIG9iamVjdFsga2V5IF0gKVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCB0eXBlb2YgdHJhbnNmb3JtYXRpb24gPT09IFwib2JqZWN0XCIgKSB7XG4gICAgICAgICAgICByZXN1bHRbIGtleSBdID0gZXZvbHZlKCB0cmFuc2Zvcm1hdGlvbiwgb2JqZWN0WyBrZXkgXSApXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHRbIGtleSBdID0gb2JqZWN0WyBrZXkgXVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHRcbn1cblxuXG5leHBvcnQgaW50ZXJmYWNlIElIYXNFdmVudCB7XG4gICAgZXZlbnQ6IEV2ZW50XG59XG5cbmV4cG9ydCBjb25zdCBjdXJyZW50VGFyZ2V0ID0gZnVuY3Rpb24gKCBtZXNzYWdlOiBJSGFzRXZlbnQgKTogRXZlbnRUYXJnZXQge1xuICAgIHJldHVybiBtZXNzYWdlLmV2ZW50LmN1cnJlbnRUYXJnZXRcbn1cblxuY29uc3QgZm9yRWFjaCA9IGZ1bmN0aW9uICggZm4sIGl0ZXJhYmxlICkge1xuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IGl0ZXJhYmxlLmxlbmd0aDsgaSsrICkge1xuICAgICAgICBmbiggaXRlcmFibGVbIGkgXSApXG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgZXh0cmFjdEZvcm1EYXRhID0gZnVuY3Rpb24gKCBmb3JtICkge1xuICAgIGNvbnN0IGZpZWxkcyA9IHt9XG5cbiAgICBjb25zdCBjb3B5UHJvcCA9IGZ1bmN0aW9uICggZWxlbWVudCwgcHJvcE5hbWUgKSB7XG4gICAgICAgIGZpZWxkc1sgZWxlbWVudC5uYW1lIF0gPSBlbGVtZW50WyBwcm9wTmFtZSBdXG4gICAgfVxuXG4gICAgZm9yRWFjaCggZnVuY3Rpb24gKCBlbGVtZW50ICkge1xuICAgICAgICBpZiAoIGVsZW1lbnQudHlwZSA9PT0gXCJ0ZXh0XCIgfHwgZWxlbWVudC50eXBlID09PSBcInBhc3N3b3JkXCIgKSB7XG4gICAgICAgICAgICBjb3B5UHJvcCggZWxlbWVudCwgXCJ2YWx1ZVwiIClcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICggZWxlbWVudC50eXBlID09PSBcInJhZGlvXCIgJiYgZWxlbWVudC5jaGVja2VkICkge1xuICAgICAgICAgICAgY29weVByb3AoIGVsZW1lbnQsIFwidmFsdWVcIiApXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIGVsZW1lbnQudHlwZSA9PT0gXCJjaGVja2JveFwiICkge1xuICAgICAgICAgICAgY29weVByb3AoIGVsZW1lbnQsIFwiY2hlY2tlZFwiIClcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICggZWxlbWVudC5ub2RlTmFtZSA9PT0gXCJTRUxFQ1RcIiApIHtcbiAgICAgICAgICAgIGNvcHlQcm9wKCBlbGVtZW50LCBcInZhbHVlXCIgKVxuICAgICAgICB9XG4gICAgfSwgZm9ybS5lbGVtZW50cyApXG5cbiAgICByZXR1cm4gZmllbGRzXG59XG5cbmV4cG9ydCBjb25zdCBjdXJyZW50Rm9ybSA9IGZ1bmN0aW9uICggbWVzc2FnZTogSUhhc0V2ZW50ICk6IGFueSB7XG4gICAgcmV0dXJuIGV4dHJhY3RGb3JtRGF0YSggY3VycmVudFRhcmdldCggbWVzc2FnZSApIClcbn1cblxuZXhwb3J0IGNvbnN0IGZpbmQgPSBmdW5jdGlvbiAoIGFycmF5OiBhbnlbXSwgY29uZGl0aW9uOiAoIGFueSApID0+IGJvb2xlYW4gKSB7XG4gICAgbGV0IHJlc3VsdFxuXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKysgKSB7XG4gICAgICAgIGlmICggY29uZGl0aW9uKCBhcnJheVsgaSBdICkgKSB7XG4gICAgICAgICAgICByZXR1cm4gYXJyYXlbIGkgXVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdFxufVxuXG5leHBvcnQgY29uc3QgbWFwT2JqZWN0VG9BcnJheSA9IGZ1bmN0aW9uICggb2JqZWN0OiBhbnksIGZuOiAoIGtleTogc3RyaW5nLCB2YWxpdWU6IGFueSApID0+IGFueSApOiBhbnkge1xuICAgIHJldHVybiBPYmplY3Qua2V5cyggb2JqZWN0ICkubWFwKCBmdW5jdGlvbiAoIGtleSApIHtcbiAgICAgICAgcmV0dXJuIGZuKCBrZXksIG9iamVjdFsga2V5IF0gKVxuICAgIH0gKVxufVxuXG50eXBlIE1lc3NhZ2UgPSB7XG4gICAgbmFtZTogc3RyaW5nLFxuICAgIGRhdGE6IGFueSxcbiAgICBldmVudDogYW55XG59XG5cbmNvbnN0IGV4dHJhY3RNZXNzYWdlID0gZnVuY3Rpb24gKCBwYXJlbnRfbWVzc2FnZSwgbWVzc2FnZSApIHtcbiAgICByZXR1cm4gbWVyZ2UoIG1lc3NhZ2UsIHsgbmFtZTogbWVzc2FnZS5uYW1lLnJlcGxhY2UoIFwiOlwiICsgcGFyZW50X21lc3NhZ2UsIFwiXCIgKSB9IClcbn1cblxuZXhwb3J0IGNvbnN0IGNyZWF0ZVVwZGF0ZXIgPSBmdW5jdGlvbiAoIHJvdXRlRGVmaW5pdGlvbnM6IGFueSApOiAoIE1lc3NhZ2UsIGFueSApID0+IFsgYW55LCBhbnkgXSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICggbWVzc2FnZTogTWVzc2FnZSwgc3RhdGU6IGFueSApOiBbIGFueSwgYW55IF0ge1xuICAgICAgICBmb3IgKCBsZXQgbmFtZSBpbiByb3V0ZURlZmluaXRpb25zICkge1xuICAgICAgICAgICAgaWYgKCBtZXNzYWdlLm5hbWUuaW5kZXhPZiggXCI6XCIgKyBuYW1lICkgPT09IDAgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJvdXRlRGVmaW5pdGlvbnNbIG5hbWUgXSggZXh0cmFjdE1lc3NhZ2UoIG5hbWUsIG1lc3NhZ2UgKSwgc3RhdGUgKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIFsgc3RhdGUsIHVuZGVmaW5lZCBdXG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgY3JlYXRlQ29udGV4dCA9IGZ1bmN0aW9uICggbmFtZXMgPSBbXSApIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBjcmVhdGVDb21wb25lbnQ6IGZ1bmN0aW9uICggY29tcG9uZW50LCBjb21wb25lbnRfbmFtZSApIHtcbiAgICAgICAgICAgIGNvbnN0IHsgaW5pdCwgdXBkYXRlciwgcmVuZGVyIH0gPVxuICAgICAgICAgICAgICAgIGNvbXBvbmVudC5jcmVhdGUoIGNyZWF0ZUNvbnRleHQoIG5hbWVzLmNvbmNhdCggY29tcG9uZW50X25hbWUgKSApIClcblxuICAgICAgICAgICAgcmV0dXJuIHsgaW5pdCwgdXBkYXRlOiBjcmVhdGVVcGRhdGVyKCB1cGRhdGVyICksIHJlbmRlciB9XG4gICAgICAgIH0sXG4gICAgICAgIHNlbmQ6IGZ1bmN0aW9uICggbmFtZSApIHtcbiAgICAgICAgICAgIHJldHVybiBcIjpcIiArIG5hbWVzLnNsaWNlKCAxICkuY29uY2F0KCBuYW1lICkuam9pbiggXCI6XCIgKVxuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgY3JlYXRlQWN0aW9uSGFuZGxlciA9IHdpbmRvdyA9PiBmdW5jdGlvbiAoIGFjdGlvbiwgY2FsbGJhY2sgKSB7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIFwiYWN0aW9uXCIsIGZ1bmN0aW9uICggZSApIHtcbiAgICAgICAgaWYgKCBlWyBcImRldGFpbFwiIF0ubmFtZSA9PT0gYWN0aW9uICkgY2FsbGJhY2soIGVbIFwiZGV0YWlsXCIgXSApXG4gICAgfSApXG59XG4iXX0=
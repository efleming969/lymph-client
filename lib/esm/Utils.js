export var generateId = (function () {
    var ALPHABET = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
    var ID_LENGTH = 8;
    return function () {
        var rtn = "";
        for (var i = 0; i < ID_LENGTH; i++) {
            rtn += ALPHABET.charAt(Math.floor(Math.random() * ALPHABET.length));
        }
        return rtn;
    };
})();
export var objectFromPair = function (pair) {
    var obj = {};
    obj[pair[0]] = pair[1];
    return obj;
};
export var merge = function (obj1, obj2) {
    return Object.assign({}, obj1, obj2);
};
var sendQuery = function (path) {
    var options = { method: "GET" };
    var handleErrors = function (response) {
        if (!response.ok)
            throw new Error("whatup dog!");
        return response;
    };
    return fetch(path, options)
        .then(handleErrors)
        .then(function (response) { return response.json(); });
};
var sendCommand = function (name, events, data) {
    return { type: "RemoteCommand", name: name, data: data, events: events };
};
var loadStorage = function (name, events) {
    return { type: "LoadStorage", name: name, events: events };
};
var sendRedirect = function (path) {
    return { type: "Redirect", events: [], path: path };
};
export var dispatchAction = function (window) {
    return function (event) {
        window.dispatchEvent(new window.CustomEvent("action", { detail: event, bubbles: true, cancelable: true }));
    };
};
var send = function (name, data) {
    return { name: name, data: data };
};
export var sendForm = function (name) {
    return { type: "form", name: name };
};
export var evolve = function (transformations, object) {
    var result = {};
    for (var key in object) {
        var transformation = transformations[key];
        if (typeof transformation === "function") {
            result[key] = transformation(object[key]);
        }
        else if (typeof transformation === "object") {
            result[key] = evolve(transformation, object[key]);
        }
        else {
            result[key] = object[key];
        }
    }
    return result;
};
export var currentTarget = function (message) {
    return message.event.currentTarget;
};
var forEach = function (fn, iterable) {
    for (var i = 0; i < iterable.length; i++) {
        fn(iterable[i]);
    }
};
export var extractFormData = function (form) {
    var fields = {};
    var copyProp = function (element, propName) {
        fields[element.name] = element[propName];
    };
    forEach(function (element) {
        if (element.type === "text" || element.type === "password") {
            copyProp(element, "value");
        }
        else if (element.type === "radio" && element.checked) {
            copyProp(element, "value");
        }
        else if (element.type === "checkbox") {
            copyProp(element, "checked");
        }
        else if (element.nodeName === "SELECT") {
            copyProp(element, "value");
        }
    }, form.elements);
    return fields;
};
export var currentForm = function (message) {
    return extractFormData(currentTarget(message));
};
export var find = function (array, condition) {
    var result;
    for (var i = 0; i < array.length; i++) {
        if (condition(array[i])) {
            return array[i];
        }
    }
    return result;
};
export var mapObjectToArray = function (object, fn) {
    return Object.keys(object).map(function (key) {
        return fn(key, object[key]);
    });
};
var extractMessage = function (parent_message, message) {
    return merge(message, { name: message.name.replace(":" + parent_message, "") });
};
export var createUpdater = function (routeDefinitions) {
    return function (message, state) {
        for (var name_1 in routeDefinitions) {
            if (message.name.indexOf(":" + name_1) === 0) {
                return routeDefinitions[name_1](extractMessage(name_1, message), state);
            }
        }
        return [state, undefined];
    };
};
export var createContext = function (names) {
    if (names === void 0) { names = []; }
    return {
        createComponent: function (component, component_name) {
            var _a = component.create(createContext(names.concat(component_name))), init = _a.init, updater = _a.updater, render = _a.render;
            return { init: init, update: createUpdater(updater), render: render };
        },
        send: function (name) {
            return ":" + names.slice(1).concat(name).join(":");
        }
    };
};
export var createActionHandler = function (window) { return function (action, callback) {
    window.addEventListener("action", function (e) {
        if (e["detail"].name === action)
            callback(e["detail"]);
    });
}; };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvVXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTSxDQUFDLElBQU0sVUFBVSxHQUFHLENBQUM7SUFDdkIsSUFBTSxRQUFRLEdBQUcsZ0VBQWdFLENBQUE7SUFDakYsSUFBTSxTQUFTLEdBQUcsQ0FBQyxDQUFBO0lBRW5CLE1BQU0sQ0FBQztRQUNILElBQUksR0FBRyxHQUFHLEVBQUUsQ0FBQTtRQUNaLEdBQUcsQ0FBQyxDQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsU0FBUyxFQUFFLENBQUMsRUFBRSxFQUFHLENBQUM7WUFDbkMsR0FBRyxJQUFJLFFBQVEsQ0FBQyxNQUFNLENBQUUsSUFBSSxDQUFDLEtBQUssQ0FBRSxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBRSxDQUFFLENBQUE7UUFDM0UsQ0FBQztRQUNELE1BQU0sQ0FBQyxHQUFHLENBQUE7SUFDZCxDQUFDLENBQUE7QUFDTCxDQUFDLENBQUMsRUFBRSxDQUFBO0FBRUosTUFBTSxDQUFDLElBQU0sY0FBYyxHQUFHLFVBQVcsSUFBSTtJQUN6QyxJQUFNLEdBQUcsR0FBRyxFQUFFLENBQUE7SUFDZCxHQUFHLENBQUUsSUFBSSxDQUFFLENBQUMsQ0FBRSxDQUFFLEdBQUcsSUFBSSxDQUFFLENBQUMsQ0FBRSxDQUFBO0lBQzVCLE1BQU0sQ0FBQyxHQUFHLENBQUE7QUFDZCxDQUFDLENBQUE7QUFFRCxNQUFNLENBQUMsSUFBTSxLQUFLLEdBQUcsVUFBVyxJQUFJLEVBQUUsSUFBSTtJQUN0QyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBRSxDQUFBO0FBQzFDLENBQUMsQ0FBQTtBQUVELElBQU0sU0FBUyxHQUFHLFVBQVcsSUFBSTtJQUM3QixJQUFNLE9BQU8sR0FBRyxFQUFFLE1BQU0s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QUUsRUFBRSxNQUFNLFFBQUEsRUFBRSxDQUFBO1FBQzdELENBQUM7UUFDRCxJQUFJLEVBQUUsVUFBVyxJQUFJO1lBQ2pCLE1BQU0sQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBRSxDQUFDLENBQUUsQ0FBQyxNQUFNLENBQUUsSUFBSSxDQUFFLENBQUMsSUFBSSxDQUFFLEdBQUcsQ0FBRSxDQUFBO1FBQzVELENBQUM7S0FDSixDQUFBO0FBQ0wsQ0FBQyxDQUFBO0FBRUQsTUFBTSxDQUFDLElBQU0sbUJBQW1CLEdBQUcsVUFBQSxNQUFNLElBQUksT0FBQSxVQUFXLE1BQU0sRUFBRSxRQUFRO0lBQ3BFLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBRSxRQUFRLEVBQUUsVUFBVyxDQUFDO1FBQzNDLEVBQUUsQ0FBQyxDQUFFLENBQUMsQ0FBRSxRQUFRLENBQUUsQ0FBQyxJQUFJLEtBQUssTUFBTyxDQUFDO1lBQUMsUUFBUSxDQUFFLENBQUMsQ0FBRSxRQUFRLENBQUUsQ0FBRSxDQUFBO0lBQ2xFLENBQUMsQ0FBRSxDQUFBO0FBQ1AsQ0FBQyxFQUo0QyxDQUk1QyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IGdlbmVyYXRlSWQgPSAoZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IEFMUEhBQkVUID0gXCIwMTIzNDU2Nzg5YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXpBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWlwiXG4gICAgY29uc3QgSURfTEVOR1RIID0gOFxuXG4gICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGV0IHJ0biA9IFwiXCJcbiAgICAgICAgZm9yICggbGV0IGkgPSAwOyBpIDwgSURfTEVOR1RIOyBpKysgKSB7XG4gICAgICAgICAgICBydG4gKz0gQUxQSEFCRVQuY2hhckF0KCBNYXRoLmZsb29yKCBNYXRoLnJhbmRvbSgpICogQUxQSEFCRVQubGVuZ3RoICkgKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBydG5cbiAgICB9XG59KSgpXG5cbmV4cG9ydCBjb25zdCBvYmplY3RGcm9tUGFpciA9IGZ1bmN0aW9uICggcGFpciApIHtcbiAgICBjb25zdCBvYmogPSB7fVxuICAgIG9ialsgcGFpclsgMCBdIF0gPSBwYWlyWyAxIF1cbiAgICByZXR1cm4gb2JqXG59XG5cbmV4cG9ydCBjb25zdCBtZXJnZSA9IGZ1bmN0aW9uICggb2JqMSwgb2JqMiApIHtcbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbigge30sIG9iajEsIG9iajIgKVxufVxuXG5jb25zdCBzZW5kUXVlcnkgPSBmdW5jdGlvbiAoIHBhdGggKSB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHsgbWV0aG9kOiBcIkdFVFwiIH1cblxuICAgIGNvbnN0IGhhbmRsZUVycm9ycyA9IGZ1bmN0aW9uICggcmVzcG9uc2UgKSB7XG4gICAgICAgIGlmICggIXJlc3BvbnNlLm9rIClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvciggXCJ3aGF0dXAgZG9nIVwiIClcblxuICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICB9XG5cbiAgICByZXR1cm4gZmV0Y2goIHBhdGgsIG9wdGlvbnMgKVxuICAgICAgICAudGhlbiggaGFuZGxlRXJyb3JzIClcbiAgICAgICAgLnRoZW4oIHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSApXG59XG5cbmNvbnN0IHNlbmRDb21tYW5kID0gZnVuY3Rpb24gKCBuYW1lLCBldmVudHMsIGRhdGEgKSB7XG4gICAgcmV0dXJuIHsgdHlwZTogXCJSZW1vdGVDb21tYW5kXCIsIG5hbWUsIGRhdGEsIGV2ZW50cyB9XG59XG5cbmNvbnN0IGxvYWRTdG9yYWdlID0gZnVuY3Rpb24gKCBuYW1lLCBldmVudHMgKSB7XG4gICAgcmV0dXJuIHsgdHlwZTogXCJMb2FkU3RvcmFnZVwiLCBuYW1lLCBldmVudHMgfVxufVxuXG5jb25zdCBzZW5kUmVkaXJlY3QgPSBmdW5jdGlvbiAoIHBhdGggKSB7XG4gICAgcmV0dXJuIHsgdHlwZTogXCJSZWRpcmVjdFwiLCBldmVudHM6IFtdLCBwYXRoIH1cbn1cblxuZXhwb3J0IGNvbnN0IGRpc3BhdGNoQWN0aW9uID0gZnVuY3Rpb24gKCB3aW5kb3cgKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICggZXZlbnQgKSB7XG4gICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KCBuZXcgd2luZG93LkN1c3RvbUV2ZW50KCBcImFjdGlvblwiLFxuICAgICAgICAgICAgeyBkZXRhaWw6IGV2ZW50LCBidWJibGVzOiB0cnVlLCBjYW5jZWxhYmxlOiB0cnVlIH0gKSApXG4gICAgfVxufVxuXG5jb25zdCBzZW5kID0gZnVuY3Rpb24gKCBuYW1lLCBkYXRhICkge1xuICAgIHJldHVybiB7IG5hbWUsIGRhdGEgfVxufVxuXG5leHBvcnQgY29uc3Qgc2VuZEZvcm0gPSBmdW5jdGlvbiAoIG5hbWUgKSB7XG4gICAgcmV0dXJuIHsgdHlwZTogXCJmb3JtXCIsIG5hbWUgfVxufVxuXG5leHBvcnQgY29uc3QgZXZvbHZlID0gZnVuY3Rpb24gKCB0cmFuc2Zvcm1hdGlvbnMsIG9iamVjdCApIHtcbiAgICBjb25zdCByZXN1bHQgPSB7fVxuXG4gICAgZm9yICggY29uc3Qga2V5IGluIG9iamVjdCApIHtcbiAgICAgICAgbGV0IHRyYW5zZm9ybWF0aW9uID0gdHJhbnNmb3JtYXRpb25zWyBrZXkgXVxuXG4gICAgICAgIGlmICggdHlwZW9mIHRyYW5zZm9ybWF0aW9uID09PSBcImZ1bmN0aW9uXCIgKSB7XG4gICAgICAgICAgICByZXN1bHRbIGtleSBdID0gdHJhbnNmb3JtYXRpb24oIG9iamVjdFsga2V5IF0gKVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCB0eXBlb2YgdHJhbnNmb3JtYXRpb24gPT09IFwib2JqZWN0XCIgKSB7XG4gICAgICAgICAgICByZXN1bHRbIGtleSBdID0gZXZvbHZlKCB0cmFuc2Zvcm1hdGlvbiwgb2JqZWN0WyBrZXkgXSApXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHRbIGtleSBdID0gb2JqZWN0WyBrZXkgXVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHRcbn1cblxuXG5leHBvcnQgaW50ZXJmYWNlIElIYXNFdmVudCB7XG4gICAgZXZlbnQ6IEV2ZW50XG59XG5cbmV4cG9ydCBjb25zdCBjdXJyZW50VGFyZ2V0ID0gZnVuY3Rpb24gKCBtZXNzYWdlOiBJSGFzRXZlbnQgKTogRXZlbnRUYXJnZXQge1xuICAgIHJldHVybiBtZXNzYWdlLmV2ZW50LmN1cnJlbnRUYXJnZXRcbn1cblxuY29uc3QgZm9yRWFjaCA9IGZ1bmN0aW9uICggZm4sIGl0ZXJhYmxlICkge1xuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IGl0ZXJhYmxlLmxlbmd0aDsgaSsrICkge1xuICAgICAgICBmbiggaXRlcmFibGVbIGkgXSApXG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgZXh0cmFjdEZvcm1EYXRhID0gZnVuY3Rpb24gKCBmb3JtICkge1xuICAgIGNvbnN0IGZpZWxkcyA9IHt9XG5cbiAgICBjb25zdCBjb3B5UHJvcCA9IGZ1bmN0aW9uICggZWxlbWVudCwgcHJvcE5hbWUgKSB7XG4gICAgICAgIGZpZWxkc1sgZWxlbWVudC5uYW1lIF0gPSBlbGVtZW50WyBwcm9wTmFtZSBdXG4gICAgfVxuXG4gICAgZm9yRWFjaCggZnVuY3Rpb24gKCBlbGVtZW50ICkge1xuICAgICAgICBpZiAoIGVsZW1lbnQudHlwZSA9PT0gXCJ0ZXh0XCIgfHwgZWxlbWVudC50eXBlID09PSBcInBhc3N3b3JkXCIgKSB7XG4gICAgICAgICAgICBjb3B5UHJvcCggZWxlbWVudCwgXCJ2YWx1ZVwiIClcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICggZWxlbWVudC50eXBlID09PSBcInJhZGlvXCIgJiYgZWxlbWVudC5jaGVja2VkICkge1xuICAgICAgICAgICAgY29weVByb3AoIGVsZW1lbnQsIFwidmFsdWVcIiApXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIGVsZW1lbnQudHlwZSA9PT0gXCJjaGVja2JveFwiICkge1xuICAgICAgICAgICAgY29weVByb3AoIGVsZW1lbnQsIFwiY2hlY2tlZFwiIClcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICggZWxlbWVudC5ub2RlTmFtZSA9PT0gXCJTRUxFQ1RcIiApIHtcbiAgICAgICAgICAgIGNvcHlQcm9wKCBlbGVtZW50LCBcInZhbHVlXCIgKVxuICAgICAgICB9XG4gICAgfSwgZm9ybS5lbGVtZW50cyApXG5cbiAgICByZXR1cm4gZmllbGRzXG59XG5cbmV4cG9ydCBjb25zdCBjdXJyZW50Rm9ybSA9IGZ1bmN0aW9uICggbWVzc2FnZTogSUhhc0V2ZW50ICk6IGFueSB7XG4gICAgcmV0dXJuIGV4dHJhY3RGb3JtRGF0YSggY3VycmVudFRhcmdldCggbWVzc2FnZSApIClcbn1cblxuZXhwb3J0IGNvbnN0IGZpbmQgPSBmdW5jdGlvbiAoIGFycmF5OiBhbnlbXSwgY29uZGl0aW9uOiAoIGFueSApID0+IGJvb2xlYW4gKSB7XG4gICAgbGV0IHJlc3VsdFxuXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKysgKSB7XG4gICAgICAgIGlmICggY29uZGl0aW9uKCBhcnJheVsgaSBdICkgKSB7XG4gICAgICAgICAgICByZXR1cm4gYXJyYXlbIGkgXVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdFxufVxuXG5leHBvcnQgY29uc3QgbWFwT2JqZWN0VG9BcnJheSA9IGZ1bmN0aW9uICggb2JqZWN0OiBhbnksIGZuOiAoIGtleTogc3RyaW5nLCB2YWxpdWU6IGFueSApID0+IGFueSApOiBhbnkge1xuICAgIHJldHVybiBPYmplY3Qua2V5cyggb2JqZWN0ICkubWFwKCBmdW5jdGlvbiAoIGtleSApIHtcbiAgICAgICAgcmV0dXJuIGZuKCBrZXksIG9iamVjdFsga2V5IF0gKVxuICAgIH0gKVxufVxuXG50eXBlIE1lc3NhZ2UgPSB7XG4gICAgbmFtZTogc3RyaW5nLFxuICAgIGRhdGE6IGFueSxcbiAgICBldmVudDogYW55XG59XG5cbmNvbnN0IGV4dHJhY3RNZXNzYWdlID0gZnVuY3Rpb24gKCBwYXJlbnRfbWVzc2FnZSwgbWVzc2FnZSApIHtcbiAgICByZXR1cm4gbWVyZ2UoIG1lc3NhZ2UsIHsgbmFtZTogbWVzc2FnZS5uYW1lLnJlcGxhY2UoIFwiOlwiICsgcGFyZW50X21lc3NhZ2UsIFwiXCIgKSB9IClcbn1cblxuZXhwb3J0IGNvbnN0IGNyZWF0ZVVwZGF0ZXIgPSBmdW5jdGlvbiAoIHJvdXRlRGVmaW5pdGlvbnM6IGFueSApOiAoIE1lc3NhZ2UsIGFueSApID0+IFsgYW55LCBhbnkgXSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICggbWVzc2FnZTogTWVzc2FnZSwgc3RhdGU6IGFueSApOiBbIGFueSwgYW55IF0ge1xuICAgICAgICBmb3IgKCBsZXQgbmFtZSBpbiByb3V0ZURlZmluaXRpb25zICkge1xuICAgICAgICAgICAgaWYgKCBtZXNzYWdlLm5hbWUuaW5kZXhPZiggXCI6XCIgKyBuYW1lICkgPT09IDAgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJvdXRlRGVmaW5pdGlvbnNbIG5hbWUgXSggZXh0cmFjdE1lc3NhZ2UoIG5hbWUsIG1lc3NhZ2UgKSwgc3RhdGUgKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIFsgc3RhdGUsIHVuZGVmaW5lZCBdXG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgY3JlYXRlQ29udGV4dCA9IGZ1bmN0aW9uICggbmFtZXMgPSBbXSApIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBjcmVhdGVDb21wb25lbnQ6IGZ1bmN0aW9uICggY29tcG9uZW50LCBjb21wb25lbnRfbmFtZSApIHtcbiAgICAgICAgICAgIGNvbnN0IHsgaW5pdCwgdXBkYXRlciwgcmVuZGVyIH0gPVxuICAgICAgICAgICAgICAgIGNvbXBvbmVudC5jcmVhdGUoIGNyZWF0ZUNvbnRleHQoIG5hbWVzLmNvbmNhdCggY29tcG9uZW50X25hbWUgKSApIClcblxuICAgICAgICAgICAgcmV0dXJuIHsgaW5pdCwgdXBkYXRlOiBjcmVhdGVVcGRhdGVyKCB1cGRhdGVyICksIHJlbmRlciB9XG4gICAgICAgIH0sXG4gICAgICAgIHNlbmQ6IGZ1bmN0aW9uICggbmFtZSApIHtcbiAgICAgICAgICAgIHJldHVybiBcIjpcIiArIG5hbWVzLnNsaWNlKCAxICkuY29uY2F0KCBuYW1lICkuam9pbiggXCI6XCIgKVxuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgY3JlYXRlQWN0aW9uSGFuZGxlciA9IHdpbmRvdyA9PiBmdW5jdGlvbiAoIGFjdGlvbiwgY2FsbGJhY2sgKSB7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIFwiYWN0aW9uXCIsIGZ1bmN0aW9uICggZSApIHtcbiAgICAgICAgaWYgKCBlWyBcImRldGFpbFwiIF0ubmFtZSA9PT0gYWN0aW9uICkgY2FsbGJhY2soIGVbIFwiZGV0YWlsXCIgXSApXG4gICAgfSApXG59XG4iXX0=
const createNodeFrom = function (window, spec) {
    let element = null;
    if (typeof spec === "string") {
        element = window.document.createTextNode(spec);
    }
    else {
        element = window.document.createElement(spec.tagName);
        updateProperties(window, element, spec);
        for (let i = 0, len = spec.children.length; i < len; i++) {
            element.appendChild(createNodeFrom(window, spec.children[i]));
        }
    }
    return element;
};
export const updateChildren = function (window, oldNode, spec) {
    let oldLength = oldNode.childNodes.length;
    let newLength = spec.children.length;
    for (let i1 = 0; i1 < newLength; i1++) {
        patch(window, oldNode, oldNode.childNodes[i1], spec.children[i1]);
    }
    for (let i2 = 0; i2 < (oldLength - newLength); i2++) {
        oldNode.removeChild(oldNode.lastChild);
    }
};
const updateProperties = function (window, oldNode, spec) {
    if (oldNode._properties) {
        for (let propName of oldNode._properties) {
            if (propName.startsWith("on"))
                oldNode[propName] = function () {
                };
        }
    }
    oldNode._properties = [];
    for (let propName in spec.properties) {
        oldNode._properties.push(propName);
        if (propName.startsWith("on")) {
            oldNode[propName] = (function ([name, data]) {
                return function (event) {
                    const lymph_config = window["lymphConfig"] || { actionName: "action" };
                    this.dispatchEvent(new window["CustomEvent"](lymph_config.actionName, {
                        detail: { name, data, event },
                        bubbles: true,
                        cancelable: true
                    }));
                };
            })(spec.properties[propName]);
        }
        else if (oldNode[propName] !== spec.properties[propName]) {
            oldNode[propName] = spec.properties[propName];
        }
    }
};
export const patch = function (window, parent, oldNode, spec) {
    if (oldNode === undefined) {
        parent.appendChild(createNodeFrom(window, spec));
    }
    else {
        if (typeof spec === "string" && oldNode.nodeType === Node.TEXT_NODE) {
            if (oldNode.nodeValue !== spec) {
                oldNode.nodeValue = spec;
            }
        }
        else if (oldNode.nodeType === Node.ELEMENT_NODE) {
            if (oldNode.tagName !== spec.tagName) {
                parent.replaceChild(createNodeFrom(window, spec), oldNode);
            }
            else {
                updateProperties(window, oldNode, spec);
                updateChildren(window, oldNode, spec);
            }
        }
        else if (oldNode.nodeType === Node.TEXT_NODE) {
            parent.replaceChild(createNodeFrom(window, spec), oldNode);
        }
        else {
            throw "unknown node";
        }
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRE9NLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL0RPTS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxNQUFNLGNBQWMsR0FBRyxVQUFXLE1BQWMsRUFBRSxJQUFJO0lBQ2xELElBQUksT0FBTyxHQUFHLElBQUksQ0FBQTtJQUVsQixFQUFFLENBQUMsQ0FBRSxPQUFPLElBQUksS0FBSyxRQUFTLENBQUMsQ0FBQyxDQUFDO1FBQzdCLE9BQU8sR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBRSxJQUFJLENBQUUsQ0FBQTtJQUNwRCxDQUFDO0lBQUMsSUFBSSxDQUFDLENBQUM7UUFDSixPQUFPLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBRSxDQUFBO1FBRXZELGdCQUFnQixDQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFFLENBQUE7UUFFekMsR0FBRyxDQUFDLENBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsRUFBRSxFQUFHLENBQUM7WUFDekQsT0FBTyxDQUFDLFdBQVcsQ0FBRSxjQUFjLENBQUUsTUFBTSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUUsQ0FBQyxDQUFFLENBQUUsQ0FBRSxDQUFBO1FBQ3ZFLENBQUM7SUFDTCxDQUFDO0lBRUQsTUFBTSxDQUFDLE9BQU8sQ0FBQTtBQUNsQixDQUFDLENBQUE7QUFFRCxNQUFNLENBQUMsTUFBTSxjQUFjLEdBQUcsVUFBVyxNQUFjLEVBQUUsT0FBTyxFQUFFLElBQUk7SUFDbEUsSUFBSSxTQUFTLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUE7SUFDekMsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUE7SUFFcEMsR0FBRyxDQUFDLENBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxFQUFFLEVBQUUsR0FBRyxTQUFTLEVBQUUsRUFBRSxFQUFFLEVBQUcsQ0FBQztRQUN0QyxLQUFLLENBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxPQUFPLENBQUMsVUFBVSxDQUFFLEVBQUUsQ0FBRSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUUsRUFBRSxDQUFFLENBQUUsQ0FBQTtJQUMzRSxDQUFDO0lBRUQsR0FBRyxDQUFDLENBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxFQUFFLEVBQUUsR0FBRyxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRyxDQUFDO1FBQ3BELE9BQU8sQ0FBQyxXQUFXLENBQUUsT0FBTyxDQUFDLFNBQVMsQ0FBRSxDQUFBO0lBQzVDLENBQUM7QUFDTCxDQUFDLENBQUE7QUFFRCxNQUFNLGdCQUFnQixHQUFHLFVBQVcsTUFBYyxFQUFFLE9BQU8sRUFBRSxJQUFJO0lBQzdELEVBQUUsQ0FBQyxDQUFFLE9BQU8sQ0FBQyxXQUFZLENBQUMsQ0FBQyxDQUFDO1FBQ3hCLEdBQUcsQ0FBQyxDQUFFLElBQUksUUFBUSxJQUFJLE9BQU8sQ0FBQyxXQUFZLENBQUMsQ0FBQyxDQUFDO1lBQ3pDLEVBQUUsQ0FBQyxDQUFFLFFBQVEsQ0FBQyxVQUFVLENBQUUsSUFBSSxDQUFHLENBQUM7Z0JBQzlCLE9BQU8sQ0FBRSxRQUFRLENBQUUsR0FBRztnQkFDdEIsQ0FBQyxDQUFBO1FBQ1QsQ0FBQztJQUNMLENBQUM7SUFFRCxPQUFPLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQTtJQUV4QixHQUFHLENBQUMsQ0FBRSxJQUFJLFFBQVEsSUFBSSxJQUFJLENBQUMsVUFBVyxDQUFDLENBQUMsQ0FBQztRQUNyQyxPQUFPLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBRSxRQUFRLENBQUUsQ0FBQTtRQUNwQyxFQUFFLENBQUMsQ0FBRSxRQUFRLENBQUMsVUFBVSxDQUFFLElBQUksQ0FBRyxDQUFDLENBQUMsQ0FBQztZQUNoQyxPQUFPLENBQUUsUUFBUSxDQUFFLEdBQUcsQ0FBQyxVQUFXLENBQUUsSUFBSSxFQUFFLElBQUksQ0FBRTtnQkFDNUMsTUFBTSxDQUFDLFVBQVcsS0FBSztvQkFDbkIsTUFBTSxZQUFZLEdBQUcsTUFBTSxDQUFFLGFBQWEsQ0FBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxDQUFBO29CQUN4RSxJQUFJLENBQUMsYUFBYSxDQUNkLElBQUksTUFBTSxDQUFFLGFBQWEsQ0FBRSxDQUFFLFlBQVksQ0FBQyxVQUFVLEVBQUU7d0JBQ2xELE1BQU0sRUFBRSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFO3dCQUM3QixPQUFPLEVBQUUsSUFBSTt3QkFDYixVQUFVLEVBQUUsSUFBSTtxQkFDbkIsQ0FBRSxDQUNOLENBQUE7Z0JBQ0wsQ0FBQyxDQUFBO1lBQ0wsQ0FBQyxDQUFDLENBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBRSxRQUFRLENBQUUsQ0FBRSxDQUFBO1FBQ3JDLENBQUM7UUFDRCxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUUsT0FBTyxDQUFFLFFBQVEsQ0FBRSxLQUFLLElBQUksQ0FBQyxVQUFVLENBQUUsUUFBUSxDQUFHLENBQUMsQ0FBQyxDQUFDO1lBQzdELE9BQU8sQ0FBRSxRQUFRLENBQUUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFFLFFBQVEsQ0FBRSxDQUFBO1FBQ3JELENBQUM7SUFDTCxDQUFDO0FBQ0wsQ0FBQyxDQUFBO0FBRUQsTUFBTSxDQUFDLE1BQU0sS0FBSyxHQUFHLFVBQVcsTUFBYyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsSUFBSTtJQUNqRSxFQUFFLENBQUMsQ0FBRSxPQUFPLEtBQUssU0FBVSxDQUFDLENBQUMsQ0FBQztRQUMxQixNQUFNLENBQUMsV0FBVyxDQUFFLGNBQWMsQ0FBRSxNQUFNLEVBQUUsSUFBSSxDQUFFLENBQUUsQ0FBQTtJQUN4RCxDQUFDO0lBQ0QsSUFBSSxDQUFDLENBQUM7UUFDRixFQUFFLENBQUMsQ0FBRSxPQUFPLElBQUksS0FBSyxRQUFRLElBQUksT0FBTyxDQUFDLFFBQVEsS0FBSyxJQUFJLENBQUMsU0FBVSxDQUFDLENBQUMsQ0FBQztZQUNwRSxFQUFFLENBQUMsQ0FBRSxPQUFPLENBQUMsU0FBUyxLQUFLLElBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQy9CLE9BQU8sQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFBO1lBQzVCLENBQUM7UUFDTCxDQUFDO1FBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFFLE9BQU8sQ0FBQyxRQUFRLEtBQUssSUFBSSxDQUFDLFlBQWEsQ0FBQyxDQUFDLENBQUM7WUFDaEQsRUFBRSxDQUFDLENBQUUsT0FBTyxDQUFDLE9BQU8sS0FBSyxJQUFJLENBQUMsT0FBUSxDQUFDLENBQUMsQ0FBQztnQkFDckMsTUFBTSxDQUFDLFlBQVksQ0FBRSxjQUFjLENBQUUsTUFBTSxFQUFFLElBQUksQ0FBRSxFQUFFLE9BQU8sQ0FBRSxDQUFBO1lBQ2xFLENBQUM7WUFDRCxJQUFJLENBQUMsQ0FBQztnQkFDRixnQkFBZ0IsQ0FBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBRSxDQUFBO2dCQUN6QyxjQUFjLENBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUUsQ0FBQTtZQUMzQyxDQUFDO1FBQ0wsQ0FBQztRQUNELElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBRSxPQUFPLENBQUMsUUFBUSxLQUFLLElBQUksQ0FBQyxTQUFVLENBQUMsQ0FBQyxDQUFDO1lBQzdDLE1BQU0sQ0FBQyxZQUFZLENBQUUsY0FBYyxDQUFFLE1BQU0sRUFBRSxJQUFJLENBQUUsRUFBRSxPQUFPLENBQUUsQ0FBQTtRQUNsRSxDQUFDO1FBQ0QsSUFBSSxDQUFDLENBQUM7WUFDRixNQUFNLGNBQWMsQ0FBQTtRQUN4QixDQUFDO0lBQ0wsQ0FBQztBQUNMLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGNyZWF0ZU5vZGVGcm9tID0gZnVuY3Rpb24gKCB3aW5kb3c6IFdpbmRvdywgc3BlYyApIHtcbiAgICBsZXQgZWxlbWVudCA9IG51bGxcblxuICAgIGlmICggdHlwZW9mIHNwZWMgPT09IFwic3RyaW5nXCIgKSB7XG4gICAgICAgIGVsZW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIHNwZWMgKVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGVsZW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggc3BlYy50YWdOYW1lIClcblxuICAgICAgICB1cGRhdGVQcm9wZXJ0aWVzKCB3aW5kb3csIGVsZW1lbnQsIHNwZWMgKVxuXG4gICAgICAgIGZvciAoIGxldCBpID0gMCwgbGVuID0gc3BlYy5jaGlsZHJlbi5sZW5ndGg7IGkgPCBsZW47IGkrKyApIHtcbiAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQoIGNyZWF0ZU5vZGVGcm9tKCB3aW5kb3csIHNwZWMuY2hpbGRyZW5bIGkgXSApIClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBlbGVtZW50XG59XG5cbmV4cG9ydCBjb25zdCB1cGRhdGVDaGlsZHJlbiA9IGZ1bmN0aW9uICggd2luZG93OiBXaW5kb3csIG9sZE5vZGUsIHNwZWMgKSB7XG4gICAgbGV0IG9sZExlbmd0aCA9IG9sZE5vZGUuY2hpbGROb2Rlcy5sZW5ndGhcbiAgICBsZXQgbmV3TGVuZ3RoID0gc3BlYy5jaGlsZHJlbi5sZW5ndGhcblxuICAgIGZvciAoIGxldCBpMSA9IDA7IGkxIDwgbmV3TGVuZ3RoOyBpMSsrICkge1xuICAgICAgICBwYXRjaCggd2luZG93LCBvbGROb2RlLCBvbGROb2RlLmNoaWxkTm9kZXNbIGkxIF0sIHNwZWMuY2hpbGRyZW5bIGkxIF0gKVxuICAgIH1cblxuICAgIGZvciAoIGxldCBpMiA9IDA7IGkyIDwgKG9sZExlbmd0aCAtIG5ld0xlbmd0aCk7IGkyKysgKSB7XG4gICAgICAgIG9sZE5vZGUucmVtb3ZlQ2hpbGQoIG9sZE5vZGUubGFzdENoaWxkIClcbiAgICB9XG59XG5cbmNvbnN0IHVwZGF0ZVByb3BlcnRpZXMgPSBmdW5jdGlvbiAoIHdpbmRvdzogV2luZG93LCBvbGROb2RlLCBzcGVjICkge1xuICAgIGlmICggb2xkTm9kZS5fcHJvcGVydGllcyApIHtcbiAgICAgICAgZm9yICggbGV0IHByb3BOYW1lIG9mIG9sZE5vZGUuX3Byb3BlcnRpZXMgKSB7XG4gICAgICAgICAgICBpZiAoIHByb3BOYW1lLnN0YXJ0c1dpdGgoIFwib25cIiApIClcbiAgICAgICAgICAgICAgICBvbGROb2RlWyBwcm9wTmFtZSBdID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9sZE5vZGUuX3Byb3BlcnRpZXMgPSBbXVxuXG4gICAgZm9yICggbGV0IHByb3BOYW1lIGluIHNwZWMucHJvcGVydGllcyApIHtcbiAgICAgICAgb2xkTm9kZS5fcHJvcGVydGllcy5wdXNoKCBwcm9wTmFtZSApXG4gICAgICAgIGlmICggcHJvcE5hbWUuc3RhcnRzV2l0aCggXCJvblwiICkgKSB7XG4gICAgICAgICAgICBvbGROb2RlWyBwcm9wTmFtZSBdID0gKGZ1bmN0aW9uICggWyBuYW1lLCBkYXRhIF0gKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICggZXZlbnQgKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGx5bXBoX2NvbmZpZyA9IHdpbmRvd1sgXCJseW1waENvbmZpZ1wiIF0gfHwgeyBhY3Rpb25OYW1lOiBcImFjdGlvblwiIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IHdpbmRvd1sgXCJDdXN0b21FdmVudFwiIF0oIGx5bXBoX2NvbmZpZy5hY3Rpb25OYW1lLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWlsOiB7IG5hbWUsIGRhdGEsIGV2ZW50IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnViYmxlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWxhYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICB9IClcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pKCBzcGVjLnByb3BlcnRpZXNbIHByb3BOYW1lIF0gKVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCBvbGROb2RlWyBwcm9wTmFtZSBdICE9PSBzcGVjLnByb3BlcnRpZXNbIHByb3BOYW1lIF0gKSB7XG4gICAgICAgICAgICBvbGROb2RlWyBwcm9wTmFtZSBdID0gc3BlYy5wcm9wZXJ0aWVzWyBwcm9wTmFtZSBdXG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCBwYXRjaCA9IGZ1bmN0aW9uICggd2luZG93OiBXaW5kb3csIHBhcmVudCwgb2xkTm9kZSwgc3BlYyApIHtcbiAgICBpZiAoIG9sZE5vZGUgPT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgcGFyZW50LmFwcGVuZENoaWxkKCBjcmVhdGVOb2RlRnJvbSggd2luZG93LCBzcGVjICkgKVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKCB0eXBlb2Ygc3BlYyA9PT0gXCJzdHJpbmdcIiAmJiBvbGROb2RlLm5vZGVUeXBlID09PSBOb2RlLlRFWFRfTk9ERSApIHtcbiAgICAgICAgICAgIGlmICggb2xkTm9kZS5ub2RlVmFsdWUgIT09IHNwZWMgKSB7XG4gICAgICAgICAgICAgICAgb2xkTm9kZS5ub2RlVmFsdWUgPSBzcGVjXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIG9sZE5vZGUubm9kZVR5cGUgPT09IE5vZGUuRUxFTUVOVF9OT0RFICkge1xuICAgICAgICAgICAgaWYgKCBvbGROb2RlLnRhZ05hbWUgIT09IHNwZWMudGFnTmFtZSApIHtcbiAgICAgICAgICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKCBjcmVhdGVOb2RlRnJvbSggd2luZG93LCBzcGVjICksIG9sZE5vZGUgKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlUHJvcGVydGllcyggd2luZG93LCBvbGROb2RlLCBzcGVjIClcbiAgICAgICAgICAgICAgICB1cGRhdGVDaGlsZHJlbiggd2luZG93LCBvbGROb2RlLCBzcGVjIClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICggb2xkTm9kZS5ub2RlVHlwZSA9PT0gTm9kZS5URVhUX05PREUgKSB7XG4gICAgICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKCBjcmVhdGVOb2RlRnJvbSggd2luZG93LCBzcGVjICksIG9sZE5vZGUgKVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgXCJ1bmtub3duIG5vZGVcIlxuICAgICAgICB9XG4gICAgfVxufVxuIl19
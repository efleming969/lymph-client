var createNodeFrom = function (window, spec) {
    var element = null;
    if (typeof spec === "string") {
        element = window.document.createTextNode(spec);
    }
    else {
        element = window.document.createElement(spec.tagName);
        updateProperties(window, element, spec);
        for (var i = 0, len = spec.children.length; i < len; i++) {
            element.appendChild(createNodeFrom(window, spec.children[i]));
        }
    }
    return element;
};
export var updateChildren = function (window, oldNode, spec) {
    var oldLength = oldNode.childNodes.length;
    var newLength = spec.children.length;
    for (var i1 = 0; i1 < newLength; i1++) {
        patch(window, oldNode, oldNode.childNodes[i1], spec.children[i1]);
    }
    for (var i2 = 0; i2 < (oldLength - newLength); i2++) {
        oldNode.removeChild(oldNode.lastChild);
    }
};
var updateProperties = function (window, oldNode, spec) {
    if (oldNode._properties) {
        for (var _i = 0, _a = oldNode._properties; _i < _a.length; _i++) {
            var propName = _a[_i];
            if (propName.startsWith("on"))
                oldNode[propName] = function () {
                };
        }
    }
    oldNode._properties = [];
    for (var propName in spec.properties) {
        oldNode._properties.push(propName);
        if (propName.startsWith("on")) {
            oldNode[propName] = (function (_a) {
                var name = _a[0], data = _a[1];
                return function (event) {
                    var lymph_config = window["lymphConfig"] || { actionName: "action" };
                    this.dispatchEvent(new window["CustomEvent"](lymph_config.actionName, {
                        detail: { name: name, data: data, event: event },
                        bubbles: true,
                        cancelable: true
                    }));
                };
            })(spec.properties[propName]);
        }
        else if (oldNode[propName] !== spec.properties[propName]) {
            oldNode[propName] = spec.properties[propName];
        }
    }
};
export var patch = function (window, parent, oldNode, spec) {
    if (oldNode === undefined) {
        parent.appendChild(createNodeFrom(window, spec));
    }
    else {
        if (typeof spec === "string" && oldNode.nodeType === Node.TEXT_NODE) {
            if (oldNode.nodeValue !== spec) {
                oldNode.nodeValue = spec;
            }
        }
        else if (oldNode.nodeType === Node.ELEMENT_NODE) {
            if (oldNode.tagName !== spec.tagName) {
                parent.replaceChild(createNodeFrom(window, spec), oldNode);
            }
            else {
                updateProperties(window, oldNode, spec);
                updateChildren(window, oldNode, spec);
            }
        }
        else if (oldNode.nodeType === Node.TEXT_NODE) {
            parent.replaceChild(createNodeFrom(window, spec), oldNode);
        }
        else {
            throw "unknown node";
        }
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRE9NLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL0RPTS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFNLGNBQWMsR0FBRyxVQUFXLE1BQWMsRUFBRSxJQUFJO0lBQ2xELElBQUksT0FBTyxHQUFHLElBQUksQ0FBQTtJQUVsQixFQUFFLENBQUMsQ0FBRSxPQUFPLElBQUksS0FBSyxRQUFTLENBQUMsQ0FBQyxDQUFDO1FBQzdCLE9BQU8sR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBRSxJQUFJLENBQUUsQ0FBQTtJQUNwRCxDQUFDO0lBQUMsSUFBSSxDQUFDLENBQUM7UUFDSixPQUFPLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBRSxDQUFBO1FBRXZELGdCQUFnQixDQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFFLENBQUE7UUFFekMsR0FBRyxDQUFDLENBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsRUFBRSxFQUFHLENBQUM7WUFDekQsT0FBTyxDQUFDLFdBQVcsQ0FBRSxjQUFjLENBQUUsTUFBTSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUUsQ0FBQyxDQUFFLENBQUUsQ0FBRSxDQUFBO1FBQ3ZFLENBQUM7SUFDTCxDQUFDO0lBRUQsTUFBTSxDQUFDLE9BQU8sQ0FBQTtBQUNsQixDQUFDLENBQUE7QUFFRCxNQUFNLENBQUMsSUFBTSxjQUFjLEdBQUcsVUFBVyxNQUFjLEVBQUUsT0FBTyxFQUFFLElBQUk7SUFDbEUsSUFBSSxTQUFTLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUE7SUFDekMsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUE7SUFFcEMsR0FBRyxDQUFDLENB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OiBXaW5kb3csIHNwZWMgKSB7XG4gICAgbGV0IGVsZW1lbnQgPSBudWxsXG5cbiAgICBpZiAoIHR5cGVvZiBzcGVjID09PSBcInN0cmluZ1wiICkge1xuICAgICAgICBlbGVtZW50ID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCBzcGVjIClcbiAgICB9IGVsc2Uge1xuICAgICAgICBlbGVtZW50ID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIHNwZWMudGFnTmFtZSApXG5cbiAgICAgICAgdXBkYXRlUHJvcGVydGllcyggd2luZG93LCBlbGVtZW50LCBzcGVjIClcblxuICAgICAgICBmb3IgKCBsZXQgaSA9IDAsIGxlbiA9IHNwZWMuY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbGVuOyBpKysgKSB7XG4gICAgICAgICAgICBlbGVtZW50LmFwcGVuZENoaWxkKCBjcmVhdGVOb2RlRnJvbSggd2luZG93LCBzcGVjLmNoaWxkcmVuWyBpIF0gKSApXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZWxlbWVudFxufVxuXG5leHBvcnQgY29uc3QgdXBkYXRlQ2hpbGRyZW4gPSBmdW5jdGlvbiAoIHdpbmRvdzogV2luZG93LCBvbGROb2RlLCBzcGVjICkge1xuICAgIGxldCBvbGRMZW5ndGggPSBvbGROb2RlLmNoaWxkTm9kZXMubGVuZ3RoXG4gICAgbGV0IG5ld0xlbmd0aCA9IHNwZWMuY2hpbGRyZW4ubGVuZ3RoXG5cbiAgICBmb3IgKCBsZXQgaTEgPSAwOyBpMSA8IG5ld0xlbmd0aDsgaTErKyApIHtcbiAgICAgICAgcGF0Y2goIHdpbmRvdywgb2xkTm9kZSwgb2xkTm9kZS5jaGlsZE5vZGVzWyBpMSBdLCBzcGVjLmNoaWxkcmVuWyBpMSBdIClcbiAgICB9XG5cbiAgICBmb3IgKCBsZXQgaTIgPSAwOyBpMiA8IChvbGRMZW5ndGggLSBuZXdMZW5ndGgpOyBpMisrICkge1xuICAgICAgICBvbGROb2RlLnJlbW92ZUNoaWxkKCBvbGROb2RlLmxhc3RDaGlsZCApXG4gICAgfVxufVxuXG5jb25zdCB1cGRhdGVQcm9wZXJ0aWVzID0gZnVuY3Rpb24gKCB3aW5kb3c6IFdpbmRvdywgb2xkTm9kZSwgc3BlYyApIHtcbiAgICBpZiAoIG9sZE5vZGUuX3Byb3BlcnRpZXMgKSB7XG4gICAgICAgIGZvciAoIGxldCBwcm9wTmFtZSBvZiBvbGROb2RlLl9wcm9wZXJ0aWVzICkge1xuICAgICAgICAgICAgaWYgKCBwcm9wTmFtZS5zdGFydHNXaXRoKCBcIm9uXCIgKSApXG4gICAgICAgICAgICAgICAgb2xkTm9kZVsgcHJvcE5hbWUgXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvbGROb2RlLl9wcm9wZXJ0aWVzID0gW11cblxuICAgIGZvciAoIGxldCBwcm9wTmFtZSBpbiBzcGVjLnByb3BlcnRpZXMgKSB7XG4gICAgICAgIG9sZE5vZGUuX3Byb3BlcnRpZXMucHVzaCggcHJvcE5hbWUgKVxuICAgICAgICBpZiAoIHByb3BOYW1lLnN0YXJ0c1dpdGgoIFwib25cIiApICkge1xuICAgICAgICAgICAgb2xkTm9kZVsgcHJvcE5hbWUgXSA9IChmdW5jdGlvbiAoIFsgbmFtZSwgZGF0YSBdICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoIGV2ZW50ICkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBseW1waF9jb25maWcgPSB3aW5kb3dbIFwibHltcGhDb25maWdcIiBdIHx8IHsgYWN0aW9uTmFtZTogXCJhY3Rpb25cIiB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyB3aW5kb3dbIFwiQ3VzdG9tRXZlbnRcIiBdKCBseW1waF9jb25maWcuYWN0aW9uTmFtZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbDogeyBuYW1lLCBkYXRhLCBldmVudCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1YmJsZXM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsYWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSApXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSggc3BlYy5wcm9wZXJ0aWVzWyBwcm9wTmFtZSBdIClcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICggb2xkTm9kZVsgcHJvcE5hbWUgXSAhPT0gc3BlYy5wcm9wZXJ0aWVzWyBwcm9wTmFtZSBdICkge1xuICAgICAgICAgICAgb2xkTm9kZVsgcHJvcE5hbWUgXSA9IHNwZWMucHJvcGVydGllc1sgcHJvcE5hbWUgXVxuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgcGF0Y2ggPSBmdW5jdGlvbiAoIHdpbmRvdzogV2luZG93LCBwYXJlbnQsIG9sZE5vZGUsIHNwZWMgKSB7XG4gICAgaWYgKCBvbGROb2RlID09PSB1bmRlZmluZWQgKSB7XG4gICAgICAgIHBhcmVudC5hcHBlbmRDaGlsZCggY3JlYXRlTm9kZUZyb20oIHdpbmRvdywgc3BlYyApIClcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmICggdHlwZW9mIHNwZWMgPT09IFwic3RyaW5nXCIgJiYgb2xkTm9kZS5ub2RlVHlwZSA9PT0gTm9kZS5URVhUX05PREUgKSB7XG4gICAgICAgICAgICBpZiAoIG9sZE5vZGUubm9kZVZhbHVlICE9PSBzcGVjICkge1xuICAgICAgICAgICAgICAgIG9sZE5vZGUubm9kZVZhbHVlID0gc3BlY1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCBvbGROb2RlLm5vZGVUeXBlID09PSBOb2RlLkVMRU1FTlRfTk9ERSApIHtcbiAgICAgICAgICAgIGlmICggb2xkTm9kZS50YWdOYW1lICE9PSBzcGVjLnRhZ05hbWUgKSB7XG4gICAgICAgICAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCggY3JlYXRlTm9kZUZyb20oIHdpbmRvdywgc3BlYyApLCBvbGROb2RlIClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHVwZGF0ZVByb3BlcnRpZXMoIHdpbmRvdywgb2xkTm9kZSwgc3BlYyApXG4gICAgICAgICAgICAgICAgdXBkYXRlQ2hpbGRyZW4oIHdpbmRvdywgb2xkTm9kZSwgc3BlYyApXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIG9sZE5vZGUubm9kZVR5cGUgPT09IE5vZGUuVEVYVF9OT0RFICkge1xuICAgICAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCggY3JlYXRlTm9kZUZyb20oIHdpbmRvdywgc3BlYyApLCBvbGROb2RlIClcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IFwidW5rbm93biBub2RlXCJcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==
import HTTP from "./HTTP";
import { createFakeFetch } from "./TestUtils";
describe("posting data to json endpoint", function () {
    test("200 response returns de-serialized data", function () {
        const http = new HTTP(createFakeFetch("/foobar", { status: 200, data: { name: "foo" } }));
        return http.post("/foobar", {}).then(function (response_data) {
            expect(response_data).toEqual({ name: "foo" });
        });
    });
    test("posted data is serialized", function () {
        const fakeFetch = createFakeFetch("/foo", {});
        const http = new HTTP(fakeFetch);
        return http.post("/foo", { text: "foobar" }).then(function (response) {
            expect(fakeFetch.mock.calls[0][1].body)
                .toEqual(JSON.stringify({ text: "foobar" }));
        });
    });
    test("authentication token is passed, when given", function () {
        const fakeFetch = createFakeFetch("/foo", {});
        const http = new HTTP(fakeFetch);
        return http.post("/foo", {}, "jwt").then(function (response) {
            expect(fakeFetch.mock.calls[0][1].headers["Authorization"])
                .toEqual("jwt");
        });
    });
    test("no authentication token is passed, when not given", function () {
        const fakeFetch = createFakeFetch("/foo", {});
        const http = new HTTP(fakeFetch);
        return http.post("/foo", {}).then(function (response) {
            expect(fakeFetch.mock.calls[0][1].headers["Authorization"])
                .toBeUndefined();
        });
    });
    test("bad request are handled", function () {
        const fakeFetch = createFakeFetch("/foo", {
            status: 400,
            data: "error_message"
        });
        const http = new HTTP(fakeFetch);
        return http.post("/foo", {}).then(function (response) {
            throw Error("did not handle bad request");
        }, function (error) {
            expect(error).toEqual("error_message");
        });
    });
});
describe("querying data from a json endpoint", function () {
    test("query response data is returned", function () {
        const http = new HTTP(createFakeFetch("/foobar", { status: 200, data: { name: "foo" } }));
        return http.get("/foobar").then(function (response) {
            expect(response).toEqual({ name: "foo" });
        });
    });
    test("authentication token is passed, when given", function () {
        const fakeFetch = createFakeFetch("/foo", {});
        const http = new HTTP(fakeFetch);
        return http.get("/foo", "jwt").then(function (response) {
            expect(fakeFetch.mock.calls[0][1].headers["Authorization"])
                .toEqual("jwt");
        });
    });
    test("no authentication token is passed, when not given", function () {
        const fakeFetch = createFakeFetch("/foo", {});
        const http = new HTTP(fakeFetch);
        return http.get("/foo").then(function (response) {
            expect(fakeFetch.mock.calls[0][1].headers["Authorization"])
                .toBeUndefined();
        });
    });
    test("bad request are handled", function () {
        const fakeFetch = createFakeFetch("/foo", {
            status: 400,
            data: "error_message"
        });
        const http = new HTTP(fakeFetch);
        return http.get("/foo").then(function (response) {
            throw Error("did not handle bad request");
        }, function (error) {
            expect(error).toEqual("error_message");
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSFRUUC50ZXN0cy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9IVFRQLnRlc3RzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sSUFBSSxNQUFNLFFBQVEsQ0FBQTtBQUN6QixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sYUFBYSxDQUFBO0FBRTdDLFFBQVEsQ0FBRSwrQkFBK0IsRUFBRTtJQUV2QyxJQUFJLENBQUUseUNBQXlDLEVBQUU7UUFDN0MsTUFBTSxJQUFJLEdBQUcsSUFBSSxJQUFJLENBQ2pCLGVBQWUsQ0FBRSxTQUFTLEVBQUUsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFFLENBQUUsQ0FBQTtRQUUxRSxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBRSxTQUFTLEVBQUUsRUFBRSxDQUFFLENBQUMsSUFBSSxDQUFFLFVBQVcsYUFBYTtZQUM1RCxNQUFNLENBQUUsYUFBYSxDQUFFLENBQUMsT0FBTyxDQUFFLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFFLENBQUE7UUFDdEQsQ0FBQyxDQUFFLENBQUE7SUFDUCxDQUFDLENBQUUsQ0FBQTtJQUVILElBQUksQ0FBRSwyQkFBMkIsRUFBRTtRQUMvQixNQUFNLFNBQVMsR0FBRyxlQUFlLENBQUUsTUFBTSxFQUFFLEVBQUUsQ0FBRSxDQUFBO1FBQy9DLE1BQU0sSUFBSSxHQUFHLElBQUksSUFBSSxDQUFFLFNBQVMsQ0FBRSxDQUFBO1FBRWxDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFFLE1BQU0sRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBRSxDQUFDLElBQUksQ0FBRSxVQUFXLFFBQVE7WUFDcEUsTUFBTSxDQUFFLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFFLENBQUMsQ0FBRSxDQUFFLENBQUMsQ0FBRSxDQUFDLElBQUksQ0FBRTtpQkFD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RSxVQUFXLFFBQVE7WUFDL0MsTUFBTSxLQUFLLENBQUUsNEJBQTRCLENBQUUsQ0FBQTtRQUMvQyxDQUFDLEVBQUUsVUFBVyxLQUFLO1lBQ2YsTUFBTSxDQUFFLEtBQUssQ0FBRSxDQUFDLE9BQU8sQ0FBRSxlQUFlLENBQUUsQ0FBQTtRQUM5QyxDQUFDLENBQUUsQ0FBQTtJQUNQLENBQUMsQ0FBRSxDQUFBO0FBQ1AsQ0FBQyxDQUFFLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSFRUUCBmcm9tIFwiLi9IVFRQXCJcbmltcG9ydCB7IGNyZWF0ZUZha2VGZXRjaCB9IGZyb20gXCIuL1Rlc3RVdGlsc1wiXG5cbmRlc2NyaWJlKCBcInBvc3RpbmcgZGF0YSB0byBqc29uIGVuZHBvaW50XCIsIGZ1bmN0aW9uICgpIHtcblxuICAgIHRlc3QoIFwiMjAwIHJlc3BvbnNlIHJldHVybnMgZGUtc2VyaWFsaXplZCBkYXRhXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc3QgaHR0cCA9IG5ldyBIVFRQKFxuICAgICAgICAgICAgY3JlYXRlRmFrZUZldGNoKCBcIi9mb29iYXJcIiwgeyBzdGF0dXM6IDIwMCwgZGF0YTogeyBuYW1lOiBcImZvb1wiIH0gfSApIClcblxuICAgICAgICByZXR1cm4gaHR0cC5wb3N0KCBcIi9mb29iYXJcIiwge30gKS50aGVuKCBmdW5jdGlvbiAoIHJlc3BvbnNlX2RhdGEgKSB7XG4gICAgICAgICAgICBleHBlY3QoIHJlc3BvbnNlX2RhdGEgKS50b0VxdWFsKCB7IG5hbWU6IFwiZm9vXCIgfSApXG4gICAgICAgIH0gKVxuICAgIH0gKVxuXG4gICAgdGVzdCggXCJwb3N0ZWQgZGF0YSBpcyBzZXJpYWxpemVkXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc3QgZmFrZUZldGNoID0gY3JlYXRlRmFrZUZldGNoKCBcIi9mb29cIiwge30gKVxuICAgICAgICBjb25zdCBodHRwID0gbmV3IEhUVFAoIGZha2VGZXRjaCApXG5cbiAgICAgICAgcmV0dXJuIGh0dHAucG9zdCggXCIvZm9vXCIsIHsgdGV4dDogXCJmb29iYXJcIiB9ICkudGhlbiggZnVuY3Rpb24gKCByZXNwb25zZSApIHtcbiAgICAgICAgICAgIGV4cGVjdCggZmFrZUZldGNoLm1vY2suY2FsbHNbIDAgXVsgMSBdLmJvZHkgKVxuICAgICAgICAgICAgICAgIC50b0VxdWFsKCBKU09OLnN0cmluZ2lmeSggeyB0ZXh0OiBcImZvb2JhclwiIH0gKSApXG4gICAgICAgIH0gKVxuICAgIH0gKVxuXG4gICAgdGVzdCggXCJhdXRoZW50aWNhdGlvbiB0b2tlbiBpcyBwYXNzZWQsIHdoZW4gZ2l2ZW5cIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zdCBmYWtlRmV0Y2ggPSBjcmVhdGVGYWtlRmV0Y2goIFwiL2Zvb1wiLCB7fSApXG4gICAgICAgIGNvbnN0IGh0dHAgPSBuZXcgSFRUUCggZmFrZUZldGNoIClcblxuICAgICAgICByZXR1cm4gaHR0cC5wb3N0KCBcIi9mb29cIiwge30sIFwiand0XCIgKS50aGVuKCBmdW5jdGlvbiAoIHJlc3BvbnNlICkge1xuICAgICAgICAgICAgZXhwZWN0KCBmYWtlRmV0Y2gubW9jay5jYWxsc1sgMCBdWyAxIF0uaGVhZGVyc1sgXCJBdXRob3JpemF0aW9uXCIgXSApXG4gICAgICAgICAgICAgICAgLnRvRXF1YWwoIFwiand0XCIgKVxuICAgICAgICB9IClcbiAgICB9IClcblxuICAgIHRlc3QoIFwibm8gYXV0aGVudGljYXRpb24gdG9rZW4gaXMgcGFzc2VkLCB3aGVuIG5vdCBnaXZlblwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IGZha2VGZXRjaCA9IGNyZWF0ZUZha2VGZXRjaCggXCIvZm9vXCIsIHt9IClcbiAgICAgICAgY29uc3QgaHR0cCA9IG5ldyBIVFRQKCBmYWtlRmV0Y2ggKVxuXG4gICAgICAgIHJldHVybiBodHRwLnBvc3QoIFwiL2Zvb1wiLCB7fSApLnRoZW4oIGZ1bmN0aW9uICggcmVzcG9uc2UgKSB7XG4gICAgICAgICAgICBleHBlY3QoIGZha2VGZXRjaC5tb2NrLmNhbGxzWyAwIF1bIDEgXS5oZWFkZXJzWyBcIkF1dGhvcml6YXRpb25cIiBdIClcbiAgICAgICAgICAgICAgICAudG9CZVVuZGVmaW5lZCgpXG4gICAgICAgIH0gKVxuICAgIH0gKVxuXG4gICAgdGVzdCggXCJiYWQgcmVxdWVzdCBhcmUgaGFuZGxlZFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IGZha2VGZXRjaCA9IGNyZWF0ZUZha2VGZXRjaCggXCIvZm9vXCIsIHtcbiAgICAgICAgICAgIHN0YXR1czogNDAwLFxuICAgICAgICAgICAgZGF0YTogXCJlcnJvcl9tZXNzYWdlXCJcbiAgICAgICAgfSApXG5cbiAgICAgICAgY29uc3QgaHR0cCA9IG5ldyBIVFRQKCBmYWtlRmV0Y2ggKVxuXG4gICAgICAgIHJldHVybiBodHRwLnBvc3QoIFwiL2Zvb1wiLCB7fSApLnRoZW4oIGZ1bmN0aW9uICggcmVzcG9uc2UgKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvciggXCJkaWQgbm90IGhhbmRsZSBiYWQgcmVxdWVzdFwiIClcbiAgICAgICAgfSwgZnVuY3Rpb24gKCBlcnJvciApIHtcbiAgICAgICAgICAgIGV4cGVjdCggZXJyb3IgKS50b0VxdWFsKCBcImVycm9yX21lc3NhZ2VcIiApXG4gICAgICAgIH0gKVxuICAgIH0gKVxufSApXG5cbmRlc2NyaWJlKCBcInF1ZXJ5aW5nIGRhdGEgZnJvbSBhIGpzb24gZW5kcG9pbnRcIiwgZnVuY3Rpb24gKCkge1xuXG4gICAgdGVzdCggXCJxdWVyeSByZXNwb25zZSBkYXRhIGlzIHJldHVybmVkXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc3QgaHR0cCA9IG5ldyBIVFRQKFxuICAgICAgICAgICAgY3JlYXRlRmFrZUZldGNoKCBcIi9mb29iYXJcIiwgeyBzdGF0dXM6IDIwMCwgZGF0YTogeyBuYW1lOiBcImZvb1wiIH0gfSApIClcblxuICAgICAgICByZXR1cm4gaHR0cC5nZXQoIFwiL2Zvb2JhclwiICkudGhlbiggZnVuY3Rpb24gKCByZXNwb25zZSApIHtcbiAgICAgICAgICAgIGV4cGVjdCggcmVzcG9uc2UgKS50b0VxdWFsKCB7IG5hbWU6IFwiZm9vXCIgfSApXG4gICAgICAgIH0gKVxuICAgIH0gKVxuXG4gICAgdGVzdCggXCJhdXRoZW50aWNhdGlvbiB0b2tlbiBpcyBwYXNzZWQsIHdoZW4gZ2l2ZW5cIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zdCBmYWtlRmV0Y2ggPSBjcmVhdGVGYWtlRmV0Y2goIFwiL2Zvb1wiLCB7fSApXG4gICAgICAgIGNvbnN0IGh0dHAgPSBuZXcgSFRUUCggZmFrZUZldGNoIClcblxuICAgICAgICByZXR1cm4gaHR0cC5nZXQoIFwiL2Zvb1wiLCBcImp3dFwiICkudGhlbiggZnVuY3Rpb24gKCByZXNwb25zZSApIHtcbiAgICAgICAgICAgIGV4cGVjdCggZmFrZUZldGNoLm1vY2suY2FsbHNbIDAgXVsgMSBdLmhlYWRlcnNbIFwiQXV0aG9yaXphdGlvblwiIF0gKVxuICAgICAgICAgICAgICAgIC50b0VxdWFsKCBcImp3dFwiIClcbiAgICAgICAgfSApXG4gICAgfSApXG5cbiAgICB0ZXN0KCBcIm5vIGF1dGhlbnRpY2F0aW9uIHRva2VuIGlzIHBhc3NlZCwgd2hlbiBub3QgZ2l2ZW5cIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zdCBmYWtlRmV0Y2ggPSBjcmVhdGVGYWtlRmV0Y2goIFwiL2Zvb1wiLCB7fSApXG4gICAgICAgIGNvbnN0IGh0dHAgPSBuZXcgSFRUUCggZmFrZUZldGNoIClcblxuICAgICAgICByZXR1cm4gaHR0cC5nZXQoIFwiL2Zvb1wiICkudGhlbiggZnVuY3Rpb24gKCByZXNwb25zZSApIHtcbiAgICAgICAgICAgIGV4cGVjdCggZmFrZUZldGNoLm1vY2suY2FsbHNbIDAgXVsgMSBdLmhlYWRlcnNbIFwiQXV0aG9yaXphdGlvblwiIF0gKVxuICAgICAgICAgICAgICAgIC50b0JlVW5kZWZpbmVkKClcbiAgICAgICAgfSApXG4gICAgfSApXG5cbiAgICB0ZXN0KCBcImJhZCByZXF1ZXN0IGFyZSBoYW5kbGVkXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc3QgZmFrZUZldGNoID0gY3JlYXRlRmFrZUZldGNoKCBcIi9mb29cIiwge1xuICAgICAgICAgICAgc3RhdHVzOiA0MDAsXG4gICAgICAgICAgICBkYXRhOiBcImVycm9yX21lc3NhZ2VcIlxuICAgICAgICB9IClcblxuICAgICAgICBjb25zdCBodHRwID0gbmV3IEhUVFAoIGZha2VGZXRjaCApXG5cbiAgICAgICAgcmV0dXJuIGh0dHAuZ2V0KCBcIi9mb29cIiApLnRoZW4oIGZ1bmN0aW9uICggcmVzcG9uc2UgKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvciggXCJkaWQgbm90IGhhbmRsZSBiYWQgcmVxdWVzdFwiIClcbiAgICAgICAgfSwgZnVuY3Rpb24gKCBlcnJvciApIHtcbiAgICAgICAgICAgIGV4cGVjdCggZXJyb3IgKS50b0VxdWFsKCBcImVycm9yX21lc3NhZ2VcIiApXG4gICAgICAgIH0gKVxuICAgIH0gKVxufSApXG4iXX0=
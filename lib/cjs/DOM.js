"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var createNodeFrom = function (window, spec) {
    var element = null;
    if (typeof spec === "string") {
        element = window.document.createTextNode(spec);
    }
    else {
        element = window.document.createElement(spec.tagName);
        updateProperties(window, element, spec);
        for (var i = 0, len = spec.children.length; i < len; i++) {
            element.appendChild(createNodeFrom(window, spec.children[i]));
        }
    }
    return element;
};
exports.updateChildren = function (window, oldNode, spec) {
    var oldLength = oldNode.childNodes.length;
    var newLength = spec.children.length;
    for (var i1 = 0; i1 < newLength; i1++) {
        exports.patch(window, oldNode, oldNode.childNodes[i1], spec.children[i1]);
    }
    for (var i2 = 0; i2 < (oldLength - newLength); i2++) {
        oldNode.removeChild(oldNode.lastChild);
    }
};
var updateProperties = function (window, oldNode, spec) {
    if (oldNode._properties) {
        for (var _i = 0, _a = oldNode._properties; _i < _a.length; _i++) {
            var propName = _a[_i];
            if (propName.startsWith("on"))
                oldNode[propName] = function () {
                };
        }
    }
    oldNode._properties = [];
    for (var propName in spec.properties) {
        oldNode._properties.push(propName);
        if (propName.startsWith("on")) {
            oldNode[propName] = (function (_a) {
                var name = _a[0], data = _a[1];
                return function (event) {
                    var lymph_config = window["lymphConfig"] || { actionName: "action" };
                    this.dispatchEvent(new window["CustomEvent"](lymph_config.actionName, {
                        detail: { name: name, data: data, event: event },
                        bubbles: true,
                        cancelable: true
                    }));
                };
            })(spec.properties[propName]);
        }
        else if (oldNode[propName] !== spec.properties[propName]) {
            oldNode[propName] = spec.properties[propName];
        }
    }
};
exports.patch = function (window, parent, oldNode, spec) {
    if (oldNode === undefined) {
        parent.appendChild(createNodeFrom(window, spec));
    }
    else {
        if (typeof spec === "string" && oldNode.nodeType === Node.TEXT_NODE) {
            if (oldNode.nodeValue !== spec) {
                oldNode.nodeValue = spec;
            }
        }
        else if (oldNode.nodeType === Node.ELEMENT_NODE) {
            if (oldNode.tagName !== spec.tagName) {
                parent.replaceChild(createNodeFrom(window, spec), oldNode);
            }
            else {
                updateProperties(window, oldNode, spec);
                exports.updateChildren(window, oldNode, spec);
            }
        }
        else if (oldNode.nodeType === Node.TEXT_NODE) {
            parent.replaceChild(createNodeFrom(window, spec), oldNode);
        }
        else {
            throw "unknown node";
        }
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRE9NLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL0RPTS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLElBQU0sY0FBYyxHQUFHLFVBQVcsTUFBYyxFQUFFLElBQUk7SUFDbEQsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFBO0lBRWxCLEVBQUUsQ0FBQyxDQUFFLE9BQU8sSUFBSSxLQUFLLFFBQVMsQ0FBQyxDQUFDLENBQUM7UUFDN0IsT0FBTyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFFLElBQUksQ0FBRSxDQUFBO0lBQ3BELENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNKLE9BQU8sR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBRSxJQUFJLENBQUMsT0FBTyxDQUFFLENBQUE7UUFFdkQsZ0JBQWdCLENBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUUsQ0FBQTtRQUV6QyxHQUFHLENBQUMsQ0FBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUcsQ0FBQztZQUN6RCxPQUFPLENBQUMsV0FBVyxDQUFFLGNBQWMsQ0FBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBRSxDQUFDLENBQUUsQ0FBRSxDQUFFLENBQUE7UUFDdkUsQ0FBQztJQUNMLENBQUM7SUFFRCxNQUFNLENBQUMsT0FBTyxDQUFBO0FBQ2xCLENBQUMsQ0FBQTtBQUVZLFFBQUEsY0FBYyxHQUFHLFVBQVcsTUFBYyxFQUFFLE9BQU8sRUFBRSxJQUFJO0lBQ2xFLElBQUksU0FBUyxHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFBO0lBQ3pDLElBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFBO0lBRXBDLEdBQUcsQ0FBQyxDQUFFLElBQUks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T0FBTyxJQUFJLEtBQUssUUFBUSxJQUFJLE9BQU8sQ0FBQyxRQUFRLEtBQUssSUFBSSxDQUFDLFNBQVUsQ0FBQyxDQUFDLENBQUM7WUFDcEUsRUFBRSxDQUFDLENBQUUsT0FBTyxDQUFDLFNBQVMsS0FBSyxJQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUMvQixPQUFPLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQTtZQUM1QixDQUFDO1FBQ0wsQ0FBQztRQUNELElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBRSxPQUFPLENBQUMsUUFBUSxLQUFLLElBQUksQ0FBQyxZQUFhLENBQUMsQ0FBQyxDQUFDO1lBQ2hELEVBQUUsQ0FBQyxDQUFFLE9BQU8sQ0FBQyxPQUFPLEtBQUssSUFBSSxDQUFDLE9BQVEsQ0FBQyxDQUFDLENBQUM7Z0JBQ3JDLE1BQU0sQ0FBQyxZQUFZLENBQUUsY0FBYyxDQUFFLE1BQU0sRUFBRSxJQUFJLENBQUUsRUFBRSxPQUFPLENBQUUsQ0FBQTtZQUNsRSxDQUFDO1lBQ0QsSUFBSSxDQUFDLENBQUM7Z0JBQ0YsZ0JBQWdCLENBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUUsQ0FBQTtnQkFDekMsc0JBQWMsQ0FBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBRSxDQUFBO1lBQzNDLENBQUM7UUFDTCxDQUFDO1FBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFFLE9BQU8sQ0FBQyxRQUFRLEtBQUssSUFBSSxDQUFDLFNBQVUsQ0FBQyxDQUFDLENBQUM7WUFDN0MsTUFBTSxDQUFDLFlBQVksQ0FBRSxjQUFjLENBQUUsTUFBTSxFQUFFLElBQUksQ0FBRSxFQUFFLE9BQU8sQ0FBRSxDQUFBO1FBQ2xFLENBQUM7UUFDRCxJQUFJLENBQUMsQ0FBQztZQUNGLE1BQU0sY0FBYyxDQUFBO1FBQ3hCLENBQUM7SUFDTCxDQUFDO0FBQ0wsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgY3JlYXRlTm9kZUZyb20gPSBmdW5jdGlvbiAoIHdpbmRvdzogV2luZG93LCBzcGVjICkge1xuICAgIGxldCBlbGVtZW50ID0gbnVsbFxuXG4gICAgaWYgKCB0eXBlb2Ygc3BlYyA9PT0gXCJzdHJpbmdcIiApIHtcbiAgICAgICAgZWxlbWVudCA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggc3BlYyApXG4gICAgfSBlbHNlIHtcbiAgICAgICAgZWxlbWVudCA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCBzcGVjLnRhZ05hbWUgKVxuXG4gICAgICAgIHVwZGF0ZVByb3BlcnRpZXMoIHdpbmRvdywgZWxlbWVudCwgc3BlYyApXG5cbiAgICAgICAgZm9yICggbGV0IGkgPSAwLCBsZW4gPSBzcGVjLmNoaWxkcmVuLmxlbmd0aDsgaSA8IGxlbjsgaSsrICkge1xuICAgICAgICAgICAgZWxlbWVudC5hcHBlbmRDaGlsZCggY3JlYXRlTm9kZUZyb20oIHdpbmRvdywgc3BlYy5jaGlsZHJlblsgaSBdICkgKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGVsZW1lbnRcbn1cblxuZXhwb3J0IGNvbnN0IHVwZGF0ZUNoaWxkcmVuID0gZnVuY3Rpb24gKCB3aW5kb3c6IFdpbmRvdywgb2xkTm9kZSwgc3BlYyApIHtcbiAgICBsZXQgb2xkTGVuZ3RoID0gb2xkTm9kZS5jaGlsZE5vZGVzLmxlbmd0aFxuICAgIGxldCBuZXdMZW5ndGggPSBzcGVjLmNoaWxkcmVuLmxlbmd0aFxuXG4gICAgZm9yICggbGV0IGkxID0gMDsgaTEgPCBuZXdMZW5ndGg7IGkxKysgKSB7XG4gICAgICAgIHBhdGNoKCB3aW5kb3csIG9sZE5vZGUsIG9sZE5vZGUuY2hpbGROb2Rlc1sgaTEgXSwgc3BlYy5jaGlsZHJlblsgaTEgXSApXG4gICAgfVxuXG4gICAgZm9yICggbGV0IGkyID0gMDsgaTIgPCAob2xkTGVuZ3RoIC0gbmV3TGVuZ3RoKTsgaTIrKyApIHtcbiAgICAgICAgb2xkTm9kZS5yZW1vdmVDaGlsZCggb2xkTm9kZS5sYXN0Q2hpbGQgKVxuICAgIH1cbn1cblxuY29uc3QgdXBkYXRlUHJvcGVydGllcyA9IGZ1bmN0aW9uICggd2luZG93OiBXaW5kb3csIG9sZE5vZGUsIHNwZWMgKSB7XG4gICAgaWYgKCBvbGROb2RlLl9wcm9wZXJ0aWVzICkge1xuICAgICAgICBmb3IgKCBsZXQgcHJvcE5hbWUgb2Ygb2xkTm9kZS5fcHJvcGVydGllcyApIHtcbiAgICAgICAgICAgIGlmICggcHJvcE5hbWUuc3RhcnRzV2l0aCggXCJvblwiICkgKVxuICAgICAgICAgICAgICAgIG9sZE5vZGVbIHByb3BOYW1lIF0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgb2xkTm9kZS5fcHJvcGVydGllcyA9IFtdXG5cbiAgICBmb3IgKCBsZXQgcHJvcE5hbWUgaW4gc3BlYy5wcm9wZXJ0aWVzICkge1xuICAgICAgICBvbGROb2RlLl9wcm9wZXJ0aWVzLnB1c2goIHByb3BOYW1lIClcbiAgICAgICAgaWYgKCBwcm9wTmFtZS5zdGFydHNXaXRoKCBcIm9uXCIgKSApIHtcbiAgICAgICAgICAgIG9sZE5vZGVbIHByb3BOYW1lIF0gPSAoZnVuY3Rpb24gKCBbIG5hbWUsIGRhdGEgXSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCBldmVudCApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbHltcGhfY29uZmlnID0gd2luZG93WyBcImx5bXBoQ29uZmlnXCIgXSB8fCB7IGFjdGlvbk5hbWU6IFwiYWN0aW9uXCIgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgd2luZG93WyBcIkN1c3RvbUV2ZW50XCIgXSggbHltcGhfY29uZmlnLmFjdGlvbk5hbWUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWw6IHsgbmFtZSwgZGF0YSwgZXZlbnQgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidWJibGVzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbGFibGU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gKVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkoIHNwZWMucHJvcGVydGllc1sgcHJvcE5hbWUgXSApXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIG9sZE5vZGVbIHByb3BOYW1lIF0gIT09IHNwZWMucHJvcGVydGllc1sgcHJvcE5hbWUgXSApIHtcbiAgICAgICAgICAgIG9sZE5vZGVbIHByb3BOYW1lIF0gPSBzcGVjLnByb3BlcnRpZXNbIHByb3BOYW1lIF1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IHBhdGNoID0gZnVuY3Rpb24gKCB3aW5kb3c6IFdpbmRvdywgcGFyZW50LCBvbGROb2RlLCBzcGVjICkge1xuICAgIGlmICggb2xkTm9kZSA9PT0gdW5kZWZpbmVkICkge1xuICAgICAgICBwYXJlbnQuYXBwZW5kQ2hpbGQoIGNyZWF0ZU5vZGVGcm9tKCB3aW5kb3csIHNwZWMgKSApXG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAoIHR5cGVvZiBzcGVjID09PSBcInN0cmluZ1wiICYmIG9sZE5vZGUubm9kZVR5cGUgPT09IE5vZGUuVEVYVF9OT0RFICkge1xuICAgICAgICAgICAgaWYgKCBvbGROb2RlLm5vZGVWYWx1ZSAhPT0gc3BlYyApIHtcbiAgICAgICAgICAgICAgICBvbGROb2RlLm5vZGVWYWx1ZSA9IHNwZWNcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICggb2xkTm9kZS5ub2RlVHlwZSA9PT0gTm9kZS5FTEVNRU5UX05PREUgKSB7XG4gICAgICAgICAgICBpZiAoIG9sZE5vZGUudGFnTmFtZSAhPT0gc3BlYy50YWdOYW1lICkge1xuICAgICAgICAgICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQoIGNyZWF0ZU5vZGVGcm9tKCB3aW5kb3csIHNwZWMgKSwgb2xkTm9kZSApXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB1cGRhdGVQcm9wZXJ0aWVzKCB3aW5kb3csIG9sZE5vZGUsIHNwZWMgKVxuICAgICAgICAgICAgICAgIHVwZGF0ZUNoaWxkcmVuKCB3aW5kb3csIG9sZE5vZGUsIHNwZWMgKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCBvbGROb2RlLm5vZGVUeXBlID09PSBOb2RlLlRFWFRfTk9ERSApIHtcbiAgICAgICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQoIGNyZWF0ZU5vZGVGcm9tKCB3aW5kb3csIHNwZWMgKSwgb2xkTm9kZSApXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBcInVua25vd24gbm9kZVwiXG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const createNodeFrom = function (window, spec) {
    let element = null;
    if (typeof spec === "string") {
        element = window.document.createTextNode(spec);
    }
    else {
        element = window.document.createElement(spec.tagName);
        updateProperties(window, element, spec);
        for (let i = 0, len = spec.children.length; i < len; i++) {
            element.appendChild(createNodeFrom(window, spec.children[i]));
        }
    }
    return element;
};
exports.updateChildren = function (window, oldNode, spec) {
    let oldLength = oldNode.childNodes.length;
    let newLength = spec.children.length;
    for (let i1 = 0; i1 < newLength; i1++) {
        exports.patch(window, oldNode, oldNode.childNodes[i1], spec.children[i1]);
    }
    for (let i2 = 0; i2 < (oldLength - newLength); i2++) {
        oldNode.removeChild(oldNode.lastChild);
    }
};
const updateProperties = function (window, oldNode, spec) {
    if (oldNode._properties) {
        for (let propName of oldNode._properties) {
            if (propName.startsWith("on"))
                oldNode[propName] = function () {
                };
        }
    }
    oldNode._properties = [];
    for (let propName in spec.properties) {
        oldNode._properties.push(propName);
        if (propName.startsWith("on")) {
            oldNode[propName] = (function ([name, data]) {
                return function (event) {
                    const lymph_config = window["lymphConfig"] || { actionName: "action" };
                    this.dispatchEvent(new window["CustomEvent"](lymph_config.actionName, {
                        detail: { name, data, event },
                        bubbles: true,
                        cancelable: true
                    }));
                };
            })(spec.properties[propName]);
        }
        else if (oldNode[propName] !== spec.properties[propName]) {
            oldNode[propName] = spec.properties[propName];
        }
    }
};
exports.patch = function (window, parent, oldNode, spec) {
    if (oldNode === undefined) {
        parent.appendChild(createNodeFrom(window, spec));
    }
    else {
        if (typeof spec === "string" && oldNode.nodeType === Node.TEXT_NODE) {
            if (oldNode.nodeValue !== spec) {
                oldNode.nodeValue = spec;
            }
        }
        else if (oldNode.nodeType === Node.ELEMENT_NODE) {
            if (oldNode.tagName !== spec.tagName) {
                parent.replaceChild(createNodeFrom(window, spec), oldNode);
            }
            else {
                updateProperties(window, oldNode, spec);
                exports.updateChildren(window, oldNode, spec);
            }
        }
        else if (oldNode.nodeType === Node.TEXT_NODE) {
            parent.replaceChild(createNodeFrom(window, spec), oldNode);
        }
        else {
            throw "unknown node";
        }
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRE9NLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL0RPTS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU0sY0FBYyxHQUFHLFVBQVcsTUFBYyxFQUFFLElBQUk7SUFDbEQsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFBO0lBRWxCLEVBQUUsQ0FBQyxDQUFFLE9BQU8sSUFBSSxLQUFLLFFBQVMsQ0FBQyxDQUFDLENBQUM7UUFDN0IsT0FBTyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFFLElBQUksQ0FBRSxDQUFBO0lBQ3BELENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNKLE9BQU8sR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBRSxJQUFJLENBQUMsT0FBTyxDQUFFLENBQUE7UUFFdkQsZ0JBQWdCLENBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUUsQ0FBQTtRQUV6QyxHQUFHLENBQUMsQ0FBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUcsQ0FBQztZQUN6RCxPQUFPLENBQUMsV0FBVyxDQUFFLGNBQWMsQ0FBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBRSxDQUFDLENBQUUsQ0FBRSxDQUFFLENBQUE7UUFDdkUsQ0FBQztJQUNMLENBQUM7SUFFRCxNQUFNLENBQUMsT0FBTyxDQUFBO0FBQ2xCLENBQUMsQ0FBQTtBQUVZLFFBQUEsY0FBYyxHQUFHLFVBQVcsTUFBYyxFQUFFLE9BQU8sRUFBRSxJQUFJO0lBQ2xFLElBQUksU0FBUyxHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFBO0lBQ3pDLElBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFBO0lBRXBDLEdBQUcsQ0FBQyxDQUFFLElBQUks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SyxJQUFJLENBQUMsU0FBVSxDQUFDLENBQUMsQ0FBQztZQUNwRSxFQUFFLENBQUMsQ0FBRSxPQUFPLENBQUMsU0FBUyxLQUFLLElBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQy9CLE9BQU8sQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFBO1lBQzVCLENBQUM7UUFDTCxDQUFDO1FBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFFLE9BQU8sQ0FBQyxRQUFRLEtBQUssSUFBSSxDQUFDLFlBQWEsQ0FBQyxDQUFDLENBQUM7WUFDaEQsRUFBRSxDQUFDLENBQUUsT0FBTyxDQUFDLE9BQU8sS0FBSyxJQUFJLENBQUMsT0FBUSxDQUFDLENBQUMsQ0FBQztnQkFDckMsTUFBTSxDQUFDLFlBQVksQ0FBRSxjQUFjLENBQUUsTUFBTSxFQUFFLElBQUksQ0FBRSxFQUFFLE9BQU8sQ0FBRSxDQUFBO1lBQ2xFLENBQUM7WUFDRCxJQUFJLENBQUMsQ0FBQztnQkFDRixnQkFBZ0IsQ0FBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBRSxDQUFBO2dCQUN6QyxzQkFBYyxDQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFFLENBQUE7WUFDM0MsQ0FBQztRQUNMLENBQUM7UUFDRCxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUUsT0FBTyxDQUFDLFFBQVEsS0FBSyxJQUFJLENBQUMsU0FBVSxDQUFDLENBQUMsQ0FBQztZQUM3QyxNQUFNLENBQUMsWUFBWSxDQUFFLGNBQWMsQ0FBRSxNQUFNLEVBQUUsSUFBSSxDQUFFLEVBQUUsT0FBTyxDQUFFLENBQUE7UUFDbEUsQ0FBQztRQUNELElBQUksQ0FBQyxDQUFDO1lBQ0YsTUFBTSxjQUFjLENBQUE7UUFDeEIsQ0FBQztJQUNMLENBQUM7QUFDTCxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBjcmVhdGVOb2RlRnJvbSA9IGZ1bmN0aW9uICggd2luZG93OiBXaW5kb3csIHNwZWMgKSB7XG4gICAgbGV0IGVsZW1lbnQgPSBudWxsXG5cbiAgICBpZiAoIHR5cGVvZiBzcGVjID09PSBcInN0cmluZ1wiICkge1xuICAgICAgICBlbGVtZW50ID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCBzcGVjIClcbiAgICB9IGVsc2Uge1xuICAgICAgICBlbGVtZW50ID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIHNwZWMudGFnTmFtZSApXG5cbiAgICAgICAgdXBkYXRlUHJvcGVydGllcyggd2luZG93LCBlbGVtZW50LCBzcGVjIClcblxuICAgICAgICBmb3IgKCBsZXQgaSA9IDAsIGxlbiA9IHNwZWMuY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbGVuOyBpKysgKSB7XG4gICAgICAgICAgICBlbGVtZW50LmFwcGVuZENoaWxkKCBjcmVhdGVOb2RlRnJvbSggd2luZG93LCBzcGVjLmNoaWxkcmVuWyBpIF0gKSApXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZWxlbWVudFxufVxuXG5leHBvcnQgY29uc3QgdXBkYXRlQ2hpbGRyZW4gPSBmdW5jdGlvbiAoIHdpbmRvdzogV2luZG93LCBvbGROb2RlLCBzcGVjICkge1xuICAgIGxldCBvbGRMZW5ndGggPSBvbGROb2RlLmNoaWxkTm9kZXMubGVuZ3RoXG4gICAgbGV0IG5ld0xlbmd0aCA9IHNwZWMuY2hpbGRyZW4ubGVuZ3RoXG5cbiAgICBmb3IgKCBsZXQgaTEgPSAwOyBpMSA8IG5ld0xlbmd0aDsgaTErKyApIHtcbiAgICAgICAgcGF0Y2goIHdpbmRvdywgb2xkTm9kZSwgb2xkTm9kZS5jaGlsZE5vZGVzWyBpMSBdLCBzcGVjLmNoaWxkcmVuWyBpMSBdIClcbiAgICB9XG5cbiAgICBmb3IgKCBsZXQgaTIgPSAwOyBpMiA8IChvbGRMZW5ndGggLSBuZXdMZW5ndGgpOyBpMisrICkge1xuICAgICAgICBvbGROb2RlLnJlbW92ZUNoaWxkKCBvbGROb2RlLmxhc3RDaGlsZCApXG4gICAgfVxufVxuXG5jb25zdCB1cGRhdGVQcm9wZXJ0aWVzID0gZnVuY3Rpb24gKCB3aW5kb3c6IFdpbmRvdywgb2xkTm9kZSwgc3BlYyApIHtcbiAgICBpZiAoIG9sZE5vZGUuX3Byb3BlcnRpZXMgKSB7XG4gICAgICAgIGZvciAoIGxldCBwcm9wTmFtZSBvZiBvbGROb2RlLl9wcm9wZXJ0aWVzICkge1xuICAgICAgICAgICAgaWYgKCBwcm9wTmFtZS5zdGFydHNXaXRoKCBcIm9uXCIgKSApXG4gICAgICAgICAgICAgICAgb2xkTm9kZVsgcHJvcE5hbWUgXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvbGROb2RlLl9wcm9wZXJ0aWVzID0gW11cblxuICAgIGZvciAoIGxldCBwcm9wTmFtZSBpbiBzcGVjLnByb3BlcnRpZXMgKSB7XG4gICAgICAgIG9sZE5vZGUuX3Byb3BlcnRpZXMucHVzaCggcHJvcE5hbWUgKVxuICAgICAgICBpZiAoIHByb3BOYW1lLnN0YXJ0c1dpdGgoIFwib25cIiApICkge1xuICAgICAgICAgICAgb2xkTm9kZVsgcHJvcE5hbWUgXSA9IChmdW5jdGlvbiAoIFsgbmFtZSwgZGF0YSBdICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoIGV2ZW50ICkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBseW1waF9jb25maWcgPSB3aW5kb3dbIFwibHltcGhDb25maWdcIiBdIHx8IHsgYWN0aW9uTmFtZTogXCJhY3Rpb25cIiB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyB3aW5kb3dbIFwiQ3VzdG9tRXZlbnRcIiBdKCBseW1waF9jb25maWcuYWN0aW9uTmFtZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbDogeyBuYW1lLCBkYXRhLCBldmVudCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1YmJsZXM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsYWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSApXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSggc3BlYy5wcm9wZXJ0aWVzWyBwcm9wTmFtZSBdIClcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICggb2xkTm9kZVsgcHJvcE5hbWUgXSAhPT0gc3BlYy5wcm9wZXJ0aWVzWyBwcm9wTmFtZSBdICkge1xuICAgICAgICAgICAgb2xkTm9kZVsgcHJvcE5hbWUgXSA9IHNwZWMucHJvcGVydGllc1sgcHJvcE5hbWUgXVxuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgcGF0Y2ggPSBmdW5jdGlvbiAoIHdpbmRvdzogV2luZG93LCBwYXJlbnQsIG9sZE5vZGUsIHNwZWMgKSB7XG4gICAgaWYgKCBvbGROb2RlID09PSB1bmRlZmluZWQgKSB7XG4gICAgICAgIHBhcmVudC5hcHBlbmRDaGlsZCggY3JlYXRlTm9kZUZyb20oIHdpbmRvdywgc3BlYyApIClcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmICggdHlwZW9mIHNwZWMgPT09IFwic3RyaW5nXCIgJiYgb2xkTm9kZS5ub2RlVHlwZSA9PT0gTm9kZS5URVhUX05PREUgKSB7XG4gICAgICAgICAgICBpZiAoIG9sZE5vZGUubm9kZVZhbHVlICE9PSBzcGVjICkge1xuICAgICAgICAgICAgICAgIG9sZE5vZGUubm9kZVZhbHVlID0gc3BlY1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCBvbGROb2RlLm5vZGVUeXBlID09PSBOb2RlLkVMRU1FTlRfTk9ERSApIHtcbiAgICAgICAgICAgIGlmICggb2xkTm9kZS50YWdOYW1lICE9PSBzcGVjLnRhZ05hbWUgKSB7XG4gICAgICAgICAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCggY3JlYXRlTm9kZUZyb20oIHdpbmRvdywgc3BlYyApLCBvbGROb2RlIClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHVwZGF0ZVByb3BlcnRpZXMoIHdpbmRvdywgb2xkTm9kZSwgc3BlYyApXG4gICAgICAgICAgICAgICAgdXBkYXRlQ2hpbGRyZW4oIHdpbmRvdywgb2xkTm9kZSwgc3BlYyApXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIG9sZE5vZGUubm9kZVR5cGUgPT09IE5vZGUuVEVYVF9OT0RFICkge1xuICAgICAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCggY3JlYXRlTm9kZUZyb20oIHdpbmRvdywgc3BlYyApLCBvbGROb2RlIClcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IFwidW5rbm93biBub2RlXCJcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.generateId = (function () {
    var ALPHABET = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
    var ID_LENGTH = 8;
    return function () {
        var rtn = "";
        for (var i = 0; i < ID_LENGTH; i++) {
            rtn += ALPHABET.charAt(Math.floor(Math.random() * ALPHABET.length));
        }
        return rtn;
    };
})();
exports.objectFromPair = function (pair) {
    var obj = {};
    obj[pair[0]] = pair[1];
    return obj;
};
exports.merge = function (obj1, obj2) {
    return Object.assign({}, obj1, obj2);
};
var sendQuery = function (path) {
    var options = { method: "GET" };
    var handleErrors = function (response) {
        if (!response.ok)
            throw new Error("whatup dog!");
        return response;
    };
    return fetch(path, options)
        .then(handleErrors)
        .then(function (response) { return response.json(); });
};
var sendCommand = function (name, events, data) {
    return { type: "RemoteCommand", name: name, data: data, events: events };
};
var loadStorage = function (name, events) {
    return { type: "LoadStorage", name: name, events: events };
};
var sendRedirect = function (path) {
    return { type: "Redirect", events: [], path: path };
};
exports.dispatchAction = function (window) {
    return function (event) {
        window.dispatchEvent(new window.CustomEvent("action", { detail: event, bubbles: true, cancelable: true }));
    };
};
var send = function (name, data) {
    return { name: name, data: data };
};
exports.sendForm = function (name) {
    return { type: "form", name: name };
};
exports.evolve = function (transformations, object) {
    var result = {};
    for (var key in object) {
        var transformation = transformations[key];
        if (typeof transformation === "function") {
            result[key] = transformation(object[key]);
        }
        else if (typeof transformation === "object") {
            result[key] = exports.evolve(transformation, object[key]);
        }
        else {
            result[key] = object[key];
        }
    }
    return result;
};
exports.currentTarget = function (message) {
    return message.event.currentTarget;
};
var forEach = function (fn, iterable) {
    for (var i = 0; i < iterable.length; i++) {
        fn(iterable[i]);
    }
};
exports.extractFormData = function (form) {
    var fields = {};
    var copyProp = function (element, propName) {
        fields[element.name] = element[propName];
    };
    forEach(function (element) {
        if (element.type === "text" || element.type === "password") {
            copyProp(element, "value");
        }
        else if (element.type === "radio" && element.checked) {
            copyProp(element, "value");
        }
        else if (element.type === "checkbox") {
            copyProp(element, "checked");
        }
        else if (element.nodeName === "SELECT") {
            copyProp(element, "value");
        }
    }, form.elements);
    return fields;
};
exports.currentForm = function (message) {
    return exports.extractFormData(exports.currentTarget(message));
};
exports.find = function (array, condition) {
    var result;
    for (var i = 0; i < array.length; i++) {
        if (condition(array[i])) {
            return array[i];
        }
    }
    return result;
};
exports.mapObjectToArray = function (object, fn) {
    return Object.keys(object).map(function (key) {
        return fn(key, object[key]);
    });
};
var extractMessage = function (parent_message, message) {
    return exports.merge(message, { name: message.name.replace(":" + parent_message, "") });
};
exports.createUpdater = function (routeDefinitions) {
    return function (message, state) {
        for (var name_1 in routeDefinitions) {
            if (message.name.indexOf(":" + name_1) === 0) {
                return routeDefinitions[name_1](extractMessage(name_1, message), state);
            }
        }
        return [state, undefined];
    };
};
exports.createContext = function (names) {
    if (names === void 0) { names = []; }
    return {
        createComponent: function (component, component_name) {
            var _a = component.create(exports.createContext(names.concat(component_name))), init = _a.init, updater = _a.updater, render = _a.render;
            return { init: init, update: exports.createUpdater(updater), render: render };
        },
        send: function (name) {
            return ":" + names.slice(1).concat(name).join(":");
        }
    };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvVXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBYSxRQUFBLFVBQVUsR0FBRyxDQUFDO0lBQ3ZCLElBQU0sUUFBUSxHQUFHLGdFQUFnRSxDQUFBO0lBQ2pGLElBQU0sU0FBUyxHQUFHLENBQUMsQ0FBQTtJQUVuQixNQUFNLENBQUM7UUFDSCxJQUFJLEdBQUcsR0FBRyxFQUFFLENBQUE7UUFDWixHQUFHLENBQUMsQ0FBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFNBQVMsRUFBRSxDQUFDLEVBQUUsRUFBRyxDQUFDO1lBQ25DLEdBQUcsSUFBSSxRQUFRLENBQUMsTUFBTSxDQUFFLElBQUksQ0FBQyxLQUFLLENBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUUsQ0FBRSxDQUFBO1FBQzNFLENBQUM7UUFDRCxNQUFNLENBQUMsR0FBRyxDQUFBO0lBQ2QsQ0FBQyxDQUFBO0FBQ0wsQ0FBQyxDQUFDLEVBQUUsQ0FBQTtBQUVTLFFBQUEsY0FBYyxHQUFHLFVBQVcsSUFBSTtJQUN6QyxJQUFNLEdBQUcsR0FBRyxFQUFFLENBQUE7SUFDZCxHQUFHLENBQUUsSUFBSSxDQUFFLENBQUMsQ0FBRSxDQUFFLEdBQUcsSUFBSSxDQUFFLENBQUMsQ0FBRSxDQUFBO0lBQzVCLE1BQU0sQ0FBQyxHQUFHLENBQUE7QUFDZCxDQUFDLENBQUE7QUFFWSxRQUFBLEtBQUssR0FBRyxVQUFXLElBQUksRUFBRSxJQUFJO0lBQ3RDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFFLENBQUE7QUFDMUMsQ0FBQyxDQUFBO0FBRUQsSUFBTSxTQUFTLEdBQUcsVUFBVyxJQUFJO0lBQzdCLElBQU0sT0FBTyxHQUFHLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFBO0lBRWpDLElB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TUFBTSxDQUFFLElBQUksQ0FBRSxDQUFDLElBQUksQ0FBRSxHQUFHLENBQUUsQ0FBQTtRQUM1RCxDQUFDO0tBQ0osQ0FBQTtBQUNMLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBnZW5lcmF0ZUlkID0gKGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBBTFBIQUJFVCA9IFwiMDEyMzQ1Njc4OWFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6QUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVpcIlxuICAgIGNvbnN0IElEX0xFTkdUSCA9IDhcblxuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCBydG4gPSBcIlwiXG4gICAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8IElEX0xFTkdUSDsgaSsrICkge1xuICAgICAgICAgICAgcnRuICs9IEFMUEhBQkVULmNoYXJBdCggTWF0aC5mbG9vciggTWF0aC5yYW5kb20oKSAqIEFMUEhBQkVULmxlbmd0aCApIClcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcnRuXG4gICAgfVxufSkoKVxuXG5leHBvcnQgY29uc3Qgb2JqZWN0RnJvbVBhaXIgPSBmdW5jdGlvbiAoIHBhaXIgKSB7XG4gICAgY29uc3Qgb2JqID0ge31cbiAgICBvYmpbIHBhaXJbIDAgXSBdID0gcGFpclsgMSBdXG4gICAgcmV0dXJuIG9ialxufVxuXG5leHBvcnQgY29uc3QgbWVyZ2UgPSBmdW5jdGlvbiAoIG9iajEsIG9iajIgKSB7XG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oIHt9LCBvYmoxLCBvYmoyIClcbn1cblxuY29uc3Qgc2VuZFF1ZXJ5ID0gZnVuY3Rpb24gKCBwYXRoICkge1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7IG1ldGhvZDogXCJHRVRcIiB9XG5cbiAgICBjb25zdCBoYW5kbGVFcnJvcnMgPSBmdW5jdGlvbiAoIHJlc3BvbnNlICkge1xuICAgICAgICBpZiAoICFyZXNwb25zZS5vayApXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIFwid2hhdHVwIGRvZyFcIiApXG5cbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgfVxuXG4gICAgcmV0dXJuIGZldGNoKCBwYXRoLCBvcHRpb25zIClcbiAgICAgICAgLnRoZW4oIGhhbmRsZUVycm9ycyApXG4gICAgICAgIC50aGVuKCByZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkgKVxufVxuXG5jb25zdCBzZW5kQ29tbWFuZCA9IGZ1bmN0aW9uICggbmFtZSwgZXZlbnRzLCBkYXRhICkge1xuICAgIHJldHVybiB7IHR5cGU6IFwiUmVtb3RlQ29tbWFuZFwiLCBuYW1lLCBkYXRhLCBldmVudHMgfVxufVxuXG5jb25zdCBsb2FkU3RvcmFnZSA9IGZ1bmN0aW9uICggbmFtZSwgZXZlbnRzICkge1xuICAgIHJldHVybiB7IHR5cGU6IFwiTG9hZFN0b3JhZ2VcIiwgbmFtZSwgZXZlbnRzIH1cbn1cblxuY29uc3Qgc2VuZFJlZGlyZWN0ID0gZnVuY3Rpb24gKCBwYXRoICkge1xuICAgIHJldHVybiB7IHR5cGU6IFwiUmVkaXJlY3RcIiwgZXZlbnRzOiBbXSwgcGF0aCB9XG59XG5cbmV4cG9ydCBjb25zdCBkaXNwYXRjaEFjdGlvbiA9IGZ1bmN0aW9uICggd2luZG93ICkge1xuICAgIHJldHVybiBmdW5jdGlvbiAoIGV2ZW50ICkge1xuICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudCggbmV3IHdpbmRvdy5DdXN0b21FdmVudCggXCJhY3Rpb25cIixcbiAgICAgICAgICAgIHsgZGV0YWlsOiBldmVudCwgYnViYmxlczogdHJ1ZSwgY2FuY2VsYWJsZTogdHJ1ZSB9ICkgKVxuICAgIH1cbn1cblxuY29uc3Qgc2VuZCA9IGZ1bmN0aW9uICggbmFtZSwgZGF0YSApIHtcbiAgICByZXR1cm4geyBuYW1lLCBkYXRhIH1cbn1cblxuZXhwb3J0IGNvbnN0IHNlbmRGb3JtID0gZnVuY3Rpb24gKCBuYW1lICkge1xuICAgIHJldHVybiB7IHR5cGU6IFwiZm9ybVwiLCBuYW1lIH1cbn1cblxuZXhwb3J0IGNvbnN0IGV2b2x2ZSA9IGZ1bmN0aW9uICggdHJhbnNmb3JtYXRpb25zLCBvYmplY3QgKSB7XG4gICAgY29uc3QgcmVzdWx0ID0ge31cblxuICAgIGZvciAoIGNvbnN0IGtleSBpbiBvYmplY3QgKSB7XG4gICAgICAgIGxldCB0cmFuc2Zvcm1hdGlvbiA9IHRyYW5zZm9ybWF0aW9uc1sga2V5IF1cblxuICAgICAgICBpZiAoIHR5cGVvZiB0cmFuc2Zvcm1hdGlvbiA9PT0gXCJmdW5jdGlvblwiICkge1xuICAgICAgICAgICAgcmVzdWx0WyBrZXkgXSA9IHRyYW5zZm9ybWF0aW9uKCBvYmplY3RbIGtleSBdIClcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICggdHlwZW9mIHRyYW5zZm9ybWF0aW9uID09PSBcIm9iamVjdFwiICkge1xuICAgICAgICAgICAgcmVzdWx0WyBrZXkgXSA9IGV2b2x2ZSggdHJhbnNmb3JtYXRpb24sIG9iamVjdFsga2V5IF0gKVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0WyBrZXkgXSA9IG9iamVjdFsga2V5IF1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0XG59XG5cblxuZXhwb3J0IGludGVyZmFjZSBJSGFzRXZlbnQge1xuICAgIGV2ZW50OiBFdmVudFxufVxuXG5leHBvcnQgY29uc3QgY3VycmVudFRhcmdldCA9IGZ1bmN0aW9uICggbWVzc2FnZTogSUhhc0V2ZW50ICk6IEV2ZW50VGFyZ2V0IHtcbiAgICByZXR1cm4gbWVzc2FnZS5ldmVudC5jdXJyZW50VGFyZ2V0XG59XG5cbmNvbnN0IGZvckVhY2ggPSBmdW5jdGlvbiAoIGZuLCBpdGVyYWJsZSApIHtcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBpdGVyYWJsZS5sZW5ndGg7IGkrKyApIHtcbiAgICAgICAgZm4oIGl0ZXJhYmxlWyBpIF0gKVxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IGV4dHJhY3RGb3JtRGF0YSA9IGZ1bmN0aW9uICggZm9ybSApIHtcbiAgICBjb25zdCBmaWVsZHMgPSB7fVxuXG4gICAgY29uc3QgY29weVByb3AgPSBmdW5jdGlvbiAoIGVsZW1lbnQsIHByb3BOYW1lICkge1xuICAgICAgICBmaWVsZHNbIGVsZW1lbnQubmFtZSBdID0gZWxlbWVudFsgcHJvcE5hbWUgXVxuICAgIH1cblxuICAgIGZvckVhY2goIGZ1bmN0aW9uICggZWxlbWVudCApIHtcbiAgICAgICAgaWYgKCBlbGVtZW50LnR5cGUgPT09IFwidGV4dFwiIHx8IGVsZW1lbnQudHlwZSA9PT0gXCJwYXNzd29yZFwiICkge1xuICAgICAgICAgICAgY29weVByb3AoIGVsZW1lbnQsIFwidmFsdWVcIiApXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIGVsZW1lbnQudHlwZSA9PT0gXCJyYWRpb1wiICYmIGVsZW1lbnQuY2hlY2tlZCApIHtcbiAgICAgICAgICAgIGNvcHlQcm9wKCBlbGVtZW50LCBcInZhbHVlXCIgKVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCBlbGVtZW50LnR5cGUgPT09IFwiY2hlY2tib3hcIiApIHtcbiAgICAgICAgICAgIGNvcHlQcm9wKCBlbGVtZW50LCBcImNoZWNrZWRcIiApXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIGVsZW1lbnQubm9kZU5hbWUgPT09IFwiU0VMRUNUXCIgKSB7XG4gICAgICAgICAgICBjb3B5UHJvcCggZWxlbWVudCwgXCJ2YWx1ZVwiIClcbiAgICAgICAgfVxuICAgIH0sIGZvcm0uZWxlbWVudHMgKVxuXG4gICAgcmV0dXJuIGZpZWxkc1xufVxuXG5leHBvcnQgY29uc3QgY3VycmVudEZvcm0gPSBmdW5jdGlvbiAoIG1lc3NhZ2U6IElIYXNFdmVudCApOiBhbnkge1xuICAgIHJldHVybiBleHRyYWN0Rm9ybURhdGEoIGN1cnJlbnRUYXJnZXQoIG1lc3NhZ2UgKSApXG59XG5cbmV4cG9ydCBjb25zdCBmaW5kID0gZnVuY3Rpb24gKCBhcnJheTogYW55W10sIGNvbmRpdGlvbjogKCBhbnkgKSA9PiBib29sZWFuICkge1xuICAgIGxldCByZXN1bHRcblxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrICkge1xuICAgICAgICBpZiAoIGNvbmRpdGlvbiggYXJyYXlbIGkgXSApICkge1xuICAgICAgICAgICAgcmV0dXJuIGFycmF5WyBpIF1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHRcbn1cblxuZXhwb3J0IGNvbnN0IG1hcE9iamVjdFRvQXJyYXkgPSBmdW5jdGlvbiAoIG9iamVjdDogYW55LCBmbjogKCBrZXk6IHN0cmluZywgdmFsaXVlOiBhbnkgKSA9PiBhbnkgKTogYW55IHtcbiAgICByZXR1cm4gT2JqZWN0LmtleXMoIG9iamVjdCApLm1hcCggZnVuY3Rpb24gKCBrZXkgKSB7XG4gICAgICAgIHJldHVybiBmbigga2V5LCBvYmplY3RbIGtleSBdIClcbiAgICB9IClcbn1cblxudHlwZSBNZXNzYWdlID0ge1xuICAgIG5hbWU6IHN0cmluZyxcbiAgICBkYXRhOiBhbnksXG4gICAgZXZlbnQ6IGFueVxufVxuXG5jb25zdCBleHRyYWN0TWVzc2FnZSA9IGZ1bmN0aW9uICggcGFyZW50X21lc3NhZ2UsIG1lc3NhZ2UgKSB7XG4gICAgcmV0dXJuIG1lcmdlKCBtZXNzYWdlLCB7IG5hbWU6IG1lc3NhZ2UubmFtZS5yZXBsYWNlKCBcIjpcIiArIHBhcmVudF9tZXNzYWdlLCBcIlwiICkgfSApXG59XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVVcGRhdGVyID0gZnVuY3Rpb24gKCByb3V0ZURlZmluaXRpb25zOiBhbnkgKTogKCBNZXNzYWdlLCBhbnkgKSA9PiBbIGFueSwgYW55IF0ge1xuICAgIHJldHVybiBmdW5jdGlvbiAoIG1lc3NhZ2U6IE1lc3NhZ2UsIHN0YXRlOiBhbnkgKTogWyBhbnksIGFueSBdIHtcbiAgICAgICAgZm9yICggbGV0IG5hbWUgaW4gcm91dGVEZWZpbml0aW9ucyApIHtcbiAgICAgICAgICAgIGlmICggbWVzc2FnZS5uYW1lLmluZGV4T2YoIFwiOlwiICsgbmFtZSApID09PSAwICkge1xuICAgICAgICAgICAgICAgIHJldHVybiByb3V0ZURlZmluaXRpb25zWyBuYW1lIF0oIGV4dHJhY3RNZXNzYWdlKCBuYW1lLCBtZXNzYWdlICksIHN0YXRlIClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBbIHN0YXRlLCB1bmRlZmluZWQgXVxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUNvbnRleHQgPSBmdW5jdGlvbiAoIG5hbWVzID0gW10gKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgY3JlYXRlQ29tcG9uZW50OiBmdW5jdGlvbiAoIGNvbXBvbmVudCwgY29tcG9uZW50X25hbWUgKSB7XG4gICAgICAgICAgICBjb25zdCB7IGluaXQsIHVwZGF0ZXIsIHJlbmRlciB9ID1cbiAgICAgICAgICAgICAgICBjb21wb25lbnQuY3JlYXRlKCBjcmVhdGVDb250ZXh0KCBuYW1lcy5jb25jYXQoIGNvbXBvbmVudF9uYW1lICkgKSApXG5cbiAgICAgICAgICAgIHJldHVybiB7IGluaXQsIHVwZGF0ZTogY3JlYXRlVXBkYXRlciggdXBkYXRlciApLCByZW5kZXIgfVxuICAgICAgICB9LFxuICAgICAgICBzZW5kOiBmdW5jdGlvbiAoIG5hbWUgKSB7XG4gICAgICAgICAgICByZXR1cm4gXCI6XCIgKyBuYW1lcy5zbGljZSggMSApLmNvbmNhdCggbmFtZSApLmpvaW4oIFwiOlwiIClcbiAgICAgICAgfVxuICAgIH1cbn1cblxuIl19
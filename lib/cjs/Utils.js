"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.generateId = (function () {
    const ALPHABET = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
    const ID_LENGTH = 8;
    return function () {
        let rtn = "";
        for (let i = 0; i < ID_LENGTH; i++) {
            rtn += ALPHABET.charAt(Math.floor(Math.random() * ALPHABET.length));
        }
        return rtn;
    };
})();
exports.objectFromPair = function (pair) {
    const obj = {};
    obj[pair[0]] = pair[1];
    return obj;
};
exports.merge = function (obj1, obj2) {
    return Object.assign({}, obj1, obj2);
};
const sendQuery = function (path) {
    const options = { method: "GET" };
    const handleErrors = function (response) {
        if (!response.ok)
            throw new Error("whatup dog!");
        return response;
    };
    return fetch(path, options)
        .then(handleErrors)
        .then(response => response.json());
};
const sendCommand = function (name, events, data) {
    return { type: "RemoteCommand", name, data, events };
};
const loadStorage = function (name, events) {
    return { type: "LoadStorage", name, events };
};
const sendRedirect = function (path) {
    return { type: "Redirect", events: [], path };
};
exports.dispatchAction = function (window) {
    return function (event) {
        window.dispatchEvent(new window.CustomEvent("action", { detail: event, bubbles: true, cancelable: true }));
    };
};
const send = function (name, data) {
    return { name, data };
};
exports.sendForm = function (name) {
    return { type: "form", name };
};
exports.evolve = function (transformations, object) {
    const result = {};
    for (const key in object) {
        let transformation = transformations[key];
        if (typeof transformation === "function") {
            result[key] = transformation(object[key]);
        }
        else if (typeof transformation === "object") {
            result[key] = exports.evolve(transformation, object[key]);
        }
        else {
            result[key] = object[key];
        }
    }
    return result;
};
exports.currentTarget = function (message) {
    return message.event.currentTarget;
};
const forEach = function (fn, iterable) {
    for (let i = 0; i < iterable.length; i++) {
        fn(iterable[i]);
    }
};
exports.extractFormData = function (form) {
    const fields = {};
    const copyProp = function (element, propName) {
        fields[element.name] = element[propName];
    };
    forEach(function (element) {
        if (element.type === "text" || element.type === "password") {
            copyProp(element, "value");
        }
        else if (element.type === "radio" && element.checked) {
            copyProp(element, "value");
        }
        else if (element.type === "checkbox") {
            copyProp(element, "checked");
        }
        else if (element.nodeName === "SELECT") {
            copyProp(element, "value");
        }
    }, form.elements);
    return fields;
};
exports.currentForm = function (message) {
    return exports.extractFormData(exports.currentTarget(message));
};
exports.find = function (array, condition) {
    let result;
    for (let i = 0; i < array.length; i++) {
        if (condition(array[i])) {
            return array[i];
        }
    }
    return result;
};
exports.mapObjectToArray = function (object, fn) {
    return Object.keys(object).map(function (key) {
        return fn(key, object[key]);
    });
};
const extractMessage = function (parent_message, message) {
    return exports.merge(message, { name: message.name.replace(":" + parent_message, "") });
};
exports.createUpdater = function (routeDefinitions) {
    return function (message, state) {
        for (let name in routeDefinitions) {
            if (message.name.indexOf(":" + name) === 0) {
                return routeDefinitions[name](extractMessage(name, message), state);
            }
        }
        return [state, undefined];
    };
};
exports.createContext = function (names = []) {
    return {
        createComponent: function (component, component_name) {
            const { init, updater, render } = component.create(exports.createContext(names.concat(component_name)));
            return { init, update: exports.createUpdater(updater), render };
        },
        send: function (name) {
            return ":" + names.slice(1).concat(name).join(":");
        }
    };
};
exports.createActionHandler = window => function (action, callback) {
    window.addEventListener("action", function (e) {
        if (e["detail"].name === action)
            callback(e["detail"]);
    });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvVXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBYSxRQUFBLFVBQVUsR0FBRyxDQUFDO0lBQ3ZCLE1BQU0sUUFBUSxHQUFHLGdFQUFnRSxDQUFBO0lBQ2pGLE1BQU0sU0FBUyxHQUFHLENBQUMsQ0FBQTtJQUVuQixNQUFNLENBQUM7UUFDSCxJQUFJLEdBQUcsR0FBRyxFQUFFLENBQUE7UUFDWixHQUFHLENBQUMsQ0FBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFNBQVMsRUFBRSxDQUFDLEVBQUUsRUFBRyxDQUFDO1lBQ25DLEdBQUcsSUFBSSxRQUFRLENBQUMsTUFBTSxDQUFFLElBQUksQ0FBQyxLQUFLLENBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUUsQ0FBRSxDQUFBO1FBQzNFLENBQUM7UUFDRCxNQUFNLENBQUMsR0FBRyxDQUFBO0lBQ2QsQ0FBQyxDQUFBO0FBQ0wsQ0FBQyxDQUFDLEVBQUUsQ0FBQTtBQUVTLFFBQUEsY0FBYyxHQUFHLFVBQVcsSUFBSTtJQUN6QyxNQUFNLEdBQUcsR0FBRyxFQUFFLENBQUE7SUFDZCxHQUFHLENBQUUsSUFBSSxDQUFFLENBQUMsQ0FBRSxDQUFFLEdBQUcsSUFBSSxDQUFFLENBQUMsQ0FBRSxDQUFBO0lBQzVCLE1BQU0sQ0FBQyxHQUFHLENBQUE7QUFDZCxDQUFDLENBQUE7QUFFWSxRQUFBLEtBQUssR0FBRyxVQUFXLElBQUksRUFBRSxJQUFJO0lBQ3RDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFFLENBQUE7QUFDMUMsQ0FBQyxDQUFBO0FBRUQsTUFBTSxTQUFTLEdBQUcsVUFBVyxJQUFJO0lBQzdCLE1BQU0sT0FBTyxHQUFHLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFBO0lBRWpDLE1B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Q0FBRSxJQUFJLENBQUUsQ0FBQyxJQUFJLENBQUUsR0FBRyxDQUFFLENBQUE7UUFDNUQsQ0FBQztLQUNKLENBQUE7QUFDTCxDQUFDLENBQUE7QUFFWSxRQUFBLG1CQUFtQixHQUFHLE1BQU0sQ0FBQyxFQUFFLENBQUMsVUFBVyxNQUFNLEVBQUUsUUFBUTtJQUNwRSxNQUFNLENBQUMsZ0JBQWdCLENBQUUsUUFBUSxFQUFFLFVBQVcsQ0FBQztRQUMzQyxFQUFFLENBQUMsQ0FBRSxDQUFDLENBQUUsUUFBUSxDQUFFLENBQUMsSUFBSSxLQUFLLE1BQU8sQ0FBQztZQUFDLFFBQVEsQ0FBRSxDQUFDLENBQUUsUUFBUSxDQUFFLENBQUUsQ0FBQTtJQUNsRSxDQUFDLENBQUUsQ0FBQTtBQUNQLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBnZW5lcmF0ZUlkID0gKGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBBTFBIQUJFVCA9IFwiMDEyMzQ1Njc4OWFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6QUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVpcIlxuICAgIGNvbnN0IElEX0xFTkdUSCA9IDhcblxuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCBydG4gPSBcIlwiXG4gICAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8IElEX0xFTkdUSDsgaSsrICkge1xuICAgICAgICAgICAgcnRuICs9IEFMUEhBQkVULmNoYXJBdCggTWF0aC5mbG9vciggTWF0aC5yYW5kb20oKSAqIEFMUEhBQkVULmxlbmd0aCApIClcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcnRuXG4gICAgfVxufSkoKVxuXG5leHBvcnQgY29uc3Qgb2JqZWN0RnJvbVBhaXIgPSBmdW5jdGlvbiAoIHBhaXIgKSB7XG4gICAgY29uc3Qgb2JqID0ge31cbiAgICBvYmpbIHBhaXJbIDAgXSBdID0gcGFpclsgMSBdXG4gICAgcmV0dXJuIG9ialxufVxuXG5leHBvcnQgY29uc3QgbWVyZ2UgPSBmdW5jdGlvbiAoIG9iajEsIG9iajIgKSB7XG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oIHt9LCBvYmoxLCBvYmoyIClcbn1cblxuY29uc3Qgc2VuZFF1ZXJ5ID0gZnVuY3Rpb24gKCBwYXRoICkge1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7IG1ldGhvZDogXCJHRVRcIiB9XG5cbiAgICBjb25zdCBoYW5kbGVFcnJvcnMgPSBmdW5jdGlvbiAoIHJlc3BvbnNlICkge1xuICAgICAgICBpZiAoICFyZXNwb25zZS5vayApXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIFwid2hhdHVwIGRvZyFcIiApXG5cbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgfVxuXG4gICAgcmV0dXJuIGZldGNoKCBwYXRoLCBvcHRpb25zIClcbiAgICAgICAgLnRoZW4oIGhhbmRsZUVycm9ycyApXG4gICAgICAgIC50aGVuKCByZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkgKVxufVxuXG5jb25zdCBzZW5kQ29tbWFuZCA9IGZ1bmN0aW9uICggbmFtZSwgZXZlbnRzLCBkYXRhICkge1xuICAgIHJldHVybiB7IHR5cGU6IFwiUmVtb3RlQ29tbWFuZFwiLCBuYW1lLCBkYXRhLCBldmVudHMgfVxufVxuXG5jb25zdCBsb2FkU3RvcmFnZSA9IGZ1bmN0aW9uICggbmFtZSwgZXZlbnRzICkge1xuICAgIHJldHVybiB7IHR5cGU6IFwiTG9hZFN0b3JhZ2VcIiwgbmFtZSwgZXZlbnRzIH1cbn1cblxuY29uc3Qgc2VuZFJlZGlyZWN0ID0gZnVuY3Rpb24gKCBwYXRoICkge1xuICAgIHJldHVybiB7IHR5cGU6IFwiUmVkaXJlY3RcIiwgZXZlbnRzOiBbXSwgcGF0aCB9XG59XG5cbmV4cG9ydCBjb25zdCBkaXNwYXRjaEFjdGlvbiA9IGZ1bmN0aW9uICggd2luZG93ICkge1xuICAgIHJldHVybiBmdW5jdGlvbiAoIGV2ZW50ICkge1xuICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudCggbmV3IHdpbmRvdy5DdXN0b21FdmVudCggXCJhY3Rpb25cIixcbiAgICAgICAgICAgIHsgZGV0YWlsOiBldmVudCwgYnViYmxlczogdHJ1ZSwgY2FuY2VsYWJsZTogdHJ1ZSB9ICkgKVxuICAgIH1cbn1cblxuY29uc3Qgc2VuZCA9IGZ1bmN0aW9uICggbmFtZSwgZGF0YSApIHtcbiAgICByZXR1cm4geyBuYW1lLCBkYXRhIH1cbn1cblxuZXhwb3J0IGNvbnN0IHNlbmRGb3JtID0gZnVuY3Rpb24gKCBuYW1lICkge1xuICAgIHJldHVybiB7IHR5cGU6IFwiZm9ybVwiLCBuYW1lIH1cbn1cblxuZXhwb3J0IGNvbnN0IGV2b2x2ZSA9IGZ1bmN0aW9uICggdHJhbnNmb3JtYXRpb25zLCBvYmplY3QgKSB7XG4gICAgY29uc3QgcmVzdWx0ID0ge31cblxuICAgIGZvciAoIGNvbnN0IGtleSBpbiBvYmplY3QgKSB7XG4gICAgICAgIGxldCB0cmFuc2Zvcm1hdGlvbiA9IHRyYW5zZm9ybWF0aW9uc1sga2V5IF1cblxuICAgICAgICBpZiAoIHR5cGVvZiB0cmFuc2Zvcm1hdGlvbiA9PT0gXCJmdW5jdGlvblwiICkge1xuICAgICAgICAgICAgcmVzdWx0WyBrZXkgXSA9IHRyYW5zZm9ybWF0aW9uKCBvYmplY3RbIGtleSBdIClcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICggdHlwZW9mIHRyYW5zZm9ybWF0aW9uID09PSBcIm9iamVjdFwiICkge1xuICAgICAgICAgICAgcmVzdWx0WyBrZXkgXSA9IGV2b2x2ZSggdHJhbnNmb3JtYXRpb24sIG9iamVjdFsga2V5IF0gKVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0WyBrZXkgXSA9IG9iamVjdFsga2V5IF1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0XG59XG5cblxuZXhwb3J0IGludGVyZmFjZSBJSGFzRXZlbnQge1xuICAgIGV2ZW50OiBFdmVudFxufVxuXG5leHBvcnQgY29uc3QgY3VycmVudFRhcmdldCA9IGZ1bmN0aW9uICggbWVzc2FnZTogSUhhc0V2ZW50ICk6IEV2ZW50VGFyZ2V0IHtcbiAgICByZXR1cm4gbWVzc2FnZS5ldmVudC5jdXJyZW50VGFyZ2V0XG59XG5cbmNvbnN0IGZvckVhY2ggPSBmdW5jdGlvbiAoIGZuLCBpdGVyYWJsZSApIHtcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBpdGVyYWJsZS5sZW5ndGg7IGkrKyApIHtcbiAgICAgICAgZm4oIGl0ZXJhYmxlWyBpIF0gKVxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IGV4dHJhY3RGb3JtRGF0YSA9IGZ1bmN0aW9uICggZm9ybSApIHtcbiAgICBjb25zdCBmaWVsZHMgPSB7fVxuXG4gICAgY29uc3QgY29weVByb3AgPSBmdW5jdGlvbiAoIGVsZW1lbnQsIHByb3BOYW1lICkge1xuICAgICAgICBmaWVsZHNbIGVsZW1lbnQubmFtZSBdID0gZWxlbWVudFsgcHJvcE5hbWUgXVxuICAgIH1cblxuICAgIGZvckVhY2goIGZ1bmN0aW9uICggZWxlbWVudCApIHtcbiAgICAgICAgaWYgKCBlbGVtZW50LnR5cGUgPT09IFwidGV4dFwiIHx8IGVsZW1lbnQudHlwZSA9PT0gXCJwYXNzd29yZFwiICkge1xuICAgICAgICAgICAgY29weVByb3AoIGVsZW1lbnQsIFwidmFsdWVcIiApXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIGVsZW1lbnQudHlwZSA9PT0gXCJyYWRpb1wiICYmIGVsZW1lbnQuY2hlY2tlZCApIHtcbiAgICAgICAgICAgIGNvcHlQcm9wKCBlbGVtZW50LCBcInZhbHVlXCIgKVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCBlbGVtZW50LnR5cGUgPT09IFwiY2hlY2tib3hcIiApIHtcbiAgICAgICAgICAgIGNvcHlQcm9wKCBlbGVtZW50LCBcImNoZWNrZWRcIiApXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIGVsZW1lbnQubm9kZU5hbWUgPT09IFwiU0VMRUNUXCIgKSB7XG4gICAgICAgICAgICBjb3B5UHJvcCggZWxlbWVudCwgXCJ2YWx1ZVwiIClcbiAgICAgICAgfVxuICAgIH0sIGZvcm0uZWxlbWVudHMgKVxuXG4gICAgcmV0dXJuIGZpZWxkc1xufVxuXG5leHBvcnQgY29uc3QgY3VycmVudEZvcm0gPSBmdW5jdGlvbiAoIG1lc3NhZ2U6IElIYXNFdmVudCApOiBhbnkge1xuICAgIHJldHVybiBleHRyYWN0Rm9ybURhdGEoIGN1cnJlbnRUYXJnZXQoIG1lc3NhZ2UgKSApXG59XG5cbmV4cG9ydCBjb25zdCBmaW5kID0gZnVuY3Rpb24gKCBhcnJheTogYW55W10sIGNvbmRpdGlvbjogKCBhbnkgKSA9PiBib29sZWFuICkge1xuICAgIGxldCByZXN1bHRcblxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrICkge1xuICAgICAgICBpZiAoIGNvbmRpdGlvbiggYXJyYXlbIGkgXSApICkge1xuICAgICAgICAgICAgcmV0dXJuIGFycmF5WyBpIF1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHRcbn1cblxuZXhwb3J0IGNvbnN0IG1hcE9iamVjdFRvQXJyYXkgPSBmdW5jdGlvbiAoIG9iamVjdDogYW55LCBmbjogKCBrZXk6IHN0cmluZywgdmFsaXVlOiBhbnkgKSA9PiBhbnkgKTogYW55IHtcbiAgICByZXR1cm4gT2JqZWN0LmtleXMoIG9iamVjdCApLm1hcCggZnVuY3Rpb24gKCBrZXkgKSB7XG4gICAgICAgIHJldHVybiBmbigga2V5LCBvYmplY3RbIGtleSBdIClcbiAgICB9IClcbn1cblxudHlwZSBNZXNzYWdlID0ge1xuICAgIG5hbWU6IHN0cmluZyxcbiAgICBkYXRhOiBhbnksXG4gICAgZXZlbnQ6IGFueVxufVxuXG5jb25zdCBleHRyYWN0TWVzc2FnZSA9IGZ1bmN0aW9uICggcGFyZW50X21lc3NhZ2UsIG1lc3NhZ2UgKSB7XG4gICAgcmV0dXJuIG1lcmdlKCBtZXNzYWdlLCB7IG5hbWU6IG1lc3NhZ2UubmFtZS5yZXBsYWNlKCBcIjpcIiArIHBhcmVudF9tZXNzYWdlLCBcIlwiICkgfSApXG59XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVVcGRhdGVyID0gZnVuY3Rpb24gKCByb3V0ZURlZmluaXRpb25zOiBhbnkgKTogKCBNZXNzYWdlLCBhbnkgKSA9PiBbIGFueSwgYW55IF0ge1xuICAgIHJldHVybiBmdW5jdGlvbiAoIG1lc3NhZ2U6IE1lc3NhZ2UsIHN0YXRlOiBhbnkgKTogWyBhbnksIGFueSBdIHtcbiAgICAgICAgZm9yICggbGV0IG5hbWUgaW4gcm91dGVEZWZpbml0aW9ucyApIHtcbiAgICAgICAgICAgIGlmICggbWVzc2FnZS5uYW1lLmluZGV4T2YoIFwiOlwiICsgbmFtZSApID09PSAwICkge1xuICAgICAgICAgICAgICAgIHJldHVybiByb3V0ZURlZmluaXRpb25zWyBuYW1lIF0oIGV4dHJhY3RNZXNzYWdlKCBuYW1lLCBtZXNzYWdlICksIHN0YXRlIClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBbIHN0YXRlLCB1bmRlZmluZWQgXVxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUNvbnRleHQgPSBmdW5jdGlvbiAoIG5hbWVzID0gW10gKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgY3JlYXRlQ29tcG9uZW50OiBmdW5jdGlvbiAoIGNvbXBvbmVudCwgY29tcG9uZW50X25hbWUgKSB7XG4gICAgICAgICAgICBjb25zdCB7IGluaXQsIHVwZGF0ZXIsIHJlbmRlciB9ID1cbiAgICAgICAgICAgICAgICBjb21wb25lbnQuY3JlYXRlKCBjcmVhdGVDb250ZXh0KCBuYW1lcy5jb25jYXQoIGNvbXBvbmVudF9uYW1lICkgKSApXG5cbiAgICAgICAgICAgIHJldHVybiB7IGluaXQsIHVwZGF0ZTogY3JlYXRlVXBkYXRlciggdXBkYXRlciApLCByZW5kZXIgfVxuICAgICAgICB9LFxuICAgICAgICBzZW5kOiBmdW5jdGlvbiAoIG5hbWUgKSB7XG4gICAgICAgICAgICByZXR1cm4gXCI6XCIgKyBuYW1lcy5zbGljZSggMSApLmNvbmNhdCggbmFtZSApLmpvaW4oIFwiOlwiIClcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUFjdGlvbkhhbmRsZXIgPSB3aW5kb3cgPT4gZnVuY3Rpb24gKCBhY3Rpb24sIGNhbGxiYWNrICkge1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCBcImFjdGlvblwiLCBmdW5jdGlvbiAoIGUgKSB7XG4gICAgICAgIGlmICggZVsgXCJkZXRhaWxcIiBdLm5hbWUgPT09IGFjdGlvbiApIGNhbGxiYWNrKCBlWyBcImRldGFpbFwiIF0gKVxuICAgIH0gKVxufVxuIl19
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.generateId = (function () {
    const ALPHABET = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
    const ID_LENGTH = 8;
    return function () {
        let rtn = "";
        for (let i = 0; i < ID_LENGTH; i++) {
            rtn += ALPHABET.charAt(Math.floor(Math.random() * ALPHABET.length));
        }
        return rtn;
    };
})();
exports.objectFromPair = function (pair) {
    const obj = {};
    obj[pair[0]] = pair[1];
    return obj;
};
exports.merge = function (obj1, obj2) {
    return Object.assign({}, obj1, obj2);
};
exports.dispatchAction = function (window) {
    return function (event) {
        window.dispatchEvent(new window.CustomEvent("action", { detail: event, bubbles: true, cancelable: true }));
    };
};
exports.evolve = function (transformations, object) {
    const result = {};
    for (const key in object) {
        let transformation = transformations[key];
        if (typeof transformation === "function") {
            result[key] = transformation(object[key]);
        }
        else if (typeof transformation === "object") {
            result[key] = exports.evolve(transformation, object[key]);
        }
        else {
            result[key] = object[key];
        }
    }
    return result;
};
exports.currentTarget = function (message) {
    return message.event.currentTarget;
};
const forEach = function (fn, iterable) {
    for (let i = 0; i < iterable.length; i++) {
        fn(iterable[i]);
    }
};
exports.extractFormData = function (form) {
    const fields = {};
    const copyProp = function (element, propName) {
        fields[element.name] = element[propName];
    };
    forEach(function (element) {
        if (element.type === "text" || element.type === "password") {
            copyProp(element, "value");
        }
        else if (element.type === "radio" && element.checked) {
            copyProp(element, "value");
        }
        else if (element.type === "checkbox") {
            copyProp(element, "checked");
        }
        else if (element.nodeName === "SELECT") {
            copyProp(element, "value");
        }
    }, form.elements);
    return fields;
};
exports.currentForm = function (message) {
    return exports.extractFormData(exports.currentTarget(message));
};
exports.find = function (array, condition) {
    let result;
    for (let i = 0; i < array.length; i++) {
        if (condition(array[i])) {
            return array[i];
        }
    }
    return result;
};
exports.mapObjectToArray = function (object, fn) {
    return Object.keys(object).map(function (key) {
        return fn(key, object[key]);
    });
};
const extractMessage = function (parent_message, message) {
    return exports.merge(message, { name: message.name.replace(":" + parent_message, "") });
};
exports.createUpdater = function (routeDefinitions) {
    return function (message, state) {
        for (let name in routeDefinitions) {
            if (message.name.indexOf(":" + name) === 0) {
                return routeDefinitions[name](extractMessage(name, message), state);
            }
        }
        return [state, undefined];
    };
};
exports.createContext = function (names = []) {
    return {
        createComponent: function (component, component_name) {
            const { init, updater, render } = component.create(exports.createContext(names.concat(component_name)));
            return { init, update: exports.createUpdater(updater), render };
        },
        send: function (name) {
            return ":" + names.slice(1).concat(name).join(":");
        }
    };
};
exports.createActionHandler = window => function (action, callback) {
    window.addEventListener("action", function (e) {
        if (e["detail"].name === action)
            callback(e["detail"]);
    });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvVXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBYSxRQUFBLFVBQVUsR0FBRyxDQUFDO0lBQ3ZCLE1BQU0sUUFBUSxHQUFHLGdFQUFnRSxDQUFBO0lBQ2pGLE1BQU0sU0FBUyxHQUFHLENBQUMsQ0FBQTtJQUVuQixNQUFNLENBQUM7UUFDSCxJQUFJLEdBQUcsR0FBRyxFQUFFLENBQUE7UUFDWixHQUFHLENBQUMsQ0FBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFNBQVMsRUFBRSxDQUFDLEVBQUUsRUFBRyxDQUFDO1lBQ25DLEdBQUcsSUFBSSxRQUFRLENBQUMsTUFBTSxDQUFFLElBQUksQ0FBQyxLQUFLLENBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUUsQ0FBRSxDQUFBO1FBQzNFLENBQUM7UUFDRCxNQUFNLENBQUMsR0FBRyxDQUFBO0lBQ2QsQ0FBQyxDQUFBO0FBQ0wsQ0FBQyxDQUFDLEVBQUUsQ0FBQTtBQUVTLFFBQUEsY0FBYyxHQUFHLFVBQVcsSUFBSTtJQUN6QyxNQUFNLEdBQUcsR0FBRyxFQUFFLENBQUE7SUFDZCxHQUFHLENBQUUsSUFBSSxDQUFFLENBQUMsQ0FBRSxDQUFFLEdBQUcsSUFBSSxDQUFFLENBQUMsQ0FBRSxDQUFBO0lBQzVCLE1BQU0sQ0FBQyxHQUFHLENBQUE7QUFDZCxDQUFDLENBQUE7QUFFWSxRQUFBLEtBQUssR0FBRyxVQUFXLElBQUksRUFBRSxJQUFJO0lBQ3RDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFFLENBQUE7QUFDMUMsQ0FBQyxDQUFBO0FBRVksUUFBQSxjQUFjLEdBQUcsVUFBVyxNQUFNO0lBQzNDLE1BQU0sQ0FBQyxVQUFXLEtBQUs7UUFDbkIsTUFBTSxDQUFDLGFBQWEsQ0FBRSxJQUFJLE1BQU0sQ0FBQyxXQUFXLENBQUUsUUFBUSxFQUNsRCxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLENBQUUsQ0FBRSxDQUFBO0lBQzlELENBQUMsQ0FBQTtBQUNMLENBQUMsQ0FBQTtBQUVZLFFBQUEsTUFBTSxHQUFHLFVBQVcsZUFBZSxFQUFFLE1BQU07SUFDcEQsTUFBTSxNQUFNLEdBQUcsRUFBRSxDQUFBO0lBRWpCLEdBQUcsQ0FBQyxDQUFFLE1BQU0sR0FBRyxJQUFJLE1BQU8sQ0FBQyxDQUFDLENBQUM7UUFDekIsSUFBSSxjQUFjLEdBQUcsZUFBZSxDQUFFLEdBQUcsQ0FBRSxDQUFBO1FBRTNDLEVBQUUsQ0FBQyxDQUFFLE9BQU8sY0FBYyxLQUFLLFVBQVcsQ0FBQyxDQUFDLENBQUM7WUFDekMsTUFBTSxDQUFFLEdBQUcsQ0FBRSxHQUFHLGNBQWMsQ0FBRSxNQUFNLENBQUUsR0FBRyxDQUFFLENBQUUsQ0FBQTtRQUNuRCxDQUFDO1FBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFFLE9BQU8sY0FBYyxLQUFLLFFBQVMsQ0FBQyxDQUFDLENBQUM7WUFDNUMsTUFBTSxDQUFFLEdBQUcsQ0FBRSxHQUFHLGNBQU0sQ0FBRSxjQUFjLEVBQUUsTUFBTSxDQUFFLEdBQUcsQ0FBRSxDQUFFLENBQUE7UUFDM0QsQ0FBQztRQUNELElBQUksQ0FBQyxDQUFDO1lBQ0YsTUFBTSxDQUFFLEdBQUcsQ0FBRSxHQUFHLE1BQU0sQ0FBRSxHQUFHLENBQUUsQ0FBQTtRQUNqQyxDQUFDO0lBQ0wsQ0FBQztJQUNELE1BQU0sQ0FBQyxNQUFNLENBQUE7QUFDakIsQ0FBQyxDQUFBO0FBTVksUUFBQSxhQUFhLEdBQUcsVUFBVyxPQUFrQjtJQUN0RCxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUE7QUFDdEMsQ0FBQyxDQUFBO0FBRUQsTUFBTSxPQUFPLEdBQUcsVUFBVyxFQUFFLEVBQUUsUUFBUTtJQUNuQyxHQUFHLENBQUMsQ0FBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUcsQ0FBQztRQUN6QyxFQUFFLENBQUUsUUFBUSxDQUFFLENBQUMsQ0FBRSxDQUFFLENBQUE7SUFDdkIsQ0FBQztBQUNMLENBQUMsQ0FBQTtBQUVZLFFBQUEsZUFBZSxHQUFHLFVBQVcsSUFBSTtJQUMxQyxNQUFNLE1BQU0sR0FBRyxFQUFFLENBQUE7SUFFakIsTUFBTSxRQUFRLEdBQUcsVUFBVyxPQUFPLEVBQUUsUUFBUTtRQUN6QyxNQUFNLENBQUUsT0FBTyxDQUFDLElBQUksQ0FBRSxHQUFHLE9BQU8sQ0FBRSxRQUFRLENBQUUsQ0FBQTtJQUNoRCxDQUFDLENBQUE7SUFFRCxPQUFPLENBQUUsVUFBVyxPQUFPO1FBQ3ZCLEVBQUUsQ0FBQyxDQUFFLE9BQU8sQ0FBQyxJQUFJLEtBQUssTUFBTSxJQUFJLE9BQU8sQ0FBQyxJQUFJLEtBQUssVUFBVyxDQUFDLENBQUMsQ0FBQztZQUMzRCxRQUFRLENBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBRSxDQUFBO1FBQ2hDLENBQUM7UUFDRCxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUUsT0FBTyxDQUFDLElBQUksS0FBSyxPQUFPLElBQUksT0FBTyxDQUFDLE9BQVEsQ0FBQyxDQUFDLENBQUM7WUFDckQsUUFBUSxDQUFFLE9BQU8sRUFBRSxPQUFPLENBQUUsQ0FBQTtRQUNoQyxDQUFDO1FBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFFLE9BQU8sQ0FBQyxJQUFJLEtBQUssVUFBVyxDQUFDLENBQUMsQ0FBQztZQUNyQyxRQUFRLENBQUUsT0FBTyxFQUFFLFNBQVMsQ0FBRSxDQUFBO1FBQ2xDLENBQUM7UUFDRCxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUUsT0FBTyxDQUFDLFFBQVEsS0FBSyxRQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ3ZDLFFBQVEsQ0FBRSxPQUFPLEVBQUUsT0FBTyxDQUFFLENBQUE7UUFDaEMsQ0FBQztJQUNMLENBQUMsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFFLENBQUE7SUFFbEIsTUFBTSxDQUFDLE1BQU0sQ0FBQTtBQUNqQixDQUFDLENBQUE7QUFFWSxRQUFBLFdBQVcsR0FBRyxVQUFXLE9BQWtCO0lBQ3BELE1BQU0sQ0FBQyx1QkFBZSxDQUFFLHFCQUFhLENBQUUsT0FBTyxDQUFFLENBQUUsQ0FBQTtBQUN0RCxDQUFDLENBQUE7QUFFWSxRQUFBLElBQUksR0FBRyxVQUFXLEtBQVksRUFBRSxTQUE2QjtJQUN0RSxJQUFJLE1BQU0sQ0FBQTtJQUVWLEdBQUcsQ0FBQyxDQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRyxDQUFDO1FBQ3RDLEVBQUUsQ0FBQyxDQUFFLFNBQVMsQ0FBRSxLQUFLLENBQUUsQ0FBQyxDQUFFLENBQUcsQ0FBQyxDQUFDLENBQUM7WUFDNUIsTUFBTSxDQUFDLEtBQUssQ0FBRSxDQUFDLENBQUUsQ0FBQTtRQUNyQixDQUFDO0lBQ0wsQ0FBQztJQUVELE1BQU0sQ0FBQyxNQUFNLENBQUE7QUFDakIsQ0FBQyxDQUFBO0FBRVksUUFBQSxnQkFBZ0IsR0FBRyxVQUFXLE1BQVcsRUFBRSxFQUF1QztJQUMzRixNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBRSxNQUFNLENBQUUsQ0FBQyxHQUFHLENBQUUsVUFBVyxHQUFHO1FBQzVDLE1BQU0sQ0FBQyxFQUFFLENBQUUsR0FBRyxFQUFFLE1BQU0sQ0FBRSxHQUFHLENBQUUsQ0FBRSxDQUFBO0lBQ25DLENBQUMsQ0FBRSxDQUFBO0FBQ1AsQ0FBQyxDQUFBO0FBUUQsTUFBTSxjQUFjLEdBQUcsVUFBVyxjQUFjLEVBQUUsT0FBTztJQUNyRCxNQUFNLENBQUMsYUFBSyxDQUFFLE9BQU8sRUFBRSxFQUFFLElBQUksRUFBRSxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBRSxHQUFHLEdBQUcsY0FBYyxFQUFFLEVBQUUsQ0FBRSxFQUFFLENBQUUsQ0FBQTtBQUN2RixDQUFDLENBQUE7QUFFWSxRQUFBLGFBQWEsR0FBRyxVQUFXLGdCQUFxQjtJQUN6RCxNQUFNLENBQUMsVUFBVyxPQUFnQixFQUFFLEtBQVU7UUFDMUMsR0FBRyxDQUFDLENBQUUsSUFBSSxJQUFJLElBQUksZ0JBQWlCLENBQUMsQ0FBQyxDQUFDO1lBQ2xDLEVBQUUsQ0FBQyxDQUFFLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFFLEdBQUcsR0FBRyxJQUFJLENBQUUsS0FBSyxDQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUM3QyxNQUFNLENBQUMsZ0JBQWdCLENBQUUsSUFBSSxDQUFFLENBQUUsY0FBYyxDQUFFLElBQUksRUFBRSxPQUFPLENBQUUsRUFBRSxLQUFLLENBQUUsQ0FBQTtZQUM3RSxDQUFDO1FBQ0wsQ0FBQztRQUVELE1BQU0sQ0FBQyxDQUFFLEtBQUssRUFBRSxTQUFTLENBQUUsQ0FBQTtJQUMvQixDQUFDLENBQUE7QUFDTCxDQUFDLENBQUE7QUFFWSxRQUFBLGFBQWEsR0FBRyxVQUFXLEtBQUssR0FBRyxFQUFFO0lBQzlDLE1BQU0sQ0FBQztRQUNILGVBQWUsRUFBRSxVQUFXLFNBQVMsRUFBRSxjQUFjO1lBQ2pELE1BQU0sRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxHQUMzQixTQUFTLENBQUMsTUFBTSxDQUFFLHFCQUFhLENBQUUsS0FBSyxDQUFDLE1BQU0sQ0FBRSxjQUFjLENBQUUsQ0FBRSxDQUFFLENBQUE7WUFFdkUsTUFBTSxDQUFDLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxxQkFBYSxDQUFFLE9BQU8sQ0FBRSxFQUFFLE1BQU0sRUFBRSxDQUFBO1FBQzdELENBQUM7UUFDRCxJQUFJLEVBQUUsVUFBVyxJQUFJO1lBQ2pCLE1BQU0sQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBRSxDQUFDLENBQUUsQ0FBQyxNQUFNLENBQUUsSUFBSSxDQUFFLENBQUMsSUFBSSxDQUFFLEdBQUcsQ0FBRSxDQUFBO1FBQzVELENBQUM7S0FDSixDQUFBO0FBQ0wsQ0FBQyxDQUFBO0FBRVksUUFBQSxtQkFBbUIsR0FBRyxNQUFNLENBQUMsRUFBRSxDQUFDLFVBQVcsTUFBTSxFQUFFLFFBQVE7SUFDcEUsTUFBTSxDQUFDLGdCQUFnQixDQUFFLFFBQVEsRUFBRSxVQUFXLENBQUM7UUFDM0MsRUFBRSxDQUFDLENBQUUsQ0FBQyxDQUFFLFFBQVEsQ0FBRSxDQUFDLElBQUksS0FBSyxNQUFPLENBQUM7WUFBQyxRQUFRLENBQUUsQ0FBQyxDQUFFLFFBQVEsQ0FBRSxDQUFFLENBQUE7SUFDbEUsQ0FBQyxDQUFFLENBQUE7QUFDUCxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgZ2VuZXJhdGVJZCA9IChmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgQUxQSEFCRVQgPSBcIjAxMjM0NTY3ODlhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ekFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaXCJcbiAgICBjb25zdCBJRF9MRU5HVEggPSA4XG5cbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQgcnRuID0gXCJcIlxuICAgICAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBJRF9MRU5HVEg7IGkrKyApIHtcbiAgICAgICAgICAgIHJ0biArPSBBTFBIQUJFVC5jaGFyQXQoIE1hdGguZmxvb3IoIE1hdGgucmFuZG9tKCkgKiBBTFBIQUJFVC5sZW5ndGggKSApXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJ0blxuICAgIH1cbn0pKClcblxuZXhwb3J0IGNvbnN0IG9iamVjdEZyb21QYWlyID0gZnVuY3Rpb24gKCBwYWlyICkge1xuICAgIGNvbnN0IG9iaiA9IHt9XG4gICAgb2JqWyBwYWlyWyAwIF0gXSA9IHBhaXJbIDEgXVxuICAgIHJldHVybiBvYmpcbn1cblxuZXhwb3J0IGNvbnN0IG1lcmdlID0gZnVuY3Rpb24gKCBvYmoxLCBvYmoyICkge1xuICAgIHJldHVybiBPYmplY3QuYXNzaWduKCB7fSwgb2JqMSwgb2JqMiApXG59XG5cbmV4cG9ydCBjb25zdCBkaXNwYXRjaEFjdGlvbiA9IGZ1bmN0aW9uICggd2luZG93ICkge1xuICAgIHJldHVybiBmdW5jdGlvbiAoIGV2ZW50ICkge1xuICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudCggbmV3IHdpbmRvdy5DdXN0b21FdmVudCggXCJhY3Rpb25cIixcbiAgICAgICAgICAgIHsgZGV0YWlsOiBldmVudCwgYnViYmxlczogdHJ1ZSwgY2FuY2VsYWJsZTogdHJ1ZSB9ICkgKVxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IGV2b2x2ZSA9IGZ1bmN0aW9uICggdHJhbnNmb3JtYXRpb25zLCBvYmplY3QgKSB7XG4gICAgY29uc3QgcmVzdWx0ID0ge31cblxuICAgIGZvciAoIGNvbnN0IGtleSBpbiBvYmplY3QgKSB7XG4gICAgICAgIGxldCB0cmFuc2Zvcm1hdGlvbiA9IHRyYW5zZm9ybWF0aW9uc1sga2V5IF1cblxuICAgICAgICBpZiAoIHR5cGVvZiB0cmFuc2Zvcm1hdGlvbiA9PT0gXCJmdW5jdGlvblwiICkge1xuICAgICAgICAgICAgcmVzdWx0WyBrZXkgXSA9IHRyYW5zZm9ybWF0aW9uKCBvYmplY3RbIGtleSBdIClcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICggdHlwZW9mIHRyYW5zZm9ybWF0aW9uID09PSBcIm9iamVjdFwiICkge1xuICAgICAgICAgICAgcmVzdWx0WyBrZXkgXSA9IGV2b2x2ZSggdHJhbnNmb3JtYXRpb24sIG9iamVjdFsga2V5IF0gKVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0WyBrZXkgXSA9IG9iamVjdFsga2V5IF1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUhhc0V2ZW50IHtcbiAgICBldmVudDogRXZlbnRcbn1cblxuZXhwb3J0IGNvbnN0IGN1cnJlbnRUYXJnZXQgPSBmdW5jdGlvbiAoIG1lc3NhZ2U6IElIYXNFdmVudCApOiBFdmVudFRhcmdldCB7XG4gICAgcmV0dXJuIG1lc3NhZ2UuZXZlbnQuY3VycmVudFRhcmdldFxufVxuXG5jb25zdCBmb3JFYWNoID0gZnVuY3Rpb24gKCBmbiwgaXRlcmFibGUgKSB7XG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgaXRlcmFibGUubGVuZ3RoOyBpKysgKSB7XG4gICAgICAgIGZuKCBpdGVyYWJsZVsgaSBdIClcbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCBleHRyYWN0Rm9ybURhdGEgPSBmdW5jdGlvbiAoIGZvcm0gKSB7XG4gICAgY29uc3QgZmllbGRzID0ge31cblxuICAgIGNvbnN0IGNvcHlQcm9wID0gZnVuY3Rpb24gKCBlbGVtZW50LCBwcm9wTmFtZSApIHtcbiAgICAgICAgZmllbGRzWyBlbGVtZW50Lm5hbWUgXSA9IGVsZW1lbnRbIHByb3BOYW1lIF1cbiAgICB9XG5cbiAgICBmb3JFYWNoKCBmdW5jdGlvbiAoIGVsZW1lbnQgKSB7XG4gICAgICAgIGlmICggZWxlbWVudC50eXBlID09PSBcInRleHRcIiB8fCBlbGVtZW50LnR5cGUgPT09IFwicGFzc3dvcmRcIiApIHtcbiAgICAgICAgICAgIGNvcHlQcm9wKCBlbGVtZW50LCBcInZhbHVlXCIgKVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCBlbGVtZW50LnR5cGUgPT09IFwicmFkaW9cIiAmJiBlbGVtZW50LmNoZWNrZWQgKSB7XG4gICAgICAgICAgICBjb3B5UHJvcCggZWxlbWVudCwgXCJ2YWx1ZVwiIClcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICggZWxlbWVudC50eXBlID09PSBcImNoZWNrYm94XCIgKSB7XG4gICAgICAgICAgICBjb3B5UHJvcCggZWxlbWVudCwgXCJjaGVja2VkXCIgKVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCBlbGVtZW50Lm5vZGVOYW1lID09PSBcIlNFTEVDVFwiICkge1xuICAgICAgICAgICAgY29weVByb3AoIGVsZW1lbnQsIFwidmFsdWVcIiApXG4gICAgICAgIH1cbiAgICB9LCBmb3JtLmVsZW1lbnRzIClcblxuICAgIHJldHVybiBmaWVsZHNcbn1cblxuZXhwb3J0IGNvbnN0IGN1cnJlbnRGb3JtID0gZnVuY3Rpb24gKCBtZXNzYWdlOiBJSGFzRXZlbnQgKTogYW55IHtcbiAgICByZXR1cm4gZXh0cmFjdEZvcm1EYXRhKCBjdXJyZW50VGFyZ2V0KCBtZXNzYWdlICkgKVxufVxuXG5leHBvcnQgY29uc3QgZmluZCA9IGZ1bmN0aW9uICggYXJyYXk6IGFueVtdLCBjb25kaXRpb246ICggYW55ICkgPT4gYm9vbGVhbiApIHtcbiAgICBsZXQgcmVzdWx0XG5cbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKyApIHtcbiAgICAgICAgaWYgKCBjb25kaXRpb24oIGFycmF5WyBpIF0gKSApIHtcbiAgICAgICAgICAgIHJldHVybiBhcnJheVsgaSBdXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0XG59XG5cbmV4cG9ydCBjb25zdCBtYXBPYmplY3RUb0FycmF5ID0gZnVuY3Rpb24gKCBvYmplY3Q6IGFueSwgZm46ICgga2V5OiBzdHJpbmcsIHZhbGl1ZTogYW55ICkgPT4gYW55ICk6IGFueSB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKCBvYmplY3QgKS5tYXAoIGZ1bmN0aW9uICgga2V5ICkge1xuICAgICAgICByZXR1cm4gZm4oIGtleSwgb2JqZWN0WyBrZXkgXSApXG4gICAgfSApXG59XG5cbnR5cGUgTWVzc2FnZSA9IHtcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgZGF0YTogYW55LFxuICAgIGV2ZW50OiBhbnlcbn1cblxuY29uc3QgZXh0cmFjdE1lc3NhZ2UgPSBmdW5jdGlvbiAoIHBhcmVudF9tZXNzYWdlLCBtZXNzYWdlICkge1xuICAgIHJldHVybiBtZXJnZSggbWVzc2FnZSwgeyBuYW1lOiBtZXNzYWdlLm5hbWUucmVwbGFjZSggXCI6XCIgKyBwYXJlbnRfbWVzc2FnZSwgXCJcIiApIH0gKVxufVxuXG5leHBvcnQgY29uc3QgY3JlYXRlVXBkYXRlciA9IGZ1bmN0aW9uICggcm91dGVEZWZpbml0aW9uczogYW55ICk6ICggTWVzc2FnZSwgYW55ICkgPT4gWyBhbnksIGFueSBdIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCBtZXNzYWdlOiBNZXNzYWdlLCBzdGF0ZTogYW55ICk6IFsgYW55LCBhbnkgXSB7XG4gICAgICAgIGZvciAoIGxldCBuYW1lIGluIHJvdXRlRGVmaW5pdGlvbnMgKSB7XG4gICAgICAgICAgICBpZiAoIG1lc3NhZ2UubmFtZS5pbmRleE9mKCBcIjpcIiArIG5hbWUgKSA9PT0gMCApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcm91dGVEZWZpbml0aW9uc1sgbmFtZSBdKCBleHRyYWN0TWVzc2FnZSggbmFtZSwgbWVzc2FnZSApLCBzdGF0ZSApXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gWyBzdGF0ZSwgdW5kZWZpbmVkIF1cbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVDb250ZXh0ID0gZnVuY3Rpb24gKCBuYW1lcyA9IFtdICkge1xuICAgIHJldHVybiB7XG4gICAgICAgIGNyZWF0ZUNvbXBvbmVudDogZnVuY3Rpb24gKCBjb21wb25lbnQsIGNvbXBvbmVudF9uYW1lICkge1xuICAgICAgICAgICAgY29uc3QgeyBpbml0LCB1cGRhdGVyLCByZW5kZXIgfSA9XG4gICAgICAgICAgICAgICAgY29tcG9uZW50LmNyZWF0ZSggY3JlYXRlQ29udGV4dCggbmFtZXMuY29uY2F0KCBjb21wb25lbnRfbmFtZSApICkgKVxuXG4gICAgICAgICAgICByZXR1cm4geyBpbml0LCB1cGRhdGU6IGNyZWF0ZVVwZGF0ZXIoIHVwZGF0ZXIgKSwgcmVuZGVyIH1cbiAgICAgICAgfSxcbiAgICAgICAgc2VuZDogZnVuY3Rpb24gKCBuYW1lICkge1xuICAgICAgICAgICAgcmV0dXJuIFwiOlwiICsgbmFtZXMuc2xpY2UoIDEgKS5jb25jYXQoIG5hbWUgKS5qb2luKCBcIjpcIiApXG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVBY3Rpb25IYW5kbGVyID0gd2luZG93ID0+IGZ1bmN0aW9uICggYWN0aW9uLCBjYWxsYmFjayApIHtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciggXCJhY3Rpb25cIiwgZnVuY3Rpb24gKCBlICkge1xuICAgICAgICBpZiAoIGVbIFwiZGV0YWlsXCIgXS5uYW1lID09PSBhY3Rpb24gKSBjYWxsYmFjayggZVsgXCJkZXRhaWxcIiBdIClcbiAgICB9IClcbn1cbiJdfQ==
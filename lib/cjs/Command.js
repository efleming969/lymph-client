"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const HTTP_1 = require("./HTTP");
class Execute {
    constructor(url, data, action, token) {
        this.url = url;
        this.data = data;
        this.action = action;
        this.token = token;
    }
    executeIn(environment) {
        const fetch_options = HTTP_1.createFetchOptions("POST", this.token, this.data);
        const action_name = this.action;
        environment.fetch(this.url, fetch_options).then(function (response) {
            return response.json().then(function (response_data) {
                if (response.status === 400)
                    throw response_data;
                environment.dispatch(action_name, response_data);
            });
        });
    }
}
exports.Execute = Execute;
exports.execute = function (url, data, action, token) {
    return new Execute(url, data, action, token);
};
class Query {
    constructor(url, action, token) {
        this.url = url;
        this.action = action;
        this.token = token;
    }
    executeIn(environment) {
        const fetch_options = HTTP_1.createFetchOptions("GET", this.token, null);
        const action_name = this.action;
        environment.fetch(this.url, fetch_options).then(function (response) {
            return response.json().then(function (response_data) {
                if (response.status === 400)
                    throw response_data;
                environment.dispatch(action_name, response_data);
            });
        });
    }
}
exports.Query = Query;
exports.query = function (url, action, token) {
    return new Query(url, action, token);
};
class ReadStorage {
    constructor(location, action) {
        this.location = location;
        this.action = action;
    }
    executeIn(environment) {
        const data = JSON.parse(environment.readStorage(this.location));
        environment.dispatch(this.action, data);
    }
}
exports.ReadStorage = ReadStorage;
exports.read = function (location, action) {
    return new ReadStorage(location, action);
};
class WriteStorage {
    constructor(location, data, action) {
        this.location = location;
        this.data = data;
        this.action = action;
    }
    executeIn(environment) {
        environment.writeStorage(this.location, JSON.stringify(this.data));
        if (this.action)
            environment.dispatch(this.action, this.data);
    }
}
exports.WriteStorage = WriteStorage;
exports.write = function (location, data, action) {
    return new WriteStorage(location, data, action);
};
class Redirect {
    constructor(path) {
        this.path = path;
    }
    executeIn(environment) {
        environment.changeLocation(this.path);
    }
}
exports.Redirect = Redirect;
exports.redirect = function (path) {
    return new Redirect(path);
};
class None {
    executeIn(environment) {
    }
}
exports.None = None;
exports.none = new None();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29tbWFuZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Db21tYW5kLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsaUNBQTJDO0FBTTNDO0lBQ0ksWUFBc0IsR0FBVyxFQUNYLElBQVMsRUFDVCxNQUFjLEVBQ2QsS0FBeUI7UUFIekIsUUFBRyxHQUFILEdBQUcsQ0FBUTtRQUNYLFNBQUksR0FBSixJQUFJLENBQUs7UUFDVCxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQ2QsVUFBSyxHQUFMLEtBQUssQ0FBb0I7SUFDL0MsQ0FBQztJQUVELFNBQVMsQ0FBRyxXQUF3QjtRQUNoQyxNQUFNLGFBQWEsR0FBRyx5QkFBa0IsQ0FBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFFLENBQUE7UUFDekUsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQTtRQUUvQixXQUFXLENBQUMsS0FBSyxDQUFFLElBQUksQ0FBQyxHQUFHLEVBQUUsYUFBYSxDQUFFLENBQUMsSUFBSSxDQUFFLFVBQVcsUUFBUTtZQUNsRSxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksQ0FBRSxVQUFXLGFBQWE7Z0JBQ2pELEVBQUUsQ0FBQyxDQUFFLFFBQVEsQ0FBQyxNQUFNLEtBQUssR0FBSSxDQUFDO29CQUFDLE1BQU0sYUFBYSxDQUFBO2dCQUNsRCxXQUFXLENBQUMsUUFBUSxDQUFFLFdBQVcsRUFBRSxhQUFhLENBQUUsQ0FBQTtZQUN0RCxDQUFDLENBQUUsQ0FBQTtRQUNQLENBQUMsQ0FBRSxDQUFBO0lBQ1AsQ0FBQztDQUNKO0FBbEJELDBCQWtCQztBQUVZLFFBQUEsT0FBTyxHQUFHLFVBQVcsR0FBVyxFQUFFLElBQVMsRUFBRSxNQUFjLEVBQUUsS0FBYztJQUNwRixNQUFNLENBQUMsSUFBSSxPQUFPLENBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsS0FBSyxD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LENBQUMsSUFBSSxDQUFFLENBQUE7SUFDM0MsQ0FBQztDQUNKO0FBUEQsNEJBT0M7QUFFWSxRQUFBLFFBQVEsR0FBRyxVQUFXLElBQVk7SUFDM0MsTUFBTSxDQUFDLElBQUksUUFBUSxDQUFFLElBQUksQ0FBRSxDQUFBO0FBQy9CLENBQUMsQ0FBQTtBQUVEO0lBQ0ksU0FBUyxDQUFHLFdBQXdCO0lBQ3BDLENBQUM7Q0FDSjtBQUhELG9CQUdDO0FBRVksUUFBQSxJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVudmlyb25tZW50IH0gZnJvbSBcIi4vRW52aXJvbm1lbnRcIlxuaW1wb3J0IHsgY3JlYXRlRmV0Y2hPcHRpb25zIH0gZnJvbSBcIi4vSFRUUFwiXG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tbWFuZCB7XG4gICAgZXhlY3V0ZUluKCBlbnZpcm9ubWVudDogRW52aXJvbm1lbnQgKTogdm9pZFxufVxuXG5leHBvcnQgY2xhc3MgRXhlY3V0ZSBpbXBsZW1lbnRzIENvbW1hbmQge1xuICAgIGNvbnN0cnVjdG9yICggcHJpdmF0ZSB1cmw6IHN0cmluZyxcbiAgICAgICAgICAgICAgICAgIHByaXZhdGUgZGF0YTogYW55LFxuICAgICAgICAgICAgICAgICAgcHJpdmF0ZSBhY3Rpb246IHN0cmluZyxcbiAgICAgICAgICAgICAgICAgIHByaXZhdGUgdG9rZW46IHN0cmluZyB8IHVuZGVmaW5lZCApIHtcbiAgICB9XG5cbiAgICBleGVjdXRlSW4gKCBlbnZpcm9ubWVudDogRW52aXJvbm1lbnQgKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGZldGNoX29wdGlvbnMgPSBjcmVhdGVGZXRjaE9wdGlvbnMoIFwiUE9TVFwiLCB0aGlzLnRva2VuLCB0aGlzLmRhdGEgKVxuICAgICAgICBjb25zdCBhY3Rpb25fbmFtZSA9IHRoaXMuYWN0aW9uXG5cbiAgICAgICAgZW52aXJvbm1lbnQuZmV0Y2goIHRoaXMudXJsLCBmZXRjaF9vcHRpb25zICkudGhlbiggZnVuY3Rpb24gKCByZXNwb25zZSApIHtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkudGhlbiggZnVuY3Rpb24gKCByZXNwb25zZV9kYXRhICkge1xuICAgICAgICAgICAgICAgIGlmICggcmVzcG9uc2Uuc3RhdHVzID09PSA0MDAgKSB0aHJvdyByZXNwb25zZV9kYXRhXG4gICAgICAgICAgICAgICAgZW52aXJvbm1lbnQuZGlzcGF0Y2goIGFjdGlvbl9uYW1lLCByZXNwb25zZV9kYXRhIClcbiAgICAgICAgICAgIH0gKVxuICAgICAgICB9IClcbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCBleGVjdXRlID0gZnVuY3Rpb24gKCB1cmw6IHN0cmluZywgZGF0YTogYW55LCBhY3Rpb246IHN0cmluZywgdG9rZW4/OiBzdHJpbmcgKSB7XG4gICAgcmV0dXJuIG5ldyBFeGVjdXRlKCB1cmwsIGRhdGEsIGFjdGlvbiwgdG9rZW4gKVxufVxuXG5leHBvcnQgY2xhc3MgUXVlcnkgaW1wbGVtZW50cyBDb21tYW5kIHtcbiAgICBjb25zdHJ1Y3RvciAoIHByaXZhdGUgdXJsOiBzdHJpbmcsXG4gICAgICAgICAgICAgICAgICBwcml2YXRlIGFjdGlvbjogc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgcHJpdmF0ZSB0b2tlbjogc3RyaW5nIHwgdW5kZWZpbmVkICkge1xuICAgIH1cblxuICAgIGV4ZWN1dGVJbiAoIGVudmlyb25tZW50OiBFbnZpcm9ubWVudCApOiB2b2lkIHtcbiAgICAgICAgY29uc3QgZmV0Y2hfb3B0aW9ucyA9IGNyZWF0ZUZldGNoT3B0aW9ucyggXCJHRVRcIiwgdGhpcy50b2tlbiwgbnVsbCApXG4gICAgICAgIGNvbnN0IGFjdGlvbl9uYW1lID0gdGhpcy5hY3Rpb25cblxuICAgICAgICBlbnZpcm9ubWVudC5mZXRjaCggdGhpcy51cmwsIGZldGNoX29wdGlvbnMgKS50aGVuKCBmdW5jdGlvbiAoIHJlc3BvbnNlICkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKS50aGVuKCBmdW5jdGlvbiAoIHJlc3BvbnNlX2RhdGEgKSB7XG4gICAgICAgICAgICAgICAgaWYgKCByZXNwb25zZS5zdGF0dXMgPT09IDQwMCApIHRocm93IHJlc3BvbnNlX2RhdGFcbiAgICAgICAgICAgICAgICBlbnZpcm9ubWVudC5kaXNwYXRjaCggYWN0aW9uX25hbWUsIHJlc3BvbnNlX2RhdGEgKVxuICAgICAgICAgICAgfSApXG4gICAgICAgIH0gKVxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IHF1ZXJ5ID0gZnVuY3Rpb24gKCB1cmw6IHN0cmluZywgYWN0aW9uOiBzdHJpbmcsIHRva2VuPzogc3RyaW5nICkge1xuICAgIHJldHVybiBuZXcgUXVlcnkoIHVybCwgYWN0aW9uLCB0b2tlbiApXG59XG5cbmV4cG9ydCBjbGFzcyBSZWFkU3RvcmFnZSBpbXBsZW1lbnRzIENvbW1hbmQge1xuICAgIGNvbnN0cnVjdG9yICggcHJpdmF0ZSBsb2NhdGlvbjogc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgcHJpdmF0ZSBhY3Rpb246IHN0cmluZyApIHtcbiAgICB9XG5cbiAgICBleGVjdXRlSW4gKCBlbnZpcm9ubWVudDogRW52aXJvbm1lbnQgKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKCBlbnZpcm9ubWVudC5yZWFkU3RvcmFnZSggdGhpcy5sb2NhdGlvbiApIClcbiAgICAgICAgZW52aXJvbm1lbnQuZGlzcGF0Y2goIHRoaXMuYWN0aW9uLCBkYXRhIClcbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCByZWFkID0gZnVuY3Rpb24gKCBsb2NhdGlvbjogc3RyaW5nLCBhY3Rpb246IHN0cmluZyApIHtcbiAgICByZXR1cm4gbmV3IFJlYWRTdG9yYWdlKCBsb2NhdGlvbiwgYWN0aW9uIClcbn1cblxuZXhwb3J0IGNsYXNzIFdyaXRlU3RvcmFnZSBpbXBsZW1lbnRzIENvbW1hbmQge1xuICAgIGNvbnN0cnVjdG9yICggcHJpdmF0ZSBsb2NhdGlvbjogc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgcHJpdmF0ZSBkYXRhOiBhbnksXG4gICAgICAgICAgICAgICAgICBwcml2YXRlIGFjdGlvbjogc3RyaW5nIHwgdW5kZWZpbmVkICkge1xuICAgIH1cblxuICAgIGV4ZWN1dGVJbiAoIGVudmlyb25tZW50OiBFbnZpcm9ubWVudCApOiB2b2lkIHtcbiAgICAgICAgZW52aXJvbm1lbnQud3JpdGVTdG9yYWdlKCB0aGlzLmxvY2F0aW9uLCBKU09OLnN0cmluZ2lmeSggdGhpcy5kYXRhICkgKVxuICAgICAgICBpZiAoIHRoaXMuYWN0aW9uICkgZW52aXJvbm1lbnQuZGlzcGF0Y2goIHRoaXMuYWN0aW9uLCB0aGlzLmRhdGEgKVxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IHdyaXRlID0gZnVuY3Rpb24gKCBsb2NhdGlvbjogc3RyaW5nLCBkYXRhOiBhbnksIGFjdGlvbj86IHN0cmluZyApIHtcbiAgICByZXR1cm4gbmV3IFdyaXRlU3RvcmFnZSggbG9jYXRpb24sIGRhdGEsIGFjdGlvbiApXG59XG5cbmV4cG9ydCBjbGFzcyBSZWRpcmVjdCBpbXBsZW1lbnRzIENvbW1hbmQge1xuICAgIGNvbnN0cnVjdG9yICggcHJpdmF0ZSBwYXRoOiBzdHJpbmcgKSB7XG4gICAgfVxuXG4gICAgZXhlY3V0ZUluICggZW52aXJvbm1lbnQ6IEVudmlyb25tZW50ICkge1xuICAgICAgICBlbnZpcm9ubWVudC5jaGFuZ2VMb2NhdGlvbiggdGhpcy5wYXRoIClcbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCByZWRpcmVjdCA9IGZ1bmN0aW9uICggcGF0aDogc3RyaW5nICk6IFJlZGlyZWN0IHtcbiAgICByZXR1cm4gbmV3IFJlZGlyZWN0KCBwYXRoIClcbn1cblxuZXhwb3J0IGNsYXNzIE5vbmUgaW1wbGVtZW50cyBDb21tYW5kIHtcbiAgICBleGVjdXRlSW4gKCBlbnZpcm9ubWVudDogRW52aXJvbm1lbnQgKTogdm9pZCB7XG4gICAgfVxufVxuXG5leHBvcnQgY29uc3Qgbm9uZSA9IG5ldyBOb25lKClcblxuIl19
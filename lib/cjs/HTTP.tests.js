"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const HTTP_1 = require("./HTTP");
const TestUtils_1 = require("./TestUtils");
describe("posting data to json endpoint", function () {
    test("200 response returns de-serialized data", function () {
        const http = new HTTP_1.default(TestUtils_1.createFakeFetch("/foobar", { status: 200, data: { name: "foo" } }));
        return http.post("/foobar", {}).then(function (response_data) {
            expect(response_data).toEqual({ name: "foo" });
        });
    });
    test("posted data is serialized", function () {
        const fakeFetch = TestUtils_1.createFakeFetch("/foo", {});
        const http = new HTTP_1.default(fakeFetch);
        return http.post("/foo", { text: "foobar" }).then(function (response) {
            expect(fakeFetch.mock.calls[0][1].body)
                .toEqual(JSON.stringify({ text: "foobar" }));
        });
    });
    test("authentication token is passed, when given", function () {
        const fakeFetch = TestUtils_1.createFakeFetch("/foo", {});
        const http = new HTTP_1.default(fakeFetch);
        return http.post("/foo", {}, "jwt").then(function (response) {
            expect(fakeFetch.mock.calls[0][1].headers["Authorization"])
                .toEqual("jwt");
        });
    });
    test("no authentication token is passed, when not given", function () {
        const fakeFetch = TestUtils_1.createFakeFetch("/foo", {});
        const http = new HTTP_1.default(fakeFetch);
        return http.post("/foo", {}).then(function (response) {
            expect(fakeFetch.mock.calls[0][1].headers["Authorization"])
                .toBeUndefined();
        });
    });
    test("bad request are handled", function () {
        const fakeFetch = TestUtils_1.createFakeFetch("/foo", {
            status: 400,
            data: "error_message"
        });
        const http = new HTTP_1.default(fakeFetch);
        return http.post("/foo", {}).then(function (response) {
            throw Error("did not handle bad request");
        }, function (error) {
            expect(error).toEqual("error_message");
        });
    });
});
describe("querying data from a json endpoint", function () {
    test("query response data is returned", function () {
        const http = new HTTP_1.default(TestUtils_1.createFakeFetch("/foobar", { status: 200, data: { name: "foo" } }));
        return http.get("/foobar").then(function (response) {
            expect(response).toEqual({ name: "foo" });
        });
    });
    test("authentication token is passed, when given", function () {
        const fakeFetch = TestUtils_1.createFakeFetch("/foo", {});
        const http = new HTTP_1.default(fakeFetch);
        return http.get("/foo", "jwt").then(function (response) {
            expect(fakeFetch.mock.calls[0][1].headers["Authorization"])
                .toEqual("jwt");
        });
    });
    test("no authentication token is passed, when not given", function () {
        const fakeFetch = TestUtils_1.createFakeFetch("/foo", {});
        const http = new HTTP_1.default(fakeFetch);
        return http.get("/foo").then(function (response) {
            expect(fakeFetch.mock.calls[0][1].headers["Authorization"])
                .toBeUndefined();
        });
    });
    test("bad request are handled", function () {
        const fakeFetch = TestUtils_1.createFakeFetch("/foo", {
            status: 400,
            data: "error_message"
        });
        const http = new HTTP_1.default(fakeFetch);
        return http.get("/foo").then(function (response) {
            throw Error("did not handle bad request");
        }, function (error) {
            expect(error).toEqual("error_message");
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSFRUUC50ZXN0cy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9IVFRQLnRlc3RzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsaUNBQXlCO0FBQ3pCLDJDQUE2QztBQUU3QyxRQUFRLENBQUUsK0JBQStCLEVBQUU7SUFFdkMsSUFBSSxDQUFFLHlDQUF5QyxFQUFFO1FBQzdDLE1BQU0sSUFBSSxHQUFHLElBQUksY0FBSSxDQUNqQiwyQkFBZSxDQUFFLFNBQVMsRUFBRSxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUUsQ0FBRSxDQUFBO1FBRTFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFFLFNBQVMsRUFBRSxFQUFFLENBQUUsQ0FBQyxJQUFJLENBQUUsVUFBVyxhQUFhO1lBQzVELE1BQU0sQ0FBRSxhQUFhLENBQUUsQ0FBQyxPQUFPLENBQUUsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUUsQ0FBQTtRQUN0RCxDQUFDLENBQUUsQ0FBQTtJQUNQLENBQUMsQ0FBRSxDQUFBO0lBRUgsSUFBSSxDQUFFLDJCQUEyQixFQUFFO1FBQy9CLE1BQU0sU0FBUyxHQUFHLDJCQUFlLENBQUUsTUFBTSxFQUFFLEVBQUUsQ0FBRSxDQUFBO1FBQy9DLE1BQU0sSUFBSSxHQUFHLElBQUksY0FBSSxDQUFFLFNBQVMsQ0FBRSxDQUFBO1FBRWxDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFFLE1BQU0sRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBRSxDQUFDLElBQUksQ0FBRSxVQUFXLFFBQVE7WUFDcEUsTUFBTSxDQUFFLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFFLENBQUMsQ0FBRSxDQUFFLENBQUMsQ0FBRSxDQUFDLElBQUksQ0FBRTtpQkFDeEMsT0FBTyxDQUFFLElBQUksQ0FBQyxTQUFTLENBQUUsRUFBRSxJQUFJ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QUE0QixDQUFFLENBQUE7UUFDL0MsQ0FBQyxFQUFFLFVBQVcsS0FBSztZQUNmLE1BQU0sQ0FBRSxLQUFLLENBQUUsQ0FBQyxPQUFPLENBQUUsZUFBZSxDQUFFLENBQUE7UUFDOUMsQ0FBQyxDQUFFLENBQUE7SUFDUCxDQUFDLENBQUUsQ0FBQTtBQUNQLENBQUMsQ0FBRSxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEhUVFAgZnJvbSBcIi4vSFRUUFwiXG5pbXBvcnQgeyBjcmVhdGVGYWtlRmV0Y2ggfSBmcm9tIFwiLi9UZXN0VXRpbHNcIlxuXG5kZXNjcmliZSggXCJwb3N0aW5nIGRhdGEgdG8ganNvbiBlbmRwb2ludFwiLCBmdW5jdGlvbiAoKSB7XG5cbiAgICB0ZXN0KCBcIjIwMCByZXNwb25zZSByZXR1cm5zIGRlLXNlcmlhbGl6ZWQgZGF0YVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IGh0dHAgPSBuZXcgSFRUUChcbiAgICAgICAgICAgIGNyZWF0ZUZha2VGZXRjaCggXCIvZm9vYmFyXCIsIHsgc3RhdHVzOiAyMDAsIGRhdGE6IHsgbmFtZTogXCJmb29cIiB9IH0gKSApXG5cbiAgICAgICAgcmV0dXJuIGh0dHAucG9zdCggXCIvZm9vYmFyXCIsIHt9ICkudGhlbiggZnVuY3Rpb24gKCByZXNwb25zZV9kYXRhICkge1xuICAgICAgICAgICAgZXhwZWN0KCByZXNwb25zZV9kYXRhICkudG9FcXVhbCggeyBuYW1lOiBcImZvb1wiIH0gKVxuICAgICAgICB9IClcbiAgICB9IClcblxuICAgIHRlc3QoIFwicG9zdGVkIGRhdGEgaXMgc2VyaWFsaXplZFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IGZha2VGZXRjaCA9IGNyZWF0ZUZha2VGZXRjaCggXCIvZm9vXCIsIHt9IClcbiAgICAgICAgY29uc3QgaHR0cCA9IG5ldyBIVFRQKCBmYWtlRmV0Y2ggKVxuXG4gICAgICAgIHJldHVybiBodHRwLnBvc3QoIFwiL2Zvb1wiLCB7IHRleHQ6IFwiZm9vYmFyXCIgfSApLnRoZW4oIGZ1bmN0aW9uICggcmVzcG9uc2UgKSB7XG4gICAgICAgICAgICBleHBlY3QoIGZha2VGZXRjaC5tb2NrLmNhbGxzWyAwIF1bIDEgXS5ib2R5IClcbiAgICAgICAgICAgICAgICAudG9FcXVhbCggSlNPTi5zdHJpbmdpZnkoIHsgdGV4dDogXCJmb29iYXJcIiB9ICkgKVxuICAgICAgICB9IClcbiAgICB9IClcblxuICAgIHRlc3QoIFwiYXV0aGVudGljYXRpb24gdG9rZW4gaXMgcGFzc2VkLCB3aGVuIGdpdmVuXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc3QgZmFrZUZldGNoID0gY3JlYXRlRmFrZUZldGNoKCBcIi9mb29cIiwge30gKVxuICAgICAgICBjb25zdCBodHRwID0gbmV3IEhUVFAoIGZha2VGZXRjaCApXG5cbiAgICAgICAgcmV0dXJuIGh0dHAucG9zdCggXCIvZm9vXCIsIHt9LCBcImp3dFwiICkudGhlbiggZnVuY3Rpb24gKCByZXNwb25zZSApIHtcbiAgICAgICAgICAgIGV4cGVjdCggZmFrZUZldGNoLm1vY2suY2FsbHNbIDAgXVsgMSBdLmhlYWRlcnNbIFwiQXV0aG9yaXphdGlvblwiIF0gKVxuICAgICAgICAgICAgICAgIC50b0VxdWFsKCBcImp3dFwiIClcbiAgICAgICAgfSApXG4gICAgfSApXG5cbiAgICB0ZXN0KCBcIm5vIGF1dGhlbnRpY2F0aW9uIHRva2VuIGlzIHBhc3NlZCwgd2hlbiBub3QgZ2l2ZW5cIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zdCBmYWtlRmV0Y2ggPSBjcmVhdGVGYWtlRmV0Y2goIFwiL2Zvb1wiLCB7fSApXG4gICAgICAgIGNvbnN0IGh0dHAgPSBuZXcgSFRUUCggZmFrZUZldGNoIClcblxuICAgICAgICByZXR1cm4gaHR0cC5wb3N0KCBcIi9mb29cIiwge30gKS50aGVuKCBmdW5jdGlvbiAoIHJlc3BvbnNlICkge1xuICAgICAgICAgICAgZXhwZWN0KCBmYWtlRmV0Y2gubW9jay5jYWxsc1sgMCBdWyAxIF0uaGVhZGVyc1sgXCJBdXRob3JpemF0aW9uXCIgXSApXG4gICAgICAgICAgICAgICAgLnRvQmVVbmRlZmluZWQoKVxuICAgICAgICB9IClcbiAgICB9IClcblxuICAgIHRlc3QoIFwiYmFkIHJlcXVlc3QgYXJlIGhhbmRsZWRcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zdCBmYWtlRmV0Y2ggPSBjcmVhdGVGYWtlRmV0Y2goIFwiL2Zvb1wiLCB7XG4gICAgICAgICAgICBzdGF0dXM6IDQwMCxcbiAgICAgICAgICAgIGRhdGE6IFwiZXJyb3JfbWVzc2FnZVwiXG4gICAgICAgIH0gKVxuXG4gICAgICAgIGNvbnN0IGh0dHAgPSBuZXcgSFRUUCggZmFrZUZldGNoIClcblxuICAgICAgICByZXR1cm4gaHR0cC5wb3N0KCBcIi9mb29cIiwge30gKS50aGVuKCBmdW5jdGlvbiAoIHJlc3BvbnNlICkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoIFwiZGlkIG5vdCBoYW5kbGUgYmFkIHJlcXVlc3RcIiApXG4gICAgICAgIH0sIGZ1bmN0aW9uICggZXJyb3IgKSB7XG4gICAgICAgICAgICBleHBlY3QoIGVycm9yICkudG9FcXVhbCggXCJlcnJvcl9tZXNzYWdlXCIgKVxuICAgICAgICB9IClcbiAgICB9IClcbn0gKVxuXG5kZXNjcmliZSggXCJxdWVyeWluZyBkYXRhIGZyb20gYSBqc29uIGVuZHBvaW50XCIsIGZ1bmN0aW9uICgpIHtcblxuICAgIHRlc3QoIFwicXVlcnkgcmVzcG9uc2UgZGF0YSBpcyByZXR1cm5lZFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IGh0dHAgPSBuZXcgSFRUUChcbiAgICAgICAgICAgIGNyZWF0ZUZha2VGZXRjaCggXCIvZm9vYmFyXCIsIHsgc3RhdHVzOiAyMDAsIGRhdGE6IHsgbmFtZTogXCJmb29cIiB9IH0gKSApXG5cbiAgICAgICAgcmV0dXJuIGh0dHAuZ2V0KCBcIi9mb29iYXJcIiApLnRoZW4oIGZ1bmN0aW9uICggcmVzcG9uc2UgKSB7XG4gICAgICAgICAgICBleHBlY3QoIHJlc3BvbnNlICkudG9FcXVhbCggeyBuYW1lOiBcImZvb1wiIH0gKVxuICAgICAgICB9IClcbiAgICB9IClcblxuICAgIHRlc3QoIFwiYXV0aGVudGljYXRpb24gdG9rZW4gaXMgcGFzc2VkLCB3aGVuIGdpdmVuXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc3QgZmFrZUZldGNoID0gY3JlYXRlRmFrZUZldGNoKCBcIi9mb29cIiwge30gKVxuICAgICAgICBjb25zdCBodHRwID0gbmV3IEhUVFAoIGZha2VGZXRjaCApXG5cbiAgICAgICAgcmV0dXJuIGh0dHAuZ2V0KCBcIi9mb29cIiwgXCJqd3RcIiApLnRoZW4oIGZ1bmN0aW9uICggcmVzcG9uc2UgKSB7XG4gICAgICAgICAgICBleHBlY3QoIGZha2VGZXRjaC5tb2NrLmNhbGxzWyAwIF1bIDEgXS5oZWFkZXJzWyBcIkF1dGhvcml6YXRpb25cIiBdIClcbiAgICAgICAgICAgICAgICAudG9FcXVhbCggXCJqd3RcIiApXG4gICAgICAgIH0gKVxuICAgIH0gKVxuXG4gICAgdGVzdCggXCJubyBhdXRoZW50aWNhdGlvbiB0b2tlbiBpcyBwYXNzZWQsIHdoZW4gbm90IGdpdmVuXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc3QgZmFrZUZldGNoID0gY3JlYXRlRmFrZUZldGNoKCBcIi9mb29cIiwge30gKVxuICAgICAgICBjb25zdCBodHRwID0gbmV3IEhUVFAoIGZha2VGZXRjaCApXG5cbiAgICAgICAgcmV0dXJuIGh0dHAuZ2V0KCBcIi9mb29cIiApLnRoZW4oIGZ1bmN0aW9uICggcmVzcG9uc2UgKSB7XG4gICAgICAgICAgICBleHBlY3QoIGZha2VGZXRjaC5tb2NrLmNhbGxzWyAwIF1bIDEgXS5oZWFkZXJzWyBcIkF1dGhvcml6YXRpb25cIiBdIClcbiAgICAgICAgICAgICAgICAudG9CZVVuZGVmaW5lZCgpXG4gICAgICAgIH0gKVxuICAgIH0gKVxuXG4gICAgdGVzdCggXCJiYWQgcmVxdWVzdCBhcmUgaGFuZGxlZFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IGZha2VGZXRjaCA9IGNyZWF0ZUZha2VGZXRjaCggXCIvZm9vXCIsIHtcbiAgICAgICAgICAgIHN0YXR1czogNDAwLFxuICAgICAgICAgICAgZGF0YTogXCJlcnJvcl9tZXNzYWdlXCJcbiAgICAgICAgfSApXG5cbiAgICAgICAgY29uc3QgaHR0cCA9IG5ldyBIVFRQKCBmYWtlRmV0Y2ggKVxuXG4gICAgICAgIHJldHVybiBodHRwLmdldCggXCIvZm9vXCIgKS50aGVuKCBmdW5jdGlvbiAoIHJlc3BvbnNlICkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoIFwiZGlkIG5vdCBoYW5kbGUgYmFkIHJlcXVlc3RcIiApXG4gICAgICAgIH0sIGZ1bmN0aW9uICggZXJyb3IgKSB7XG4gICAgICAgICAgICBleHBlY3QoIGVycm9yICkudG9FcXVhbCggXCJlcnJvcl9tZXNzYWdlXCIgKVxuICAgICAgICB9IClcbiAgICB9IClcbn0gKVxuIl19
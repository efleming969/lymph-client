"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const JSDOM = require("jsdom");
const DOM = require("./DOM");
exports.createTarget = function (html) {
    const template = `<!DOCTYPE html><head></head><body>${html}</body>`;
    const document = new JSDOM.JSDOM(template).window.document;
    return document.body.firstChild;
};
exports.createWindow = function () {
    const template = `<!DOCTYPE html><head></head><body></body>`;
    return new JSDOM.JSDOM(template).window;
};
exports.createTestContext = function () {
    const window = exports.createWindow();
    return {
        onAction: function (callback) {
            window.document.addEventListener("action", function (e) {
                const { name, data, event } = e.detail;
                event.preventDefault();
                callback(name, data, event);
            });
        },
        dispatch: function (event_type, selector) {
            const event = event_type === "click" ?
                new window.MouseEvent("click", {
                    bubbles: true,
                    cancelable: true
                }) : new window.Event(event_type);
            window.document.querySelector(selector).dispatchEvent(event);
        },
        render: function (view) {
            DOM.updateChildren(window, window.document.body, view);
        },
        find: function (selector) {
            return window.document.querySelector(selector);
        }
    };
};
exports.createFakeFetch = function (path, response) {
    return jest.fn(function (url, options) {
        return new Promise(function (res, rej) {
            const responseToForward = {
                status: response.status,
                json: () => Promise.resolve(response.data)
            };
            if (url === path) {
                res(responseToForward);
            }
            else {
                rej(responseToForward);
            }
        });
    });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGVzdFV0aWxzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL1Rlc3RVdGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLCtCQUE4QjtBQUU5Qiw2QkFBNEI7QUFJZixRQUFBLFlBQVksR0FBRyxVQUFXLElBQUk7SUFDdkMsTUFBTSxRQUFRLEdBQUcscUNBQXNDLElBQUssU0FBUyxDQUFBO0lBQ3JFLE1BQU0sUUFBUSxHQUFHLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBRSxRQUFRLENBQUUsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFBO0lBQzVELE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQTtBQUNuQyxDQUFDLENBQUE7QUFFWSxRQUFBLFlBQVksR0FBRztJQUN4QixNQUFNLFFBQVEsR0FBRywyQ0FBMkMsQ0FBQTtJQUM1RCxNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsS0FBSyxDQUFFLFFBQVEsQ0FBRSxDQUFDLE1BQU0sQ0FBQTtBQUM3QyxDQUFDLENBQUE7QUFFWSxRQUFBLGlCQUFpQixHQUFHO0lBQzdCLE1BQU0sTUFBTSxHQUFHLG9CQUFZLEVBQUUsQ0FBQTtJQUU3QixNQUFNLENBQUM7UUFDSCxRQUFRLEVBQUUsVUFBVyxRQUFRO1lBQ3pCLE1BQU0sQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLENBQUUsUUFBUSxFQUFFLFVBQVcsQ0FBYztnQkFDakUsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQTtnQkFDdEMsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFBO2dCQUN0QixRQUFRLENBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLENBQUUsQ0FBQTtZQUNqQyxDQUFDLENBQUUsQ0FBQTtRQUNQLENBQUM7UUFFRCxRQUFRLEVBQUUsVUFBVyxVQUFVLEVBQUUsUUFBUTtZQUNyQyxNQUFNLEtBQUssR0FBRyxVQUFVLEtBQUssT0FBTyxDQUFDLENBQUM7Z0JBQ2xDLElBQUksTUFBTSxDQUFDLFVBQVUsQ0FBRSxPQUFPLEVBQUU7b0JBQzVCLE9BQU8sRUFBRSxJQUFJO29CQUNiLFVBQVUsRUFBRSxJQUFJO2lCQUNuQixDQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksTUFBTSxDQUFDLEtBQUssQ0FBRSxVQUFVLENBQUUsQ0FBQTtZQUV4QyxNQUFNLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBRSxRQUFRLENBQUUsQ0FBQyxhQUFhLENBQUUsS0FBSyxDQUFFLENBQUE7UUFDcEUsQ0FBQztRQUVELE1BQU0sRUFBRSxVQUFXLElBQUk7WUFDbkIsR0FBRyxDQUFDLGNBQWMsQ0FBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFFLENBQUE7UUFDNUQsQ0FBQztRQUVELElBQUksRUFBRSxVQUFXLFFBQVE7WUFDckIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFFLFFBQVEsQ0FBRSxDQUFBO1FBQ3BELENBQUM7S0FDSixDQUFBO0FBQ0wsQ0FBQyxDQUFBO0FBRVksUUFBQSxlQUFlLEdBQUcsVUFBVyxJQUFJLEVBQUUsUUFBUTtJQUNwRCxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBRSxVQUFXLEdBQUcsRUFBRSxPQUFPO1FBQ25DLE1BQU0sQ0FBQyxJQUFJLE9BQU8sQ0FBRSxVQUFXLEdBQUcsRUFBRSxHQUFHO1lBQ25DLE1BQU0saUJBQWlCLEdBQUc7Z0JBQ3RCLE1BQU0sRUFBRSxRQUFRLENBQUMsTUFBTTtnQkFDdkIsSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUUsUUFBUSxDQUFDLElBQUksQ0FBRTthQUMvQyxDQUFBO1lBRUQsRUFBRSxDQUFDLENBQUUsR0FBRyxLQUFLLElBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ2pCLEdBQUcsQ0FBRSxpQkFBaUIsQ0FBRSxDQUFBO1lBQzVCLENBQUM7WUFDRCxJQUFJLENBQUMsQ0FBQztnQkFDRixHQUFHLENBQUUsaUJBQWlCLENBQUUsQ0FBQTtZQUM1QixDQUFDO1FBQ0wsQ0FBQyxDQUFFLENBQUE7SUFDUCxDQUFDLENBQUUsQ0FBQTtBQUNQLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIEpTRE9NIGZyb20gXCJqc2RvbVwiXG5cbmltcG9ydCAqIGFzIERPTSBmcm9tIFwiLi9ET01cIlxuaW1wb3J0IHsgRW52aXJvbm1lbnQgfSBmcm9tIFwiLi9FbnZpcm9ubWVudFwiXG5pbXBvcnQgSFRUUCBmcm9tIFwiLi9IVFRQXCJcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZVRhcmdldCA9IGZ1bmN0aW9uICggaHRtbCApIHtcbiAgICBjb25zdCB0ZW1wbGF0ZSA9IGA8IURPQ1RZUEUgaHRtbD48aGVhZD48L2hlYWQ+PGJvZHk+JHsgaHRtbCB9PC9ib2R5PmBcbiAgICBjb25zdCBkb2N1bWVudCA9IG5ldyBKU0RPTS5KU0RPTSggdGVtcGxhdGUgKS53aW5kb3cuZG9jdW1lbnRcbiAgICByZXR1cm4gZG9jdW1lbnQuYm9keS5maXJzdENoaWxkXG59XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVXaW5kb3cgPSBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgdGVtcGxhdGUgPSBgPCFET0NUWVBFIGh0bWw+PGhlYWQ+PC9oZWFkPjxib2R5PjwvYm9keT5gXG4gICAgcmV0dXJuIG5ldyBKU0RPTS5KU0RPTSggdGVtcGxhdGUgKS53aW5kb3dcbn1cblxuZXhwb3J0IGNvbnN0IGNyZWF0ZVRlc3RDb250ZXh0ID0gZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IHdpbmRvdyA9IGNyZWF0ZVdpbmRvdygpXG5cbiAgICByZXR1cm4ge1xuICAgICAgICBvbkFjdGlvbjogZnVuY3Rpb24gKCBjYWxsYmFjayApIHtcbiAgICAgICAgICAgIHdpbmRvdy5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCBcImFjdGlvblwiLCBmdW5jdGlvbiAoIGU6IEN1c3RvbUV2ZW50ICkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgbmFtZSwgZGF0YSwgZXZlbnQgfSA9IGUuZGV0YWlsXG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCBuYW1lLCBkYXRhLCBldmVudCApXG4gICAgICAgICAgICB9IClcbiAgICAgICAgfSxcblxuICAgICAgICBkaXNwYXRjaDogZnVuY3Rpb24gKCBldmVudF90eXBlLCBzZWxlY3RvciApIHtcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gZXZlbnRfdHlwZSA9PT0gXCJjbGlja1wiID9cbiAgICAgICAgICAgICAgICBuZXcgd2luZG93Lk1vdXNlRXZlbnQoIFwiY2xpY2tcIiwge1xuICAgICAgICAgICAgICAgICAgICBidWJibGVzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBjYW5jZWxhYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgfSApIDogbmV3IHdpbmRvdy5FdmVudCggZXZlbnRfdHlwZSApXG5cbiAgICAgICAgICAgIHdpbmRvdy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCBzZWxlY3RvciApLmRpc3BhdGNoRXZlbnQoIGV2ZW50IClcbiAgICAgICAgfSxcblxuICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICggdmlldyApIHtcbiAgICAgICAgICAgIERPTS51cGRhdGVDaGlsZHJlbiggd2luZG93LCB3aW5kb3cuZG9jdW1lbnQuYm9keSwgdmlldyApXG4gICAgICAgIH0sXG5cbiAgICAgICAgZmluZDogZnVuY3Rpb24gKCBzZWxlY3RvciApIHtcbiAgICAgICAgICAgIHJldHVybiB3aW5kb3cuZG9jdW1lbnQucXVlcnlTZWxlY3Rvciggc2VsZWN0b3IgKVxuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgY3JlYXRlRmFrZUZldGNoID0gZnVuY3Rpb24gKCBwYXRoLCByZXNwb25zZSApIHtcbiAgICByZXR1cm4gamVzdC5mbiggZnVuY3Rpb24gKCB1cmwsIG9wdGlvbnMgKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSggZnVuY3Rpb24gKCByZXMsIHJlaiApIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlVG9Gb3J3YXJkID0ge1xuICAgICAgICAgICAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgICAgICAgIGpzb246ICgpID0+IFByb21pc2UucmVzb2x2ZSggcmVzcG9uc2UuZGF0YSApXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggdXJsID09PSBwYXRoICkge1xuICAgICAgICAgICAgICAgIHJlcyggcmVzcG9uc2VUb0ZvcndhcmQgKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVqKCByZXNwb25zZVRvRm9yd2FyZCApXG4gICAgICAgICAgICB9XG4gICAgICAgIH0gKVxuICAgIH0gKVxufVxuXG4iXX0=
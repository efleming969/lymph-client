"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const JSDOM = require("jsdom");
const DOM = require("./DOM");
exports.createTarget = function (html) {
    const template = `<!DOCTYPE html><head></head><body>${html}</body>`;
    const document = new JSDOM.JSDOM(template).window.document;
    return document.body.firstChild;
};
exports.createWindow = function () {
    const template = `<!DOCTYPE html><head></head><body></body>`;
    return new JSDOM.JSDOM(template).window;
};
exports.createTestContext = function () {
    const window = exports.createWindow();
    return {
        onAction: function (callback) {
            window.document.addEventListener("action", function (e) {
                const { name, data, event } = e.detail;
                event.preventDefault();
                callback(name, data, event);
            });
        },
        dispatch: function (event_type, selector) {
            const event = event_type === "click" ?
                new window.MouseEvent("click", {
                    bubbles: true,
                    cancelable: true
                }) : new window.Event(event_type);
            window.document.querySelector(selector).dispatchEvent(event);
        },
        render: function (view) {
            DOM.updateChildren(window, window.document.body, view);
        },
        find: function (selector) {
            return window.document.querySelector(selector);
        }
    };
};
exports.createFakeFetch = function (path, response) {
    return jest.fn(function (url, options) {
        return new Promise(function (res, rej) {
            const responseToForward = {
                status: response.status,
                json: () => Promise.resolve(response.data)
            };
            if (url === path) {
                res(responseToForward);
            }
            else {
                rej(responseToForward);
            }
        });
    });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGVzdFV0aWxzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL1Rlc3RVdGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLCtCQUE4QjtBQUU5Qiw2QkFBNEI7QUFFZixRQUFBLFlBQVksR0FBRyxVQUFXLElBQUk7SUFDdkMsTUFBTSxRQUFRLEdBQUcscUNBQXNDLElBQUssU0FBUyxDQUFBO0lBQ3JFLE1BQU0sUUFBUSxHQUFHLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBRSxRQUFRLENBQUUsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFBO0lBQzVELE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQTtBQUNuQyxDQUFDLENBQUE7QUFFWSxRQUFBLFlBQVksR0FBRztJQUN4QixNQUFNLFFBQVEsR0FBRywyQ0FBMkMsQ0FBQTtJQUM1RCxNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsS0FBSyxDQUFFLFFBQVEsQ0FBRSxDQUFDLE1BQU0sQ0FBQTtBQUM3QyxDQUFDLENBQUE7QUFFWSxRQUFBLGlCQUFpQixHQUFHO0lBQzdCLE1BQU0sTUFBTSxHQUFHLG9CQUFZLEVBQUUsQ0FBQTtJQUU3QixNQUFNLENBQUM7UUFDSCxRQUFRLEVBQUUsVUFBVyxRQUFRO1lBQ3pCLE1BQU0sQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLENBQUUsUUFBUSxFQUFFLFVBQVcsQ0FBYztnQkFDakUsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQTtnQkFDdEMsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFBO2dCQUN0QixRQUFRLENBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLENBQUUsQ0FBQTtZQUNqQyxDQUFDLENBQUUsQ0FBQTtRQUNQLENBQUM7UUFFRCxRQUFRLEVBQUUsVUFBVyxVQUFVLEVBQUUsUUFBUTtZQUNyQyxNQUFNLEtBQUssR0FBRyxVQUFVLEtBQUssT0FBTyxDQUFDLENBQUM7Z0JBQ2xDLElBQUksTUFBTSxDQUFDLFVBQVUsQ0FBRSxPQUFPLEVBQUU7b0JBQzVCLE9BQU8sRUFBRSxJQUFJO29CQUNiLFVBQVUsRUFBRSxJQUFJO2lCQUNuQixDQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksTUFBTSxDQUFDLEtBQUssQ0FBRSxVQUFVLENBQUUsQ0FBQTtZQUV4QyxNQUFNLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBRSxRQUFRLENBQUUsQ0FBQyxhQUFhLENBQUUsS0FBSyxDQUFFLENBQUE7UUFDcEUsQ0FBQztRQUVELE1BQU0sRUFBRSxVQUFXLElBQUk7WUFDbkIsR0FBRyxDQUFDLGNBQWMsQ0FBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFFLENBQUE7UUFDNUQsQ0FBQztRQUVELElBQUksRUFBRSxVQUFXLFFBQVE7WUFDckIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFFLFFBQVEsQ0FBRSxDQUFBO1FBQ3BELENBQUM7S0FDSixDQUFBO0FBQ0wsQ0FBQyxDQUFBO0FBRVksUUFBQSxlQUFlLEdBQUcsVUFBVyxJQUFJLEVBQUUsUUFBUTtJQUNwRCxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBRSxVQUFXLEdBQUcsRUFBRSxPQUFPO1FBQ25DLE1BQU0sQ0FBQyxJQUFJLE9BQU8sQ0FBRSxVQUFXLEdBQUcsRUFBRSxHQUFHO1lBQ25DLE1BQU0saUJBQWlCLEdBQUc7Z0JBQ3RCLE1BQU0sRUFBRSxRQUFRLENBQUMsTUFBTTtnQkFDdkIsSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUUsUUFBUSxDQUFDLElBQUksQ0FBRTthQUMvQyxDQUFBO1lBRUQsRUFBRSxDQUFDLENBQUUsR0FBRyxLQUFLLElBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ2pCLEdBQUcsQ0FBRSxpQkFBaUIsQ0FBRSxDQUFBO1lBQzVCLENBQUM7WUFDRCxJQUFJLENBQUMsQ0FBQztnQkFDRixHQUFHLENBQUUsaUJBQWlCLENBQUUsQ0FBQTtZQUM1QixDQUFDO1FBQ0wsQ0FBQyxDQUFFLENBQUE7SUFDUCxDQUFDLENBQUUsQ0FBQTtBQUNQLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIEpTRE9NIGZyb20gXCJqc2RvbVwiXG5cbmltcG9ydCAqIGFzIERPTSBmcm9tIFwiLi9ET01cIlxuXG5leHBvcnQgY29uc3QgY3JlYXRlVGFyZ2V0ID0gZnVuY3Rpb24gKCBodG1sICkge1xuICAgIGNvbnN0IHRlbXBsYXRlID0gYDwhRE9DVFlQRSBodG1sPjxoZWFkPjwvaGVhZD48Ym9keT4keyBodG1sIH08L2JvZHk+YFxuICAgIGNvbnN0IGRvY3VtZW50ID0gbmV3IEpTRE9NLkpTRE9NKCB0ZW1wbGF0ZSApLndpbmRvdy5kb2N1bWVudFxuICAgIHJldHVybiBkb2N1bWVudC5ib2R5LmZpcnN0Q2hpbGRcbn1cblxuZXhwb3J0IGNvbnN0IGNyZWF0ZVdpbmRvdyA9IGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCB0ZW1wbGF0ZSA9IGA8IURPQ1RZUEUgaHRtbD48aGVhZD48L2hlYWQ+PGJvZHk+PC9ib2R5PmBcbiAgICByZXR1cm4gbmV3IEpTRE9NLkpTRE9NKCB0ZW1wbGF0ZSApLndpbmRvd1xufVxuXG5leHBvcnQgY29uc3QgY3JlYXRlVGVzdENvbnRleHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3Qgd2luZG93ID0gY3JlYXRlV2luZG93KClcblxuICAgIHJldHVybiB7XG4gICAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiAoIGNhbGxiYWNrICkge1xuICAgICAgICAgICAgd2luZG93LmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIFwiYWN0aW9uXCIsIGZ1bmN0aW9uICggZTogQ3VzdG9tRXZlbnQgKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBuYW1lLCBkYXRhLCBldmVudCB9ID0gZS5kZXRhaWxcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soIG5hbWUsIGRhdGEsIGV2ZW50IClcbiAgICAgICAgICAgIH0gKVxuICAgICAgICB9LFxuXG4gICAgICAgIGRpc3BhdGNoOiBmdW5jdGlvbiAoIGV2ZW50X3R5cGUsIHNlbGVjdG9yICkge1xuICAgICAgICAgICAgY29uc3QgZXZlbnQgPSBldmVudF90eXBlID09PSBcImNsaWNrXCIgP1xuICAgICAgICAgICAgICAgIG5ldyB3aW5kb3cuTW91c2VFdmVudCggXCJjbGlja1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIGJ1YmJsZXM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNhbmNlbGFibGU6IHRydWVcbiAgICAgICAgICAgICAgICB9ICkgOiBuZXcgd2luZG93LkV2ZW50KCBldmVudF90eXBlIClcblxuICAgICAgICAgICAgd2luZG93LmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIHNlbGVjdG9yICkuZGlzcGF0Y2hFdmVudCggZXZlbnQgKVxuICAgICAgICB9LFxuXG4gICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCB2aWV3ICkge1xuICAgICAgICAgICAgRE9NLnVwZGF0ZUNoaWxkcmVuKCB3aW5kb3csIHdpbmRvdy5kb2N1bWVudC5ib2R5LCB2aWV3IClcbiAgICAgICAgfSxcblxuICAgICAgICBmaW5kOiBmdW5jdGlvbiAoIHNlbGVjdG9yICkge1xuICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCBzZWxlY3RvciApXG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVGYWtlRmV0Y2ggPSBmdW5jdGlvbiAoIHBhdGgsIHJlc3BvbnNlICkge1xuICAgIHJldHVybiBqZXN0LmZuKCBmdW5jdGlvbiAoIHVybCwgb3B0aW9ucyApIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKCBmdW5jdGlvbiAoIHJlcywgcmVqICkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2VUb0ZvcndhcmQgPSB7XG4gICAgICAgICAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgICAgICAgICAganNvbjogKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCByZXNwb25zZS5kYXRhIClcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCB1cmwgPT09IHBhdGggKSB7XG4gICAgICAgICAgICAgICAgcmVzKCByZXNwb25zZVRvRm9yd2FyZCApXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZWooIHJlc3BvbnNlVG9Gb3J3YXJkIClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSApXG4gICAgfSApXG59XG5cbiJdfQ==